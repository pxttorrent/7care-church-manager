import{j as e}from"./ui-CM4P41nz.js";import{r as s}from"./vendor-v6ZOr5pf.js";import{l as a,f as t,g as r,k as i,C as l,c as n,E as o,U as c,e as d,a as m,b as x,L as h,I as u,X as g,p as j,q as p,r as v,s as b,t as f}from"./index-xQ7CSAYI.js";import{D as N,a as w,b as y,c as C}from"./dialog-FAhmki5l.js";import{T as k}from"./textarea-MRPZ5StH.js";import{C as S}from"./circle-alert-C1ONIbBe.js";import{T as A}from"./trending-up-Ivsilxu3.js";import{Z as R}from"./zap-Dk8ArLCJ.js";import{R as T}from"./refresh-cw-BA7TKkNZ.js";import{C as E}from"./clock-xEfMAGrT.js";import{S as z}from"./smile-Bx-rGzYe.js";import{I as D}from"./image-BuKB_ItD.js";import{P}from"./pause-CiMG2miI.js";import{P as U}from"./play-BPooh223.js";import{T as L}from"./trash-2-N19Nn4A8.js";import{S as F}from"./send-C-680ike.js";import"./charts-56rtB2he.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=a("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),G=a("ToggleLeft",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"8",cy:"12",r:"2",key:"1nvbw3"}]]),q=a("ToggleRight",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"6",ry:"6",key:"f2vt7d"}],["circle",{cx:"16",cy:"12",r:"2",key:"4ma0v8"}]]);
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function B(){const{user:a}=t(),{toast:B}=r(),[I,O]=s.useState(!1),[_,J]=s.useState(""),[V,H]=s.useState(""),[Z,$]=s.useState("general"),[K,Q]=s.useState("all"),[W,X]=s.useState([]),[Y,ee]=s.useState([]),[se,ae]=s.useState(!1),[te,re]=s.useState(null),[ie,le]=s.useState(null),[ne,oe]=s.useState(!1),[ce,de]=s.useState(null),[me,xe]=s.useState(null),[he,ue]=s.useState(!1),[ge,je]=s.useState(!1),pe=s.useRef(null),ve=s.useRef([]),be=s.useRef(null),fe=s.useRef(null);s.useEffect(()=>{a&&"admin"===a.role&&(Ne(),we())},[a]);const Ne=async()=>{try{const e=await fetch("/api/users");if(!e.ok)return;const s=await e.json();X(s.users||s||[])}catch{}},we=async()=>{try{const e=await fetch("/api/push/subscriptions");if(!e.ok)return;const s=await e.json();ee(s.subscriptions||s||[])}catch{}},ye=()=>{re(null),le(null),fe.current&&(fe.current.value="")},Ce=()=>{be.current&&(be.current.pause(),be.current=null),de(null),xe(null),ue(!1)};return a&&"admin"===a.role?e.jsx(i,{children:e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 md:p-6",children:[e.jsxs("div",{className:"mb-6 relative overflow-hidden rounded-2xl bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 p-8 shadow-2xl",children:[e.jsx("div",{className:"absolute inset-0 bg-black/10"}),e.jsx("div",{className:"absolute -right-10 -top-10 h-40 w-40 rounded-full bg-white/10 blur-3xl"}),e.jsx("div",{className:"absolute -left-10 -bottom-10 h-40 w-40 rounded-full bg-white/10 blur-3xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("div",{className:"p-3 bg-white/20 backdrop-blur-sm rounded-xl",children:e.jsx(o,{className:"h-6 w-6 text-white"})}),e.jsx("h1",{className:"text-3xl font-bold text-white",children:"Notificações Push"})]}),e.jsx("p",{className:"text-blue-100",children:"Envie notificações para todos os usuários"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(l,{className:"border-0 shadow-lg hover:shadow-xl transition-all duration-300 bg-gradient-to-br from-green-50 to-emerald-50",children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Subscriptions Ativas"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 mt-1",children:Y.length})]}),e.jsx("div",{className:"p-4 bg-green-100 rounded-xl",children:e.jsx(c,{className:"h-8 w-8 text-green-600"})})]})})}),e.jsx(l,{className:"border-0 shadow-lg hover:shadow-xl transition-all duration-300 bg-gradient-to-br from-blue-50 to-cyan-50",children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Usuários Cadastrados"}),e.jsx("p",{className:"text-3xl font-bold text-blue-600 mt-1",children:W.length})]}),e.jsx("div",{className:"p-4 bg-blue-100 rounded-xl",children:e.jsx(A,{className:"h-8 w-8 text-blue-600"})})]})})}),e.jsx(l,{className:"border-0 shadow-lg hover:shadow-xl transition-all duration-300 bg-gradient-to-br from-purple-50 to-pink-50",children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Taxa de Cobertura"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-600 mt-1",children:[W.length>0?Math.round(Y.length/W.length*100):0,"%"]})]}),e.jsx("div",{className:"p-4 bg-purple-100 rounded-xl",children:e.jsx(R,{className:"h-8 w-8 text-purple-600"})})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs(d,{onClick:()=>O(!0),size:"lg",className:"h-16 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg hover:shadow-xl transition-all duration-300 text-lg font-semibold",children:[e.jsx(o,{className:"h-6 w-6 mr-3"}),"Nova Notificação"]}),e.jsxs(d,{onClick:we,variant:"outline",size:"lg",className:"h-16 border-2 hover:bg-gray-50 transition-all duration-300 text-lg font-semibold",children:[e.jsx(T,{className:"h-6 w-6 mr-3"}),"Atualizar Lista"]})]}),Y.length>0&&e.jsxs(l,{className:"border-0 shadow-lg",children:[e.jsx(m,{children:e.jsxs(x,{className:"flex items-center gap-2",children:[e.jsx(c,{className:"h-5 w-5 text-blue-600"}),"Subscriptions Ativas (",Y.length,")"]})}),e.jsx(n,{children:e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto pr-2",children:Y.map((s,a)=>{const t=!1!==s.is_active;return e.jsxs("div",{className:"flex items-center justify-between p-4 rounded-xl transition-all duration-300 border-2 "+(t?"bg-gradient-to-r from-green-50 to-emerald-50 border-green-200 hover:shadow-md":"bg-gradient-to-r from-gray-50 to-slate-50 border-gray-300 opacity-60"),children:[e.jsxs("div",{className:"flex items-center gap-3 flex-1",children:[e.jsx("div",{className:"h-12 w-12 rounded-full flex items-center justify-center text-white font-bold shadow-lg "+(t?"bg-gradient-to-br from-green-400 to-emerald-500":"bg-gradient-to-br from-gray-400 to-slate-500"),children:s.user_name?.charAt(0).toUpperCase()||"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-semibold text-gray-900",children:s.user_name}),t?e.jsx("span",{className:"px-2 py-0.5 bg-green-100 text-green-700 text-xs font-medium rounded-full",children:"Ativa"}):e.jsx("span",{className:"px-2 py-0.5 bg-gray-200 text-gray-600 text-xs font-medium rounded-full",children:"Desativada"})]}),e.jsx("div",{className:"text-xs text-gray-500 mt-0.5",children:s.user_email}),e.jsxs("div",{className:"text-xs text-gray-400 mt-1 flex items-center gap-1",children:[e.jsx(E,{className:"h-3 w-3"}),"Criada em ",new Date(s.created_at).toLocaleDateString("pt-BR")]})]})]}),e.jsx(d,{onClick:()=>(async(e,s)=>{try{if(!(await fetch(`/api/push/subscriptions/${e}/toggle`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!s})})).ok)throw new Error("Falha ao atualizar subscription");B({title:s?"🔕 Subscription desativada":"🔔 Subscription ativada",description:s?"Usuário não receberá mais notificações":"Usuário voltará a receber notificações"}),we()}catch(a){B({title:"Erro ao atualizar",description:"Tente novamente mais tarde",variant:"destructive"})}})(s.id,t),variant:t?"outline":"default",size:"sm",className:"ml-3 transition-all duration-300 "+(t?"border-2 border-red-300 text-red-600 hover:bg-red-50 hover:border-red-400":"bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white shadow-lg"),children:t?e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"h-4 w-4 mr-1"}),"Desativar"]}):e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Ativar"]})})]},s.id)})})})]}),e.jsx(N,{open:I,onOpenChange:O,children:e.jsxs(w,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(y,{children:e.jsxs(C,{className:"text-2xl flex items-center gap-2",children:[e.jsx(o,{className:"h-6 w-6 text-blue-600"}),"Nova Notificação Rica"]})}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-sm font-semibold",children:"Título da Notificação"}),e.jsx(u,{value:_,onChange:e=>J(e.target.value),placeholder:"Ex: Novo evento esta semana!",className:"mt-1.5"})]}),e.jsxs("div",{children:[e.jsxs(h,{className:"text-sm font-semibold flex items-center justify-between",children:[e.jsx("span",{children:"Mensagem"}),e.jsxs(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>je(!ge),className:"h-8 px-2",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Emojis"]})]}),ge&&e.jsx("div",{className:"mt-2 p-3 bg-gray-50 rounded-lg border",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:["😀","😊","😂","🤗","😍","🥰","😎","🤩","🥳","🎉","❤️","💕","💖","💯","🔥","✨","🌟","🙏","👍","👏","🎊","🎈","🎁","🎂","🍰","☕","🍕","🎵","🎶","📱"].map((s,a)=>e.jsx("button",{type:"button",onClick:()=>(e=>{H(s=>s+e),je(!1)})(s),className:"text-2xl hover:bg-white p-2 rounded transition-colors",children:s},a))})}),e.jsx(k,{value:V,onChange:e=>H(e.target.value),placeholder:"Escreva sua mensagem aqui...",className:"mt-1.5 min-h-[100px]"})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-sm font-semibold",children:"Imagem (opcional)"}),e.jsxs("div",{className:"mt-1.5",children:[ie?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:ie,alt:"Preview",className:"w-full h-48 object-cover rounded-lg border-2 border-gray-200"}),e.jsx(d,{type:"button",variant:"destructive",size:"sm",onClick:ye,className:"absolute top-2 right-2",children:e.jsx(g,{className:"h-4 w-4"})})]}):e.jsxs("div",{onClick:()=>fe.current?.click(),className:"border-2 border-dashed border-gray-300 rounded-lg p-8 text-center cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-all",children:[e.jsx(D,{className:"h-10 w-10 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Clique para selecionar uma imagem"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG até 5MB"})]}),e.jsx("input",{ref:fe,type:"file",accept:"image/*",onChange:e=>{const s=e.target.files?.[0];if(s){if(s.size>5242880)return void B({title:"Arquivo muito grande",description:"A imagem deve ter no máximo 5MB",variant:"destructive"});re(s);const e=new FileReader;e.onloadend=()=>{le(e.result)},e.readAsDataURL(s)}},className:"hidden"})]})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-sm font-semibold",children:"Áudio (opcional)"}),e.jsx("div",{className:"mt-1.5 space-y-2",children:me?e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-gray-50 rounded-lg border",children:[e.jsx(d,{type:"button",variant:"outline",size:"sm",onClick:he?()=>{be.current&&(be.current.pause(),ue(!1))}:()=>{me&&(be.current||(be.current=new Audio(me)),be.current.play(),ue(!0),be.current.onended=()=>ue(!1))},children:he?e.jsx(P,{className:"h-4 w-4"}):e.jsx(U,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium",children:"Áudio gravado"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Clique para ouvir"})]}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:Ce,children:e.jsx(L,{className:"h-4 w-4 text-red-500"})})]}):e.jsxs(d,{type:"button",variant:ne?"destructive":"outline",onClick:ne?()=>{pe.current&&ne&&(pe.current.stop(),oe(!1),B({title:"✅ Gravação concluída",description:"Áudio pronto para envio"}))}:async()=>{try{const e=await navigator.mediaDevices.getUserMedia({audio:!0}),s=new MediaRecorder(e);pe.current=s,ve.current=[],s.ondataavailable=e=>{ve.current.push(e.data)},s.onstop=()=>{const s=new Blob(ve.current,{type:"audio/webm"});de(s),xe(URL.createObjectURL(s)),e.getTracks().forEach(e=>e.stop())},s.start(),oe(!0),B({title:"🎤 Gravando...",description:"Clique novamente para parar a gravação"})}catch(e){B({title:"Erro ao gravar",description:"Não foi possível acessar o microfone",variant:"destructive"})}},className:"w-full",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),ne?"Parar Gravação":"Gravar Áudio"]})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(h,{className:"text-sm font-semibold",children:"Tipo"}),e.jsxs(j,{value:Z,onValueChange:$,children:[e.jsx(p,{className:"mt-1.5",children:e.jsx(v,{})}),e.jsxs(b,{children:[e.jsx(f,{value:"general",children:"📢 Geral"}),e.jsx(f,{value:"announcement",children:"📣 Anúncio"}),e.jsx(f,{value:"reminder",children:"⏰ Lembrete"}),e.jsx(f,{value:"urgent",children:"🚨 Urgente"})]})]})]}),e.jsxs("div",{children:[e.jsx(h,{className:"text-sm font-semibold",children:"Destinatário"}),e.jsxs(j,{value:String(K),onValueChange:e=>Q("all"===e?"all":Number(e)),children:[e.jsx(p,{className:"mt-1.5",children:e.jsx(v,{})}),e.jsxs(b,{children:[e.jsxs(f,{value:"all",children:["👥 Todos (",Y.length,")"]}),W.map(s=>e.jsx(f,{value:String(s.id),children:s.name},s.id))]})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx(d,{variant:"outline",onClick:()=>O(!1),disabled:se,children:"Cancelar"}),e.jsx(d,{onClick:async()=>{if(_.trim()&&V.trim()){ae(!0);try{const e={title:_,message:V,type:Z,userId:"all"===K?null:Number(K),hasImage:!!te,hasAudio:!!ce,imageName:te?.name||null,audioSize:ce?.size||null};if(ce){const s=await new Promise((e,s)=>{const a=new FileReader;a.onloadend=()=>e(a.result),a.onerror=s,a.readAsDataURL(ce)});e.audioData=s}if(te){const s=await new Promise((e,s)=>{const a=new FileReader;a.onloadend=()=>e(a.result),a.onerror=s,a.readAsDataURL(te)});e.imageData=s}const s=await fetch("/api/push/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error("Falha ao enviar notificação");const a=await s.json();B({title:"🎉 Notificação enviada!",description:`Enviada para ${a.sentTo||Y.length} usuário(s)`}),J(""),H(""),$("general"),Q("all"),O(!1),ye(),Ce(),je(!1)}catch(e){B({title:"Erro ao enviar",description:"Tente novamente mais tarde",variant:"destructive"})}finally{ae(!1)}}else B({title:"Campos obrigatórios",description:"Preencha título e mensagem",variant:"destructive"})},disabled:se,className:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700",children:se?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"h-4 w-4 mr-2 animate-spin"}),"Enviando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Enviar Notificação"]})})]})]})]})})]})}):e.jsx(i,{children:e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-red-50 to-orange-50",children:e.jsx(l,{className:"max-w-md mx-4",children:e.jsxs(n,{className:"pt-6 text-center",children:[e.jsx(S,{className:"h-12 w-12 text-orange-500 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Acesso Restrito"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Esta página é exclusiva para administradores."})]})})})})}export{B as default};
