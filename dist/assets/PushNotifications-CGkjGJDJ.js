import{j as s}from"./ui-CM4P41nz.js";import{r as e}from"./vendor-v6ZOr5pf.js";import{f as a,k as i,C as t,a as n,b as l,Y as r,Z as c,c as d,U as o,e as x,L as m,I as h,p as j,q as u,r as p,s as f,t as N}from"./index-Y-Z_iq7n.js";import{D as v,a as g,b as w,c as y}from"./dialog-BkTbE8ML.js";import{S as b}from"./send-IGzBt2O0.js";import{R as S}from"./refresh-cw-eYCbxT4O.js";import"./charts-56rtB2he.js";function C(){const{user:C}=a(),[k,E]=e.useState(!1),[A,T]=e.useState("Aviso 7care"),[z,D]=e.useState("Olá! Esta é uma notificação de teste."),[O,I]=e.useState("info"),[L,_]=e.useState("all"),[M,P]=e.useState([]),[R,U]=e.useState([]),[V,q]=e.useState(!1);e.useEffect(()=>{C&&"admin"===C.role&&(B(),F())},[C]);const B=async()=>{try{const s=await fetch("/api/users");if(!s.ok)return;const e=await s.json();P(e.users||e||[])}catch{}},F=async()=>{try{const s=await fetch("/api/push/subscriptions");if(!s.ok)return;const e=await s.json();U(e.subscriptions||e||[])}catch{}};return C&&"admin"===C.role?s.jsx(i,{children:s.jsxs("div",{className:"p-4 space-y-4",children:[s.jsxs(t,{children:[s.jsxs(n,{children:[s.jsxs(l,{className:"flex items-center gap-2",children:[s.jsx(r,{className:"h-5 w-5"}),"Notificações Push"]}),s.jsx(c,{children:"Gerencie subscriptions e envie notificações personalizadas"})]}),s.jsxs(d,{className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[s.jsxs(t,{children:[s.jsx(n,{className:"pb-3",children:s.jsxs(l,{className:"text-base flex items-center gap-2",children:[s.jsx(o,{className:"h-4 w-4"}),"Estatísticas"]})}),s.jsxs(d,{className:"space-y-2",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"Subscriptions ativas:"}),s.jsx("span",{className:"text-sm font-medium",children:R.length})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"Usuários cadastrados:"}),s.jsx("span",{className:"text-sm font-medium",children:M.length})]}),s.jsxs("div",{className:"flex justify-between",children:[s.jsx("span",{className:"text-sm text-muted-foreground",children:"Cobertura:"}),s.jsxs("span",{className:"text-sm font-medium",children:[M.length>0?Math.round(R.length/M.length*100):0,"%"]})]})]})]}),s.jsxs(t,{children:[s.jsx(n,{className:"pb-3",children:s.jsxs(l,{className:"text-base flex items-center gap-2",children:[s.jsx(b,{className:"h-4 w-4"}),"Ações"]})}),s.jsxs(d,{className:"space-y-3",children:[s.jsxs(x,{onClick:()=>E(!0),className:"w-full",size:"sm",children:[s.jsx(r,{className:"h-4 w-4 mr-2"}),"Enviar Notificação"]}),s.jsxs(x,{onClick:F,variant:"outline",className:"w-full",size:"sm",children:[s.jsx(S,{className:"h-4 w-4 mr-2"}),"Atualizar Lista"]})]})]})]}),R.length>0&&s.jsxs(t,{children:[s.jsx(n,{className:"pb-3",children:s.jsx(l,{className:"text-base",children:"Subscriptions Ativas"})}),s.jsx(d,{children:s.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:R.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[s.jsxs("div",{className:"flex-1",children:[s.jsx("div",{className:"text-sm font-medium",children:e.user_name}),s.jsx("div",{className:"text-xs text-muted-foreground",children:e.user_email})]}),s.jsx("div",{className:"text-xs text-muted-foreground",children:new Date(e.created_at).toLocaleDateString("pt-BR")})]},e.id))})})]})]})]}),s.jsx(v,{open:k,onOpenChange:E,children:s.jsxs(g,{className:"max-w-md mx-auto",children:[s.jsx(w,{children:s.jsx(y,{children:"Enviar Notificação"})}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{children:[s.jsx(m,{children:"Título"}),s.jsx(h,{value:A,onChange:s=>T(s.target.value)})]}),s.jsxs("div",{children:[s.jsx(m,{children:"Mensagem"}),s.jsx(h,{value:z,onChange:s=>D(s.target.value)})]}),s.jsxs("div",{children:[s.jsx(m,{children:"Tipo"}),s.jsxs(j,{value:O,onValueChange:I,children:[s.jsx(u,{children:s.jsx(p,{placeholder:"Selecione um tipo"})}),s.jsxs(f,{children:[s.jsx(N,{value:"info",children:"Informativo"}),s.jsx(N,{value:"alert",children:"Alerta"}),s.jsx(N,{value:"success",children:"Sucesso"})]})]})]}),s.jsxs("div",{children:[s.jsx(m,{children:"Destinatário"}),s.jsxs(j,{value:String(L),onValueChange:s=>_("all"===s?"all":Number(s)),children:[s.jsx(u,{children:s.jsx(p,{placeholder:"Selecione um destinatário"})}),s.jsxs(f,{children:[s.jsx(N,{value:"all",children:"Todos os usuários"}),M.map(e=>s.jsx(N,{value:String(e.id),children:e.name},e.id))]})]})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[s.jsx(x,{variant:"outline",onClick:()=>E(!1),children:"Cancelar"}),s.jsx(x,{onClick:async()=>{q(!0);try{const s={title:A,message:z,type:O,userId:"all"===L?null:Number(L)},e=await fetch("/api/push/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!e.ok){const s=await e.json().catch(()=>({}));throw new Error(s.error||"Falha ao enviar notificação")}E(!1)}catch(s){}finally{q(!1)}},disabled:V,children:V?"Enviando...":"Enviar"})]})]})]})})]})}):s.jsx(i,{children:s.jsx("div",{className:"p-4 text-center text-sm text-muted-foreground",children:"Acesso restrito aos administradores."})})}export{C as default};
