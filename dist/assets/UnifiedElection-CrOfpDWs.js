import{j as e}from"./ui-CM4P41nz.js";import{r as s}from"./vendor-v6ZOr5pf.js";import{f as a,g as i,u as t,k as l,K as r,e as c,R as n,at as o,E as d,C as m,c as x,a as h,b as j,a0 as u,B as g,U as N,G as f,a9 as p,as as v,d as w,_ as b,$ as y}from"./index-DS4d0TuW.js";import{T as C,a as k,b as E,c as A}from"./tabs-1ymYxlUV.js";import{V as _}from"./vote-WWMLTHqr.js";import{P as S}from"./plus-BXhyrANL.js";import{C as z}from"./clock-975WluR8.js";import{S as P}from"./square-pen-D8-LnZEG.js";import{P as D}from"./play-B1w1QOGQ.js";import{T as $}from"./trash-2-CaHbINSD.js";import{A as I}from"./arrow-right-B7z_-YDg.js";import{P as T}from"./pause-CaMH7XuQ.js";import"./charts-56rtB2he.js";function V(){const{user:V}=a(),{toast:G}=i(),R=t(),[q,L]=s.useState("dashboard"),[B,F]=s.useState([]),[J,K]=s.useState([]),[O,H]=s.useState(!0),[M,U]=s.useState(!0);s.useEffect(()=>{if(X(),M){const e=setInterval(X,5e3);return()=>clearInterval(e)}},[M,V?.id]);const X=async()=>{try{await Promise.all([Q(),W()])}catch(e){}finally{H(!1)}},Q=async()=>{try{const e=await fetch("/api/elections/configs");if(e.ok){const s=await e.json();F(s)}}catch(e){}},W=async()=>{try{if(!V?.id)return void K([]);const e=await fetch("/api/elections/active",{headers:{"Cache-Control":"no-cache",Pragma:"no-cache","x-user-id":V.id.toString()}});if(e.ok){const s=await e.json();K(s.elections||[])}else K([])}catch(e){K([])}},Y=s=>"active"===s.election_status?e.jsxs(g,{variant:"default",className:"bg-green-500",children:[e.jsx(D,{className:"w-3 h-3 mr-1"}),"Ativa"]}):"draft"===s.status?e.jsxs(g,{variant:"secondary",children:[e.jsx(d,{className:"w-3 h-3 mr-1"}),"Rascunho"]}):e.jsxs(g,{variant:"outline",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),"Pausada"]});return O?e.jsx(l,{children:e.jsxs("div",{className:"p-4 flex items-center justify-center min-h-[400px]",children:[e.jsx(r,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Carregando..."})]})}):e.jsx(l,{children:e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(_,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Sistema de Nomeações"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie e participe das eleições de liderança"})]})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>U(!M),children:[e.jsx(n,{className:"h-4 w-4 mr-2 "+(M?"animate-spin":"")}),M?"Pausar":"Atualizar"]})})]}),e.jsxs(C,{value:q,onValueChange:L,className:"w-full",children:[e.jsxs(k,{className:"grid w-full grid-cols-3",children:[e.jsxs(E,{value:"dashboard",className:"flex items-center gap-2",children:[e.jsx(o,{className:"h-4 w-4"}),"Dashboard"]}),e.jsxs(E,{value:"voting",className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Votação"]}),e.jsxs(E,{value:"config",className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-4 w-4"}),"Configuração"]})]}),e.jsxs(A,{value:"dashboard",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Configurações de Nomeação"}),e.jsxs(c,{onClick:()=>R("/election-config"),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Nova Nomeação"]})]}),0===B.length?e.jsx(m,{children:e.jsxs(x,{className:"p-8 text-center",children:[e.jsx(_,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhuma nomeação configurada"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Configure uma nova nomeação para começar o processo de eleição de liderança."}),e.jsxs(c,{onClick:()=>R("/election-config"),children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Configurar Nomeação"]})]})}):e.jsx("div",{className:"grid gap-4",children:B.map(s=>e.jsxs(m,{className:"hover:shadow-md transition-shadow",children:[e.jsx(h,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(j,{className:"text-lg",children:s.church_name}),e.jsxs(u,{children:[s.positions.length," cargos • ",s.voters.length," votantes"]})]}),Y(s)]})}),e.jsx(x,{className:"pt-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(g,{variant:"outline",className:"text-xs",children:[e.jsx(N,{className:"w-3 h-3 mr-1"}),s.voters.length," votantes"]}),e.jsxs(g,{variant:"outline",className:"text-xs",children:[e.jsx(_,{className:"w-3 h-3 mr-1"}),s.positions.length," cargos"]}),e.jsxs(g,{variant:"outline",className:"text-xs",children:[e.jsx(z,{className:"w-3 h-3 mr-1"}),new Date(s.created_at).toLocaleDateString("pt-BR")]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:["active"===s.election_status?e.jsxs(e.Fragment,{children:[e.jsxs(c,{size:"sm",onClick:()=>{window.open(`/election-manage/${s.id}`,"_blank")},className:"bg-purple-600 hover:bg-purple-700",children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),"Gerenciar"]}),e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>{window.open(`/election-dashboard/${s.id}`,"_blank")},children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Acompanhar"]}),e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>R(`/election-config?id=${s.id}`),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Editar"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(c,{size:"sm",onClick:()=>(async e=>{try{const s=await fetch("/api/elections/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({configId:e})});if(s.ok)G({title:"Nomeação iniciada",description:"A nomeação foi iniciada com sucesso!"}),X();else{const e=await s.json();if(400!==s.status||!e.error.includes("Já existe uma eleição ativa"))throw new Error("Erro ao iniciar nomeação");G({title:"Nomeação já ativa",description:"Esta configuração já possui uma eleição em andamento.",variant:"destructive"})}}catch(s){G({title:"Erro",description:"Não foi possível iniciar a nomeação.",variant:"destructive"})}})(s.id),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Iniciar"]}),e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>R(`/election-config?id=${s.id}`),children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Editar"]})]}),e.jsxs(c,{size:"sm",variant:"destructive",onClick:()=>(async e=>{if(confirm("Tem certeza que deseja excluir esta configuração? Esta ação não pode ser desfeita."))try{if(!(await fetch(`/api/elections/config/${e}`,{method:"DELETE"})).ok)throw new Error("Erro ao excluir configuração");G({title:"Configuração excluída",description:"A configuração foi excluída com sucesso!"}),X()}catch(s){G({title:"Erro",description:"Não foi possível excluir a configuração.",variant:"destructive"})}})(s.id),children:[e.jsx($,{className:"h-4 w-4 mr-2"}),"Excluir"]})]})]})})]},s.id))})]}),e.jsxs(A,{value:"voting",className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Nomeações Ativas"}),0===J.length?e.jsx(m,{children:e.jsxs(x,{className:"pt-6 text-center",children:[e.jsx(p,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Nenhuma Nomeação Disponível"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:V?.id?"Você não está incluído em nenhuma nomeação ativa no momento.":"Você precisa estar logado para ver suas nomeações."}),!V?.id&&e.jsx(c,{onClick:()=>window.location.href="/login",className:"bg-blue-600 hover:bg-blue-700",children:"Fazer Login"})]})}):e.jsx("div",{className:"space-y-4",children:J.map(s=>{return e.jsxs(m,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(h,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{className:"h-6 w-6 text-blue-600"}),e.jsxs("div",{children:[e.jsx(j,{className:"text-lg",children:s.church_name}),e.jsxs(u,{className:"flex items-center gap-2 mt-1",children:[e.jsx(w,{className:"h-4 w-4"}),"Iniciada em ",(a=s.created_at,new Date(a).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}))]})]})]}),e.jsx(g,{className:"bg-blue-100 text-blue-800",children:"Nomeação Ativa"})]})}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Cargo Atual"}),e.jsxs("span",{children:[s.current_position+1," de ",s.positions.length]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-500",style:{width:(s.current_position+1)/s.positions.length*100+"%"}})}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.positions[s.current_position]||"Aguardando início"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:s.voters.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Votantes"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:s.positions.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cargos"})]})]}),e.jsxs(c,{onClick:()=>(e=>{window.location.href=`/election-vote/${e.config_id}`})(s),className:"w-full bg-blue-600 hover:bg-blue-700",size:"lg",children:[e.jsx(I,{className:"h-5 w-5 mr-2"}),"Acessar Nomeação"]})]})]},s.election_id);var a})}),e.jsxs(m,{className:"bg-blue-50 border-blue-200",children:[e.jsx(h,{children:e.jsxs(j,{className:"text-blue-800 flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5"}),"Como Participar"]})}),e.jsx(x,{children:e.jsxs("div",{className:"text-blue-700 space-y-2",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"1."}),' Clique em "Acessar Nomeação" na eleição da sua igreja']}),e.jsxs("p",{children:[e.jsx("strong",{children:"2."})," Siga as instruções na tela do seu celular"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"3."})," Indique ou vote conforme solicitado"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"4."})," Acompanhe os resultados em tempo real"]})]})})]})]}),e.jsxs(A,{value:"config",className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Configurações"}),e.jsxs(c,{onClick:()=>R("/election-config"),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(S,{className:"h-4 w-4 mr-2"}),"Nova Configuração"]})]}),e.jsxs(b,{children:[e.jsx(d,{className:"h-4 w-4"}),e.jsxs(y,{children:[e.jsx("strong",{children:"Configuração de Nomeações:"})," Acesse a página de configuração para criar e gerenciar os parâmetros das eleições de liderança da sua igreja."]})]}),e.jsxs(m,{children:[e.jsxs(h,{children:[e.jsxs(j,{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-5 w-5"}),"Acesso Rápido"]}),e.jsx(u,{children:"Gerencie as configurações de nomeação"})]}),e.jsxs(x,{className:"space-y-4",children:[e.jsxs(c,{onClick:()=>R("/election-config"),className:"w-full",variant:"outline",children:[e.jsx(d,{className:"h-4 w-4 mr-2"}),"Configurar Nomeação"]}),e.jsxs(c,{onClick:()=>R("/election-dashboard"),className:"w-full",variant:"outline",children:[e.jsx(o,{className:"h-4 w-4 mr-2"}),"Dashboard Completo"]})]})]})]})]})]})})}export{V as default};
