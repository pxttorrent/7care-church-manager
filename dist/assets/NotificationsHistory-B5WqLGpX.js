import{j as e}from"./ui-CM4P41nz.js";import{l as t,f as a,g as i,k as s,F as r,e as o,C as n,c}from"./index-CoO3up3m.js";import{r as l}from"./vendor-v6ZOr5pf.js";import{C as d}from"./clock-DHpur2gx.js";import{I as m}from"./image-BywoBH-O.js";import{T as h}from"./trash-2-oOfxoTT-.js";import"./charts-56rtB2he.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const x=t("Volume2",[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]]);function u(){const{user:t}=a(),{toast:u}=i(),[p,f]=l.useState([]),[g,j]=l.useState(null);l.useEffect(()=>{const e=async()=>{if(t?.id)try{const e=await fetch(`/api/notifications/${t.id}?limit=50`);if(e.ok){const t=(await e.json()).map(e=>({id:e.id.toString(),title:e.title,message:e.message,type:e.type,hasAudio:!1,hasImage:!1,timestamp:e.created_at||e.createdAt,read:e.is_read||e.isRead||!1}));f(t)}else{const e=localStorage.getItem(`notifications_${t.id}`);if(e){const t=JSON.parse(e);f(t)}}}catch(e){try{const e=localStorage.getItem(`notifications_${t.id}`);if(e){const t=JSON.parse(e);f(t)}}catch(a){}}};e();const a=setInterval(e,3e4),i=e=>{const t=e.detail;f(e=>[t,...e].slice(0,50))};return window.addEventListener("newNotification",i),()=>{clearInterval(a),window.removeEventListener("newNotification",i)}},[t?.id]);const v=e=>{try{const t=new Date(e),a=(new Date).getTime()-t.getTime(),i=Math.floor(a/6e4),s=Math.floor(a/36e5),r=Math.floor(a/864e5);return i<1?"Agora":i<60?`H√° ${i} min`:s<24?`H√° ${s}h`:r<7?`H√° ${r}d`:t.toLocaleDateString("pt-BR",{day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})}catch{return e}},N=e=>{switch(e){case"urgent":return"üö®";case"reminder":return"‚è∞";case"announcement":return"üì£";default:return"üì¢"}};return e.jsx(s,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 pb-24 md:pb-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl shadow-lg",children:e.jsx(r,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Notifica√ß√µes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Hist√≥rico de notifica√ß√µes recebidas"})]})]}),p.length>0&&e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{confirm("Deseja realmente limpar todo o hist√≥rico de notifica√ß√µes?")&&(f([]),localStorage.removeItem(`notifications_${t?.id}`),u({title:"Hist√≥rico limpo",description:"Todas as notifica√ß√µes foram removidas."}))},className:"text-red-600 hover:bg-red-50 hover:text-red-700 border-red-200",children:"Limpar tudo"})]})}),0===p.length?e.jsx(n,{className:"border-2 border-dashed border-gray-300",children:e.jsxs(c,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(r,{className:"h-16 w-16 text-gray-400 mb-4"}),e.jsx("p",{className:"text-lg font-medium text-gray-600 mb-1",children:"Nenhuma notifica√ß√£o"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Voc√™ n√£o recebeu notifica√ß√µes ainda"})]})}):e.jsx("div",{className:"space-y-3",children:p.map(a=>e.jsx(n,{className:"group hover:shadow-lg transition-all duration-200 border-l-4",style:{borderLeftColor:"urgent"===a.type?"#ef4444":"reminder"===a.type?"#f59e0b":"announcement"===a.type?"#8b5cf6":"#3b82f6"},children:e.jsx(c,{className:"p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"text-2xl mt-1 flex-shrink-0",children:N(a.type)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsx("h3",{className:"font-semibold text-gray-900 leading-tight",children:a.title}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-gray-500 flex-shrink-0",children:[e.jsx(d,{className:"h-3 w-3"}),v(a.timestamp)]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-3 whitespace-pre-wrap",children:a.message}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[a.hasAudio&&a.audioData&&e.jsxs(o,{size:"sm",variant:g===a.id?"default":"outline",onClick:()=>(e=>{if(e.audioData)try{const t=document.querySelector("audio.notification-player");t&&(t.pause(),t.remove());const a=new Audio(e.audioData);a.className="notification-player",a.setAttribute("playsinline",""),a.setAttribute("webkit-playsinline",""),a.preload="auto",j(e.id),a.addEventListener("ended",()=>{j(null),a.remove()}),a.addEventListener("error",()=>{u({title:"Erro ao reproduzir √°udio",description:"N√£o foi poss√≠vel reproduzir o √°udio desta notifica√ß√£o.",variant:"destructive"}),j(null),a.remove()}),a.play().catch(e=>{u({title:"Erro ao reproduzir",description:"Por favor, tente novamente.",variant:"destructive"}),j(null)})}catch(t){u({title:"Erro",description:"Ocorreu um erro ao tentar reproduzir o √°udio.",variant:"destructive"}),j(null)}})(a),className:"gap-2",children:[e.jsx(x,{className:"h-4 w-4"}),g===a.id?"Tocando...":"Ouvir √Åudio"]}),a.hasImage&&a.imageData&&e.jsxs(o,{size:"sm",variant:"outline",onClick:()=>{window.open(a.imageData,"_blank")},className:"gap-2",children:[e.jsx(m,{className:"h-4 w-4"}),"Ver Imagem"]}),e.jsx("div",{className:"flex-1"}),e.jsx(o,{size:"sm",variant:"ghost",onClick:()=>(e=>{const a=p.filter(t=>t.id!==e);f(a),localStorage.setItem(`notifications_${t?.id}`,JSON.stringify(a)),u({title:"Notifica√ß√£o exclu√≠da",description:"A notifica√ß√£o foi removida do hist√≥rico."})})(a.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(h,{className:"h-4 w-4"})})]})]})]})})},a.id))})]})})})}export{u as default};
