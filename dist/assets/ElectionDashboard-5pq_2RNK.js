import{j as e}from"./ui-CM4P41nz.js";import{r as s}from"./vendor-v6ZOr5pf.js";import{f as a,g as i,u as t,k as r,an as o,e as n,C as c,c as l,a as d,b as m,Z as x,B as h,U as j,A as u,E as f,$ as v,a0 as p}from"./index-Bmmyqco1.js";import{D as g,a as N,b as w,c as b,d as y}from"./dialog-B11KBsTX.js";import{T as E,a as C,b as k,c as _,d as D,e as z}from"./table-CsU6OZj3.js";import{L as S}from"./loader-circle-CtkqxO0Y.js";import{R as $}from"./refresh-cw-D9pWF1qY.js";import{P as A}from"./plus-CmzZWZwu.js";import{V as I}from"./vote-CEooH4SU.js";import{C as L}from"./clock-CCbjQ-uW.js";import{F as T}from"./file-text-DWNOUaWS.js";import{S as V}from"./square-pen-B6Hc0Gxo.js";import{P}from"./play-bCf9bUc0.js";import{T as F}from"./trash-2-QerqEiY7.js";import{P as O}from"./pause-INPhcmeu.js";import"./charts-56rtB2he.js";function R(){a();const{toast:R}=i(),B=t(),[G,J]=s.useState([]),[q,H]=s.useState(!0),[M,U]=s.useState(!0),[W,Z]=s.useState(!1),[K,Q]=s.useState([]),[X,Y]=s.useState(null);s.useEffect(()=>{if(ee(),M){const e=setInterval(ee,5e3);return()=>clearInterval(e)}},[M]);const ee=async()=>{try{const e=await fetch("/api/elections/configs");if(e.ok){const s=await e.json();J(s)}}catch(e){R({title:"Erro",description:"Erro ao carregar configurações de nomeação",variant:"destructive"})}finally{H(!1)}},se=s=>"active"===s.election_status?e.jsxs(h,{variant:"default",className:"bg-green-500",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Ativa"]}):"draft"===s.status?e.jsxs(h,{variant:"secondary",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),"Rascunho"]}):e.jsxs(h,{variant:"outline",children:[e.jsx(O,{className:"w-3 h-3 mr-1"}),"Pausada"]}),ae=s=>s.election_status&&"active"===s.election_status?e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mb-1",children:[e.jsx("span",{children:"Nomeação em Andamento"}),e.jsx("span",{children:"Ativa"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"100%"}})})]}):null;return q?e.jsx(r,{children:e.jsxs("div",{className:"p-4 flex items-center justify-center min-h-[50vh]",children:[e.jsx(S,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Carregando configurações..."})]})}):e.jsxs(r,{children:[e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Dashboard de Nomeações"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie todas as nomeações da igreja"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>U(!M),children:[e.jsx($,{className:"h-4 w-4 mr-2 "+(M?"animate-spin":"")}),M?"Pausar":"Atualizar"]}),e.jsxs(n,{onClick:()=>B("/election-config"),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Nova Nomeação"]})]})]}),0===G.length?e.jsx(c,{children:e.jsxs(l,{className:"p-8 text-center",children:[e.jsx(I,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhuma nomeação configurada"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Configure uma nova nomeação para começar o processo de eleição de liderança."}),e.jsxs(n,{onClick:()=>B("/election-config"),children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Configurar Nomeação"]})]})}):e.jsx("div",{className:"grid gap-4",children:G.map(s=>e.jsxs(c,{className:"hover:shadow-md transition-shadow",children:[e.jsx(d,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(m,{className:"text-lg",children:s.church_name}),e.jsxs(x,{children:[s.positions.length," cargos • ",s.voters.length," votantes"]})]}),se(s)]})}),e.jsx(l,{className:"pt-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(h,{variant:"outline",className:"text-xs",children:[e.jsx(j,{className:"w-3 h-3 mr-1"}),s.voters.length," votantes"]}),e.jsxs(h,{variant:"outline",className:"text-xs",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),s.positions.length," cargos"]}),e.jsxs(h,{variant:"outline",className:"text-xs",children:[e.jsx(L,{className:"w-3 h-3 mr-1"}),new Date(s.created_at).toLocaleDateString("pt-BR")]})]}),ae(s),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:["active"===s.election_status?e.jsxs(e.Fragment,{children:[e.jsxs(n,{size:"sm",onClick:()=>B(`/election-manage/${s.id}`),className:"bg-purple-600 hover:bg-purple-700",children:[e.jsx(u,{className:"h-4 w-4 mr-2"}),"Gerenciar"]}),e.jsxs(n,{size:"sm",variant:"outline",onClick:async()=>{try{const e=await fetch(`/api/elections/dashboard/${s.id}`);if(e.ok){const s=await e.json();s.election?.id?(async e=>{try{const s=await fetch(`/api/elections/vote-log/${e}`);if(s.ok){const a=await s.json();Q(a),Y(e),Z(!0),R({title:"Log de Votos Carregado",description:`${a.length} voto(s) registrado(s)`})}else R({title:"Erro",description:"Não foi possível carregar o log de votos.",variant:"destructive"})}catch(s){R({title:"Erro",description:"Não foi possível carregar o log de votos.",variant:"destructive"})}})(s.election.id):R({title:"Erro",description:"Eleição não encontrada.",variant:"destructive"})}}catch(e){R({title:"Erro",description:"Não foi possível carregar o log.",variant:"destructive"})}},className:"bg-blue-50 hover:bg-blue-100 border-blue-200",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Ver Log de Votos"]}),e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>B(`/election-dashboard/${s.id}`),children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Acompanhar"]}),e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>B(`/election-config?id=${s.id}`),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Editar"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(n,{size:"sm",onClick:()=>(async e=>{try{const s=await fetch("/api/elections/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({configId:e})});if(s.ok)R({title:"Nomeação iniciada",description:"A nomeação foi iniciada com sucesso!"}),ee();else{const e=await s.json();if(400!==s.status||!e.error.includes("Já existe uma eleição ativa"))throw new Error("Erro ao iniciar nomeação");R({title:"Nomeação já ativa",description:"Esta configuração já possui uma eleição em andamento.",variant:"destructive"})}}catch(s){R({title:"Erro",description:"Não foi possível iniciar a nomeação.",variant:"destructive"})}})(s.id),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Iniciar"]}),e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>B(`/election-config?id=${s.id}`),children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Editar"]})]}),e.jsxs(n,{size:"sm",variant:"destructive",onClick:()=>(async e=>{if(confirm("Tem certeza que deseja excluir esta configuração? Esta ação não pode ser desfeita."))try{if(!(await fetch(`/api/elections/config/${e}`,{method:"DELETE"})).ok)throw new Error("Erro ao excluir configuração");R({title:"Configuração excluída",description:"A configuração foi excluída com sucesso!"}),ee()}catch(s){R({title:"Erro",description:"Não foi possível excluir a configuração.",variant:"destructive"})}})(s.id),children:[e.jsx(F,{className:"h-4 w-4 mr-2"}),"Excluir"]})]})]})})]},s.id))}),G.length>0&&e.jsxs(v,{children:[e.jsx(o,{className:"h-4 w-4"}),e.jsxs(p,{children:[e.jsx("strong",{children:"Múltiplas Nomeações:"})," Você pode gerenciar várias nomeações simultaneamente. Cada configuração é independente e pode estar em diferentes fases."]})]})]}),e.jsx(g,{open:W,onOpenChange:Z,children:e.jsxs(N,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(w,{children:[e.jsxs(b,{children:["Log de Votos - Eleição #",X]}),e.jsx(y,{children:"Histórico completo de todos os votos e indicações registrados nesta eleição."})]}),e.jsx("div",{className:"mt-4",children:0===K.length?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(I,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhum voto registrado ainda"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Total: ",e.jsx("strong",{children:K.length})," registro(s)"]})}),e.jsxs(E,{children:[e.jsx(C,{children:e.jsxs(k,{children:[e.jsx(_,{children:"ID"}),e.jsx(_,{children:"Votante"}),e.jsx(_,{children:"Candidato"}),e.jsx(_,{children:"Cargo"}),e.jsx(_,{children:"Tipo"}),e.jsx(_,{children:"Data/Hora"})]})}),e.jsx(D,{children:K.map(s=>e.jsxs(k,{children:[e.jsxs(z,{className:"font-mono text-xs",children:["#",s.id]}),e.jsx(z,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.voter_name||"Desconhecido"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ID: ",s.voter_id]})]})}),e.jsx(z,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.candidate_name||"Desconhecido"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ID: ",s.candidate_id]})]})}),e.jsx(z,{children:e.jsx(h,{variant:"outline",children:s.position_id})}),e.jsx(z,{children:e.jsx(h,{variant:"nomination"===s.vote_type?"secondary":"default",className:"nomination"===s.vote_type?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800",children:"nomination"===s.vote_type?"Indicação":"Voto"})}),e.jsx(z,{className:"text-xs",children:s.created_at?new Date(s.created_at).toLocaleString("pt-BR"):"-"})]},s.id))})]})]})})]})})]})}export{R as default};
