import{j as e}from"./ui-CM4P41nz.js";import{r as s}from"./vendor-v6ZOr5pf.js";import{f as a,g as i,u as t,k as r,aq as o,e as n,R as c,C as l,c as d,a as m,b as x,$ as h,B as j,U as u,E as f,G as v,a2 as p,a3 as g}from"./index-C-ln-NNw.js";import{D as N,a as w,b,c as y,d as E}from"./dialog-DfB4qMl2.js";import{T as C,a as k,b as _,c as D,d as S,e as z}from"./table-D9ftM1m1.js";import{L as $}from"./loader-circle-BpVbH2qm.js";import{P as A}from"./plus-CLjR5uTf.js";import{V as I}from"./vote-3ATmFmdM.js";import{C as T}from"./clock-C8tfTfvg.js";import{F as V}from"./file-text-BGLii7DS.js";import{S as L}from"./square-pen-67_0Ky4j.js";import{P}from"./play-1WEokGI2.js";import{T as G}from"./trash-2-BD_sjd6u.js";import{P as R}from"./pause-WS5WBfd2.js";import"./charts-56rtB2he.js";function q(){a();const{toast:q}=i(),B=t(),[F,H]=s.useState([]),[O,J]=s.useState(!0),[M,K]=s.useState(!0),[U,X]=s.useState(!1),[Q,W]=s.useState([]),[Y,Z]=s.useState(null);s.useEffect(()=>{if(ee(),M){const e=setInterval(ee,5e3);return()=>clearInterval(e)}},[M]);const ee=async()=>{try{const e=await fetch("/api/elections/configs");if(e.ok){const s=await e.json();H(s)}}catch(e){q({title:"Erro",description:"Erro ao carregar configurações de nomeação",variant:"destructive"})}finally{J(!1)}},se=s=>"active"===s.election_status?e.jsxs(j,{variant:"default",className:"bg-green-500",children:[e.jsx(P,{className:"w-3 h-3 mr-1"}),"Ativa"]}):"draft"===s.status?e.jsxs(j,{variant:"secondary",children:[e.jsx(f,{className:"w-3 h-3 mr-1"}),"Rascunho"]}):e.jsxs(j,{variant:"outline",children:[e.jsx(R,{className:"w-3 h-3 mr-1"}),"Pausada"]}),ae=s=>s.election_status&&"active"===s.election_status?e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mb-1",children:[e.jsx("span",{children:"Nomeação em Andamento"}),e.jsx("span",{children:"Ativa"})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:"100%"}})})]}):null;return O?e.jsx(r,{children:e.jsxs("div",{className:"p-4 flex items-center justify-center min-h-[50vh]",children:[e.jsx($,{className:"h-8 w-8 animate-spin"}),e.jsx("span",{className:"ml-2",children:"Carregando configurações..."})]})}):e.jsxs(r,{children:[e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(o,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Dashboard de Nomeações"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie todas as nomeações da igreja"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>K(!M),children:[e.jsx(c,{className:"h-4 w-4 mr-2 "+(M?"animate-spin":"")}),M?"Pausar":"Atualizar"]}),e.jsxs(n,{onClick:()=>B("/election-config"),className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Nova Nomeação"]})]})]}),0===F.length?e.jsx(l,{children:e.jsxs(d,{className:"p-8 text-center",children:[e.jsx(I,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Nenhuma nomeação configurada"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Configure uma nova nomeação para começar o processo de eleição de liderança."}),e.jsxs(n,{onClick:()=>B("/election-config"),children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Configurar Nomeação"]})]})}):e.jsx("div",{className:"grid gap-4",children:F.map(s=>e.jsxs(l,{className:"hover:shadow-md transition-shadow",children:[e.jsx(m,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(x,{className:"text-lg",children:s.church_name}),e.jsxs(h,{children:[s.positions.length," cargos • ",s.voters.length," votantes"]})]}),se(s)]})}),e.jsx(d,{className:"pt-0",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(j,{variant:"outline",className:"text-xs",children:[e.jsx(u,{className:"w-3 h-3 mr-1"}),s.voters.length," votantes"]}),e.jsxs(j,{variant:"outline",className:"text-xs",children:[e.jsx(I,{className:"w-3 h-3 mr-1"}),s.positions.length," cargos"]}),e.jsxs(j,{variant:"outline",className:"text-xs",children:[e.jsx(T,{className:"w-3 h-3 mr-1"}),new Date(s.created_at).toLocaleDateString("pt-BR")]})]}),ae(s),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2",children:["active"===s.election_status?e.jsxs(e.Fragment,{children:[e.jsxs(n,{size:"sm",onClick:()=>B(`/election-manage/${s.id}`),className:"bg-purple-600 hover:bg-purple-700",children:[e.jsx(f,{className:"h-4 w-4 mr-2"}),"Gerenciar"]}),e.jsxs(n,{size:"sm",variant:"outline",onClick:async()=>{try{const e=await fetch(`/api/elections/dashboard/${s.id}`);if(e.ok){const s=await e.json();s.election?.id?(async e=>{try{const s=await fetch(`/api/elections/vote-log/${e}`);if(s.ok){const a=await s.json();W(a),Z(e),X(!0),q({title:"Log de Votos Carregado",description:`${a.length} voto(s) registrado(s)`})}else q({title:"Erro",description:"Não foi possível carregar o log de votos.",variant:"destructive"})}catch(s){q({title:"Erro",description:"Não foi possível carregar o log de votos.",variant:"destructive"})}})(s.election.id):q({title:"Erro",description:"Eleição não encontrada.",variant:"destructive"})}}catch(e){q({title:"Erro",description:"Não foi possível carregar o log.",variant:"destructive"})}},className:"bg-blue-50 hover:bg-blue-100 border-blue-200",children:[e.jsx(V,{className:"h-4 w-4 mr-2"}),"Ver Log de Votos"]}),e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>B(`/election-dashboard/${s.id}`),children:[e.jsx(v,{className:"h-4 w-4 mr-2"}),"Acompanhar"]}),e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>B(`/election-config?id=${s.id}`),children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Editar"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(n,{size:"sm",onClick:()=>(async e=>{try{const s=await fetch("/api/elections/start",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({configId:e})});if(s.ok)q({title:"Nomeação iniciada",description:"A nomeação foi iniciada com sucesso!"}),ee();else{const e=await s.json();if(400!==s.status||!e.error.includes("Já existe uma eleição ativa"))throw new Error("Erro ao iniciar nomeação");q({title:"Nomeação já ativa",description:"Esta configuração já possui uma eleição em andamento.",variant:"destructive"})}}catch(s){q({title:"Erro",description:"Não foi possível iniciar a nomeação.",variant:"destructive"})}})(s.id),className:"bg-green-600 hover:bg-green-700",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Iniciar"]}),e.jsxs(n,{size:"sm",variant:"outline",onClick:()=>B(`/election-config?id=${s.id}`),children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Editar"]})]}),e.jsxs(n,{size:"sm",variant:"destructive",onClick:()=>(async e=>{if(confirm("Tem certeza que deseja excluir esta configuração? Esta ação não pode ser desfeita."))try{if(!(await fetch(`/api/elections/config/${e}`,{method:"DELETE"})).ok)throw new Error("Erro ao excluir configuração");q({title:"Configuração excluída",description:"A configuração foi excluída com sucesso!"}),ee()}catch(s){q({title:"Erro",description:"Não foi possível excluir a configuração.",variant:"destructive"})}})(s.id),children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Excluir"]})]})]})})]},s.id))}),F.length>0&&e.jsxs(p,{children:[e.jsx(o,{className:"h-4 w-4"}),e.jsxs(g,{children:[e.jsx("strong",{children:"Múltiplas Nomeações:"})," Você pode gerenciar várias nomeações simultaneamente. Cada configuração é independente e pode estar em diferentes fases."]})]})]}),e.jsx(N,{open:U,onOpenChange:X,children:e.jsxs(w,{className:"max-w-4xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(b,{children:[e.jsxs(y,{children:["Log de Votos - Eleição #",Y]}),e.jsx(E,{children:"Histórico completo de todos os votos e indicações registrados nesta eleição."})]}),e.jsx("div",{className:"mt-4",children:0===Q.length?e.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[e.jsx(I,{className:"h-12 w-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:"Nenhum voto registrado ainda"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Total: ",e.jsx("strong",{children:Q.length})," registro(s)"]})}),e.jsxs(C,{children:[e.jsx(k,{children:e.jsxs(_,{children:[e.jsx(D,{children:"ID"}),e.jsx(D,{children:"Votante"}),e.jsx(D,{children:"Candidato"}),e.jsx(D,{children:"Cargo"}),e.jsx(D,{children:"Tipo"}),e.jsx(D,{children:"Data/Hora"})]})}),e.jsx(S,{children:Q.map(s=>e.jsxs(_,{children:[e.jsxs(z,{className:"font-mono text-xs",children:["#",s.id]}),e.jsx(z,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.voter_name||"Desconhecido"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ID: ",s.voter_id]})]})}),e.jsx(z,{children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.candidate_name||"Desconhecido"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["ID: ",s.candidate_id]})]})}),e.jsx(z,{children:e.jsx(j,{variant:"outline",children:s.position_id})}),e.jsx(z,{children:e.jsx(j,{variant:"nomination"===s.vote_type?"secondary":"default",className:"nomination"===s.vote_type?"bg-blue-100 text-blue-800":"bg-green-100 text-green-800",children:"nomination"===s.vote_type?"Indicação":"Voto"})}),e.jsx(z,{className:"text-xs",children:s.created_at?new Date(s.created_at).toLocaleString("pt-BR"):"-"})]},s.id))})]})]})})]})})]})}export{q as default};
