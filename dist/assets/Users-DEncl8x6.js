import{X as e,P as s,Y as a,Z as t,_ as r,$ as i,a0 as n,j as l,k as o,b as d,a1 as c,c as m,u,e as x,A as h,d as p,g as f,a2 as j,a3 as v,a4 as g,a5 as N,a6 as b,D as y,C as w,n as C,a7 as S,a8 as D,l as E,a9 as k,aa as A,ab as P,ac as I}from"./ui-CM4P41nz.js";import{r as R}from"./vendor-v6ZOr5pf.js";import{u as O}from"./useQuery-Bh94qSNO.js";import{l as z,o as T,g as F,B as M,e as _,X as q,d as $,U as V,L as B,I as U,N as K,f as L,C as Q,c as J,F as Y,M as H,v as W,z as Z,J as G,h as X,H as ee,a as se,b as ae,p as te,q as re,r as ie,s as ne,t as le,j as oe,O as de,k as ce,D as me,w as ue,x as xe,Q as he}from"./index-xQ7CSAYI.js";import{u as pe}from"./useMutation-ftFlOHZv.js";import{u as fe,A as je}from"./useUserPoints-DtESUl4w.js";import{A as ve,a as ge,b as Ne}from"./avatar-D9H_nzHf.js";import{M as be,d as ye,e as we,f as Ce}from"./mount-icon-DKUggKtl.js";import{D as Se,a as De,b as Ee,c as ke,d as Ae,f as Pe}from"./dialog-FAhmki5l.js";import{S as Ie}from"./search-Ds2ySUSm.js";import{L as Re}from"./loader-circle-DRjRxxDk.js";import{U as Oe}from"./user-plus-B5O9ZebW.js";import{C as ze}from"./circle-x-BpeCfZ4z.js";import{S as Te}from"./square-check-big-DFwF8NZZ.js";import{T as Fe}from"./trash-2-N19Nn4A8.js";import{C as Me}from"./clock-xEfMAGrT.js";import{M as _e}from"./map-pin-0-CeOMP3.js";import{T as qe}from"./textarea-MRPZ5StH.js";import{G as $e,M as Ve}from"./mountain-VPMhpyUk.js";import{T as Be}from"./triangle-alert-60f-q1QH.js";import{S as Ue}from"./square-pen-BPja__5c.js";import{S as Ke}from"./shield-CQQ4pdjx.js";import{U as Le}from"./user-check-D7DJEuYi.js";import"./charts-56rtB2he.js";import"./pointsCalculator-BwBrJ8sV.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=z("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),Je=z("Briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]),Ye=z("ChevronsUpDown",[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]]),He=z("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),We=z("GraduationCap",[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]]),Ze=z("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ge=.999,Xe=/[\\\/_+.#"@\[\(\{&]/,es=/[\\\/_+.#"@\[\(\{&]/g,ss=/[\s-]/,as=/[\s-]/g;function ts(e,s,a,t,r,i,n){if(i===s.length)return r===e.length?1:.99;var l=`${r},${i}`;if(void 0!==n[l])return n[l];for(var o,d,c,m,u=t.charAt(i),x=a.indexOf(u,r),h=0;x>=0;)(o=ts(e,s,a,t,x+1,i+1,n))>h&&(x===r?o*=1:Xe.test(e.charAt(x-1))?(o*=.8,(c=e.slice(r,x-1).match(es))&&r>0&&(o*=Math.pow(Ge,c.length))):ss.test(e.charAt(x-1))?(o*=.9,(m=e.slice(r,x-1).match(as))&&r>0&&(o*=Math.pow(Ge,m.length))):(o*=.17,r>0&&(o*=Math.pow(Ge,x-r))),e.charAt(x)!==s.charAt(i)&&(o*=.9999)),(o<.1&&a.charAt(x-1)===t.charAt(i+1)||t.charAt(i+1)===t.charAt(i)&&a.charAt(x-1)!==t.charAt(i))&&(.1*(d=ts(e,s,a,t,x+1,i+2,n))>o&&(o=.1*d)),o>h&&(h=o),x=a.indexOf(u,x+1);return n[l]=h,h}function rs(e){return e.toLowerCase().replace(as," ")}function is(e,s,a){return ts(e=a&&a.length>0?""+(e+" "+a.join(" ")):e,s,rs(e),rs(s),0,0,{})}var ns='[cmdk-group=""]',ls='[cmdk-group-items=""]',os='[cmdk-item=""]',ds=`${os}:not([aria-disabled="true"])`,cs="cmdk-item-select",ms="data-value",us=(e,s,a)=>is(e,s,a),xs=R.createContext(void 0),hs=()=>R.useContext(xs),ps=R.createContext(void 0),fs=()=>R.useContext(ps),js=R.createContext(void 0),vs=R.forwardRef((a,t)=>{let r=Rs(()=>{var e,s;return{search:"",value:null!=(s=null!=(e=a.value)?e:a.defaultValue)?s:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),i=Rs(()=>new Set),n=Rs(()=>new Map),l=Rs(()=>new Map),o=Rs(()=>new Set),d=Ps(a),{label:c,children:m,value:u,onValueChange:x,filter:h,shouldFilter:p,loop:f,disablePointerSelection:j=!1,vimBindings:v=!0,...g}=a,N=e(),b=e(),y=e(),w=R.useRef(null),C=Ts();Is(()=>{if(void 0!==u){let e=u.trim();r.current.value=e,S.emit()}},[u]),Is(()=>{C(6,I)},[]);let S=R.useMemo(()=>({subscribe:e=>(o.current.add(e),()=>o.current.delete(e)),snapshot:()=>r.current,setState:(e,s,a)=>{var t,i,n,l;if(!Object.is(r.current[e],s)){if(r.current[e]=s,"search"===e)P(),k(),C(1,A);else if("value"===e){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let e=document.getElementById(y);e?e.focus():null==(t=document.getElementById(N))||t.focus()}if(C(7,()=>{var e;r.current.selectedItemId=null==(e=O())?void 0:e.id,S.emit()}),a||C(5,I),void 0!==(null==(i=d.current)?void 0:i.value)){let e=null!=s?s:"";return void(null==(l=(n=d.current).onValueChange)||l.call(n,e))}}S.emit()}},emit:()=>{o.current.forEach(e=>e())}}),[]),D=R.useMemo(()=>({value:(e,s,a)=>{var t;s!==(null==(t=l.current.get(e))?void 0:t.value)&&(l.current.set(e,{value:s,keywords:a}),r.current.filtered.items.set(e,E(s,a)),C(2,()=>{k(),S.emit()}))},item:(e,s)=>(i.current.add(e),s&&(n.current.has(s)?n.current.get(s).add(e):n.current.set(s,new Set([e]))),C(3,()=>{P(),k(),r.current.value||A(),S.emit()}),()=>{l.current.delete(e),i.current.delete(e),r.current.filtered.items.delete(e);let s=O();C(4,()=>{P(),(null==s?void 0:s.getAttribute("id"))===e&&A(),S.emit()})}),group:e=>(n.current.has(e)||n.current.set(e,new Set),()=>{l.current.delete(e),n.current.delete(e)}),filter:()=>d.current.shouldFilter,label:c||a["aria-label"],getDisablePointerSelection:()=>d.current.disablePointerSelection,listId:N,inputId:y,labelId:b,listInnerRef:w}),[]);function E(e,s){var a,t;let i=null!=(t=null==(a=d.current)?void 0:a.filter)?t:us;return e?i(e,r.current.search,s):0}function k(){if(!r.current.search||!1===d.current.shouldFilter)return;let e=r.current.filtered.items,s=[];r.current.filtered.groups.forEach(a=>{let t=n.current.get(a),r=0;t.forEach(s=>{let a=e.get(s);r=Math.max(a,r)}),s.push([a,r])});let a=w.current;z().sort((s,a)=>{var t,r;let i=s.getAttribute("id"),n=a.getAttribute("id");return(null!=(t=e.get(n))?t:0)-(null!=(r=e.get(i))?r:0)}).forEach(e=>{let s=e.closest(ls);s?s.appendChild(e.parentElement===s?e:e.closest(`${ls} > *`)):a.appendChild(e.parentElement===a?e:e.closest(`${ls} > *`))}),s.sort((e,s)=>s[1]-e[1]).forEach(e=>{var s;let a=null==(s=w.current)?void 0:s.querySelector(`${ns}[${ms}="${encodeURIComponent(e[0])}"]`);null==a||a.parentElement.appendChild(a)})}function A(){let e=z().find(e=>"true"!==e.getAttribute("aria-disabled")),s=null==e?void 0:e.getAttribute(ms);S.setState("value",s||void 0)}function P(){var e,s,a,t;if(!r.current.search||!1===d.current.shouldFilter)return void(r.current.filtered.count=i.current.size);r.current.filtered.groups=new Set;let o=0;for(let n of i.current){let i=E(null!=(s=null==(e=l.current.get(n))?void 0:e.value)?s:"",null!=(t=null==(a=l.current.get(n))?void 0:a.keywords)?t:[]);r.current.filtered.items.set(n,i),i>0&&o++}for(let[i,l]of n.current)for(let e of l)if(r.current.filtered.items.get(e)>0){r.current.filtered.groups.add(i);break}r.current.filtered.count=o}function I(){var e,s,a;let t=O();t&&((null==(e=t.parentElement)?void 0:e.firstChild)===t&&(null==(a=null==(s=t.closest(ns))?void 0:s.querySelector('[cmdk-group-heading=""]'))||a.scrollIntoView({block:"nearest"})),t.scrollIntoView({block:"nearest"}))}function O(){var e;return null==(e=w.current)?void 0:e.querySelector(`${os}[aria-selected="true"]`)}function z(){var e;return Array.from((null==(e=w.current)?void 0:e.querySelectorAll(ds))||[])}function T(e){let s=z()[e];s&&S.setState("value",s.getAttribute(ms))}function F(e){var s;let a=O(),t=z(),r=t.findIndex(e=>e===a),i=t[r+e];null!=(s=d.current)&&s.loop&&(i=r+e<0?t[t.length-1]:r+e===t.length?t[0]:t[r+e]),i&&S.setState("value",i.getAttribute(ms))}function M(e){let s,a=O(),t=null==a?void 0:a.closest(ns);for(;t&&!s;)t=e>0?ks(t,ns):As(t,ns),s=null==t?void 0:t.querySelector(ds);s?S.setState("value",s.getAttribute(ms)):F(e)}let _=()=>T(z().length-1),q=e=>{e.preventDefault(),e.metaKey?_():e.altKey?M(1):F(1)},$=e=>{e.preventDefault(),e.metaKey?T(0):e.altKey?M(-1):F(-1)};return R.createElement(s.div,{ref:t,tabIndex:-1,...g,"cmdk-root":"",onKeyDown:e=>{var s;null==(s=g.onKeyDown)||s.call(g,e);let a=e.nativeEvent.isComposing||229===e.keyCode;if(!e.defaultPrevented&&!a)switch(e.key){case"n":case"j":v&&e.ctrlKey&&q(e);break;case"ArrowDown":q(e);break;case"p":case"k":v&&e.ctrlKey&&$(e);break;case"ArrowUp":$(e);break;case"Home":e.preventDefault(),T(0);break;case"End":e.preventDefault(),_();break;case"Enter":{e.preventDefault();let s=O();if(s){let e=new Event(cs);s.dispatchEvent(e)}}}}},R.createElement("label",{"cmdk-label":"",htmlFor:D.inputId,id:D.labelId,style:Ms},c),Fs(a,e=>R.createElement(ps.Provider,{value:S},R.createElement(xs.Provider,{value:D},e))))}),gs=R.forwardRef((a,t)=>{var r,i;let l=e(),o=R.useRef(null),d=R.useContext(js),c=hs(),m=Ps(a),u=null!=(i=null==(r=m.current)?void 0:r.forceMount)?i:null==d?void 0:d.forceMount;Is(()=>{if(!u)return c.item(l,null==d?void 0:d.id)},[u]);let x=zs(l,o,[a.value,a.children,o],a.keywords),h=fs(),p=Os(e=>e.value&&e.value===x.current),f=Os(e=>!(!u&&!1!==c.filter())||(!e.search||e.filtered.items.get(l)>0));function j(){var e,s;v(),null==(s=(e=m.current).onSelect)||s.call(e,x.current)}function v(){h.setState("value",x.current,!0)}if(R.useEffect(()=>{let e=o.current;if(e&&!a.disabled)return e.addEventListener(cs,j),()=>e.removeEventListener(cs,j)},[f,a.onSelect,a.disabled]),!f)return null;let{disabled:g,value:N,onSelect:b,forceMount:y,keywords:w,...C}=a;return R.createElement(s.div,{ref:n(o,t),...C,id:l,"cmdk-item":"",role:"option","aria-disabled":!!g,"aria-selected":!!p,"data-disabled":!!g,"data-selected":!!p,onPointerMove:g||c.getDisablePointerSelection()?void 0:v,onClick:g?void 0:j},a.children)}),Ns=R.forwardRef((a,t)=>{let{heading:r,children:i,forceMount:l,...o}=a,d=e(),c=R.useRef(null),m=R.useRef(null),u=e(),x=hs(),h=Os(e=>!(!l&&!1!==x.filter())||(!e.search||e.filtered.groups.has(d)));Is(()=>x.group(d),[]),zs(d,c,[a.value,a.heading,m]);let p=R.useMemo(()=>({id:d,forceMount:l}),[l]);return R.createElement(s.div,{ref:n(c,t),...o,"cmdk-group":"",role:"presentation",hidden:!h||void 0},r&&R.createElement("div",{ref:m,"cmdk-group-heading":"","aria-hidden":!0,id:u},r),Fs(a,e=>R.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":r?u:void 0},R.createElement(js.Provider,{value:p},e))))}),bs=R.forwardRef((e,a)=>{let{alwaysRender:t,...r}=e,i=R.useRef(null),l=Os(e=>!e.search);return t||l?R.createElement(s.div,{ref:n(i,a),...r,"cmdk-separator":"",role:"separator"}):null}),ys=R.forwardRef((e,a)=>{let{onValueChange:t,...r}=e,i=null!=e.value,n=fs(),l=Os(e=>e.search),o=Os(e=>e.selectedItemId),d=hs();return R.useEffect(()=>{null!=e.value&&n.setState("search",e.value)},[e.value]),R.createElement(s.input,{ref:a,...r,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":d.listId,"aria-labelledby":d.labelId,"aria-activedescendant":o,id:d.inputId,type:"text",value:i?e.value:l,onChange:e=>{i||n.setState("search",e.target.value),null==t||t(e.target.value)}})}),ws=R.forwardRef((e,a)=>{let{children:t,label:r="Suggestions",...i}=e,l=R.useRef(null),o=R.useRef(null),d=Os(e=>e.selectedItemId),c=hs();return R.useEffect(()=>{if(o.current&&l.current){let e,s=o.current,a=l.current,t=new ResizeObserver(()=>{e=requestAnimationFrame(()=>{let e=s.offsetHeight;a.style.setProperty("--cmdk-list-height",e.toFixed(1)+"px")})});return t.observe(s),()=>{cancelAnimationFrame(e),t.unobserve(s)}}},[]),R.createElement(s.div,{ref:n(l,a),...i,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":d,"aria-label":r,id:c.listId},Fs(e,e=>R.createElement("div",{ref:n(o,c.listInnerRef),"cmdk-list-sizer":""},e)))}),Cs=R.forwardRef((e,s)=>{let{open:n,onOpenChange:l,overlayClassName:o,contentClassName:d,container:c,...m}=e;return R.createElement(a,{open:n,onOpenChange:l},R.createElement(t,{container:c},R.createElement(r,{"cmdk-overlay":"",className:o}),R.createElement(i,{"aria-label":e.label,"cmdk-dialog":"",className:d},R.createElement(vs,{ref:s,...m}))))}),Ss=R.forwardRef((e,a)=>Os(e=>0===e.filtered.count)?R.createElement(s.div,{ref:a,...e,"cmdk-empty":"",role:"presentation"}):null),Ds=R.forwardRef((e,a)=>{let{progress:t,children:r,label:i="Loading...",...n}=e;return R.createElement(s.div,{ref:a,...n,"cmdk-loading":"",role:"progressbar","aria-valuenow":t,"aria-valuemin":0,"aria-valuemax":100,"aria-label":i},Fs(e,e=>R.createElement("div",{"aria-hidden":!0},e)))}),Es=Object.assign(vs,{List:ws,Item:gs,Input:ys,Group:Ns,Separator:bs,Dialog:Cs,Empty:Ss,Loading:Ds});function ks(e,s){let a=e.nextElementSibling;for(;a;){if(a.matches(s))return a;a=a.nextElementSibling}}function As(e,s){let a=e.previousElementSibling;for(;a;){if(a.matches(s))return a;a=a.previousElementSibling}}function Ps(e){let s=R.useRef(e);return Is(()=>{s.current=e}),s}var Is="undefined"==typeof window?R.useEffect:R.useLayoutEffect;function Rs(e){let s=R.useRef();return void 0===s.current&&(s.current=e()),s}function Os(e){let s=fs(),a=()=>e(s.snapshot());return R.useSyncExternalStore(s.subscribe,a,a)}function zs(e,s,a,t=[]){let r=R.useRef(),i=hs();return Is(()=>{var n;let l=(()=>{var e;for(let s of a){if("string"==typeof s)return s.trim();if("object"==typeof s&&"current"in s)return s.current?null==(e=s.current.textContent)?void 0:e.trim():r.current}})(),o=t.map(e=>e.trim());i.value(e,l,o),null==(n=s.current)||n.setAttribute(ms,l),r.current=l}),r}var Ts=()=>{let[e,s]=R.useState(),a=Rs(()=>new Map);return Is(()=>{a.current.forEach(e=>e()),a.current=new Map},[e]),(e,t)=>{a.current.set(e,t),s({})}};function Fs({asChild:e,children:s},a){return e&&R.isValidElement(s)?R.cloneElement(function(e){let s=e.type;return"function"==typeof s?s(e.props):"render"in s?s.render(e.props):e}(s),{ref:s.ref},a(s.props.children)):a(s)}var Ms={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const _s=R.forwardRef(({className:e,...s},a)=>l.jsx(Es,{ref:a,className:T("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...s}));_s.displayName=Es.displayName;const qs=R.forwardRef(({className:e,...s},a)=>l.jsxs("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[l.jsx(Ie,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),l.jsx(Es.Input,{ref:a,className:T("flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...s})]}));qs.displayName=Es.Input.displayName;const $s=R.forwardRef(({className:e,...s},a)=>l.jsx(Es.List,{ref:a,className:T("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...s}));$s.displayName=Es.List.displayName;const Vs=R.forwardRef((e,s)=>l.jsx(Es.Empty,{ref:s,className:"py-6 text-center text-sm",...e}));Vs.displayName=Es.Empty.displayName;const Bs=R.forwardRef(({className:e,...s},a)=>l.jsx(Es.Group,{ref:a,className:T("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...s}));Bs.displayName=Es.Group.displayName;R.forwardRef(({className:e,...s},a)=>l.jsx(Es.Separator,{ref:a,className:T("-mx-1 h-px bg-border",e),...s})).displayName=Es.Separator.displayName;const Us=R.forwardRef(({className:e,...s},a)=>l.jsx(Es.Item,{ref:a,className:T("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50",e),...s}));Us.displayName=Es.Item.displayName;var Ks="Popover",[Ls,Qs]=m(Ks,[o]),Js=o(),[Ys,Hs]=Ls(Ks),Ws=s=>{const{__scopePopover:a,children:t,open:r,defaultOpen:i,onOpenChange:n,modal:o=!1}=s,m=Js(a),u=R.useRef(null),[x,h]=R.useState(!1),[p,f]=d({prop:r,defaultProp:i??!1,onChange:n,caller:Ks});return l.jsx(c,{...m,children:l.jsx(Ys,{scope:a,contentId:e(),triggerRef:u,open:p,onOpenChange:f,onOpenToggle:R.useCallback(()=>f(e=>!e),[f]),hasCustomAnchor:x,onCustomAnchorAdd:R.useCallback(()=>h(!0),[]),onCustomAnchorRemove:R.useCallback(()=>h(!1),[]),modal:o,children:t})})};Ws.displayName=Ks;var Zs="PopoverAnchor";R.forwardRef((e,s)=>{const{__scopePopover:a,...t}=e,r=Hs(Zs,a),i=Js(a),{onCustomAnchorAdd:n,onCustomAnchorRemove:o}=r;return R.useEffect(()=>(n(),()=>o()),[n,o]),l.jsx(h,{...i,...t,ref:s})}).displayName=Zs;var Gs="PopoverTrigger",Xs=R.forwardRef((e,a)=>{const{__scopePopover:t,...r}=e,i=Hs(Gs,t),n=Js(t),o=u(a,i.triggerRef),d=l.jsx(s.button,{type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":ma(i.open),...r,ref:o,onClick:x(e.onClick,i.onOpenToggle)});return i.hasCustomAnchor?d:l.jsx(h,{asChild:!0,...n,children:d})});Xs.displayName=Gs;var ea="PopoverPortal",[sa,aa]=Ls(ea,{forceMount:void 0}),ta=e=>{const{__scopePopover:s,forceMount:a,children:t,container:r}=e,i=Hs(ea,s);return l.jsx(sa,{scope:s,forceMount:a,children:l.jsx(p,{present:a||i.open,children:l.jsx(f,{asChild:!0,container:r,children:t})})})};ta.displayName=ea;var ra="PopoverContent",ia=R.forwardRef((e,s)=>{const a=aa(ra,e.__scopePopover),{forceMount:t=a.forceMount,...r}=e,i=Hs(ra,e.__scopePopover);return l.jsx(p,{present:t||i.open,children:i.modal?l.jsx(la,{...r,ref:s}):l.jsx(oa,{...r,ref:s})})});ia.displayName=ra;var na=g("PopoverContent.RemoveScroll"),la=R.forwardRef((e,s)=>{const a=Hs(ra,e.__scopePopover),t=R.useRef(null),r=u(s,t),i=R.useRef(!1);return R.useEffect(()=>{const e=t.current;if(e)return j(e)},[]),l.jsx(v,{as:na,allowPinchZoom:!0,children:l.jsx(da,{...e,ref:r,trapFocus:a.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:x(e.onCloseAutoFocus,e=>{e.preventDefault(),i.current||a.triggerRef.current?.focus()}),onPointerDownOutside:x(e.onPointerDownOutside,e=>{const s=e.detail.originalEvent,a=0===s.button&&!0===s.ctrlKey,t=2===s.button||a;i.current=t},{checkForDefaultPrevented:!1}),onFocusOutside:x(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})})}),oa=R.forwardRef((e,s)=>{const a=Hs(ra,e.__scopePopover),t=R.useRef(!1),r=R.useRef(!1);return l.jsx(da,{...e,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{e.onCloseAutoFocus?.(s),s.defaultPrevented||(t.current||a.triggerRef.current?.focus(),s.preventDefault()),t.current=!1,r.current=!1},onInteractOutside:s=>{e.onInteractOutside?.(s),s.defaultPrevented||(t.current=!0,"pointerdown"===s.detail.originalEvent.type&&(r.current=!0));const i=s.target,n=a.triggerRef.current?.contains(i);n&&s.preventDefault(),"focusin"===s.detail.originalEvent.type&&r.current&&s.preventDefault()}})}),da=R.forwardRef((e,s)=>{const{__scopePopover:a,trapFocus:t,onOpenAutoFocus:r,onCloseAutoFocus:i,disableOutsidePointerEvents:n,onEscapeKeyDown:o,onPointerDownOutside:d,onFocusOutside:c,onInteractOutside:m,...u}=e,x=Hs(ra,a),h=Js(a);return N(),l.jsx(b,{asChild:!0,loop:!0,trapped:t,onMountAutoFocus:r,onUnmountAutoFocus:i,children:l.jsx(y,{asChild:!0,disableOutsidePointerEvents:n,onInteractOutside:m,onEscapeKeyDown:o,onPointerDownOutside:d,onFocusOutside:c,onDismiss:()=>x.onOpenChange(!1),children:l.jsx(w,{"data-state":ma(x.open),role:"dialog",id:x.contentId,...h,...u,ref:s,style:{...u.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),ca="PopoverClose";R.forwardRef((e,a)=>{const{__scopePopover:t,...r}=e,i=Hs(ca,t);return l.jsx(s.button,{type:"button",...r,ref:a,onClick:x(e.onClick,()=>i.onOpenChange(!1))})}).displayName=ca;function ma(e){return e?"open":"closed"}R.forwardRef((e,s)=>{const{__scopePopover:a,...t}=e,r=Js(a);return l.jsx(C,{...r,...t,ref:s})}).displayName="PopoverArrow";var ua=ta,xa=ia;const ha=Ws,pa=Xs,fa=R.forwardRef(({className:e,align:s="center",sideOffset:a=4,...t},r)=>l.jsx(ua,{children:l.jsx(xa,{ref:r,align:s,sideOffset:a,className:T("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...t})}));function ja({interestedId:e,currentDiscipuladores:s,onDiscipuladoresChange:a}){const[t,r]=R.useState([]),[i,n]=R.useState(!1),[o,d]=R.useState(!1),[c,m]=R.useState(!1),[u,x]=R.useState(null),{toast:h}=F();R.useEffect(()=>{p()},[]);const p=async()=>{d(!0);try{const e=await fetch("/api/users");if(!e.ok)throw new Error("Erro ao carregar usuários");const a=await e.json(),t=s.map(e=>e.id),i=a.filter(e=>(e.role.includes("member")||e.role.includes("missionary"))&&!t.includes(e.id));r(i)}catch(e){h({title:"Erro",description:"Não foi possível carregar a lista de membros",variant:"destructive"})}finally{d(!1)}},f=R.useCallback(async i=>{m(!0);try{const l=await fetch("/api/relationships",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({interestedId:e,missionaryId:i,status:"active"})});if(!l.ok)throw new Error("Erro ao adicionar discipulador");const o=await l.json(),d=t.find(e=>e.id===i);if(d){const e=[...s,{id:i,name:d.name,relationshipId:o.id}];a(e),r(e=>e.filter(e=>e.id!==i))}h({title:"Sucesso",description:"Discipulador adicionado com sucesso"}),n(!1)}catch(l){h({title:"Erro",description:"Não foi possível adicionar o discipulador",variant:"destructive"})}finally{m(!1)}},[e,t,s,a,h]),j=R.useCallback(async e=>{x(e);try{if(!(await fetch(`/api/relationships/${e}`,{method:"DELETE"})).ok)throw new Error("Erro ao remover discipulador");const t=s.filter(s=>s.relationshipId!==e);a(t),h({title:"Sucesso",description:"Discipulador removido com sucesso"}),p()}catch(t){h({title:"Erro",description:"Não foi possível remover o discipulador",variant:"destructive"})}finally{x(null)}},[s,a,h]);return 0===s.length?l.jsx("div",{className:"flex items-center justify-start py-2",children:l.jsx("span",{className:"text-sm text-gray-500",children:"Nenhum discipulador atribuído"})}):l.jsxs("div",{className:"space-y-2",children:[l.jsx("div",{className:"flex flex-wrap gap-1 justify-start",children:s.map(e=>l.jsxs(M,{variant:"secondary",className:"text-xs px-2 py-1 bg-blue-50 text-blue-700 border-blue-200",children:[e.name,l.jsx(_,{size:"sm",variant:"ghost",className:"h-4 w-4 p-0 ml-1 hover:bg-blue-100",onClick:()=>j(e.relationshipId),disabled:u===e.relationshipId,children:u===e.relationshipId?l.jsx(Re,{className:"h-3 w-3 animate-spin"}):l.jsx(q,{className:"h-3 w-3"})})]},e.id))}),l.jsx(Se,{open:i,onOpenChange:n,children:l.jsxs(De,{className:"w-[95vw] max-w-[840px] max-h-[85vh] flex flex-col p-0 overflow-hidden",children:[l.jsx("div",{className:"p-6 pb-0",children:l.jsxs(Ee,{children:[l.jsx(ke,{children:"Adicionar Discipulador"}),l.jsx(Ae,{children:"Selecione um membro para ser o discipulador deste interessado."})]})}),l.jsx("div",{className:"flex-1 min-h-0 px-6 py-4",children:o?l.jsxs("div",{className:"flex items-center justify-center py-8",children:[l.jsx(Re,{className:"h-6 w-6 animate-spin"}),l.jsx("span",{className:"ml-2",children:"Carregando membros..."})]}):l.jsxs(_s,{className:"h-full",children:[l.jsx(qs,{placeholder:"Buscar membros...",id:"search-members",name:"search-members",className:"border-0 focus:ring-0"}),l.jsxs($s,{className:"max-h-[350px] overflow-auto",children:[l.jsx(Vs,{children:"Nenhum membro disponível."}),l.jsx(Bs,{children:t.map(e=>l.jsxs(Us,{value:e.name,onSelect:()=>f(e.id),disabled:c,className:"flex items-center justify-between px-3 py-2 rounded-md hover:bg-accent",children:[l.jsxs("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[l.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:l.jsx("span",{className:"text-sm font-medium text-blue-600",children:e.name.charAt(0).toUpperCase()})}),l.jsxs("div",{className:"min-w-0 flex-1 overflow-hidden",children:[l.jsx("div",{className:"font-medium truncate text-sm",children:e.name}),l.jsx("div",{className:"text-xs text-muted-foreground truncate",children:e.email})]})]}),c&&l.jsx(Re,{className:"h-4 w-4 animate-spin flex-shrink-0 ml-2"})]},e.id))})]})]})}),l.jsx("div",{className:"p-6 pt-0",children:l.jsx(Pe,{className:"flex justify-end",children:l.jsx(_,{variant:"outline",onClick:()=>n(!1),children:"Cancelar"})})})]})})]})}function va({interestedId:e,currentDiscipuladores:s,onDiscipuladoresChange:a}){const[t,r]=R.useState(!1),[i,n]=R.useState([]),[o,d]=R.useState(!1),[c,m]=R.useState(!1),{toast:u}=F();R.useEffect(()=>{t&&x()},[t]);const x=async()=>{d(!0);try{const e=await fetch("/api/users");if(!e.ok)throw new Error("Erro ao carregar usuários");const s=(await e.json()).filter(e=>e.role.includes("member")||e.role.includes("missionary"));n(s)}catch(e){u({title:"Erro",description:"Não foi possível carregar a lista de membros",variant:"destructive"})}finally{d(!1)}},h=R.useCallback(async t=>{m(!0);try{const n=await fetch("/api/relationships",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({interestedId:e,missionaryId:t,status:"active"})});if(!n.ok)throw new Error("Erro ao adicionar discipulador");const l=await n.json(),o=i.find(e=>e.id===t);if(o){const e=[...s,{id:t,name:o.name,relationshipId:l.id}];a(e)}u({title:"Sucesso",description:"Discipulador adicionado com sucesso"}),r(!1)}catch(n){u({title:"Erro",description:"Não foi possível adicionar o discipulador",variant:"destructive"})}finally{m(!1)}},[e,i,s,a,u]);return l.jsxs(l.Fragment,{children:[l.jsx(_,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-full border border-blue-200",onClick:e=>{e.stopPropagation(),r(!0)},title:"Adicionar discipulador",children:l.jsx(Oe,{className:"h-3 w-3"})}),l.jsx(Se,{open:t,onOpenChange:r,children:l.jsxs(De,{className:"w-[95vw] max-w-[840px] max-h-[85vh] flex flex-col p-0 overflow-hidden",children:[l.jsx("div",{className:"p-6 pb-0",children:l.jsxs(Ee,{children:[l.jsx(ke,{children:"Adicionar Discipulador"}),l.jsx(Ae,{children:"Selecione um membro para ser o discipulador deste interessado."})]})}),l.jsx("div",{className:"flex-1 min-h-0 px-6 py-4",children:o?l.jsxs("div",{className:"flex items-center justify-center py-8",children:[l.jsx(Re,{className:"h-6 w-6 animate-spin"}),l.jsx("span",{className:"ml-2",children:"Carregando membros..."})]}):l.jsxs(_s,{className:"h-full",children:[l.jsx(qs,{placeholder:"Buscar membros...",id:"search-members",name:"search-members",className:"border-0 focus:ring-0"}),l.jsxs($s,{className:"max-h-[350px] overflow-auto",children:[l.jsx(Vs,{children:"Nenhum membro encontrado."}),l.jsx(Bs,{children:i.map(e=>l.jsxs(Us,{value:e.name,onSelect:()=>h(e.id),disabled:c,className:"flex items-center justify-between px-3 py-2 rounded-md hover:bg-accent",children:[l.jsxs("div",{className:"flex items-center space-x-3 min-w-0 flex-1",children:[l.jsx("div",{className:"w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center flex-shrink-0",children:l.jsx("span",{className:"text-sm font-medium text-blue-600",children:e.name.charAt(0).toUpperCase()})}),l.jsxs("div",{className:"min-w-0 flex-1 overflow-hidden",children:[l.jsx("div",{className:"font-medium truncate text-sm",children:e.name}),l.jsx("div",{className:"text-xs text-muted-foreground truncate",children:e.email})]})]}),c&&l.jsx(Re,{className:"h-4 w-4 animate-spin flex-shrink-0 ml-2"})]},e.id))})]})]})}),l.jsx("div",{className:"p-6 pt-0",children:l.jsx(Pe,{className:"flex justify-end",children:l.jsx(_,{variant:"outline",onClick:()=>r(!1),children:"Cancelar"})})})]})})]})}fa.displayName=xa.displayName;const ga=({isOpen:e,onClose:s,onConfirm:a,userName:t,isLoading:r=!1,visitCount:i=0,lastVisitDate:n})=>{const[o,d]=R.useState("");R.useEffect(()=>{if(e){const e=new Date((new Date).toLocaleString("en-US",{timeZone:"America/Sao_Paulo"})),s=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),t=String(e.getDate()).padStart(2,"0");d(`${s}-${a}-${t}`)}},[e]);const c=0===i,m=i>0;return l.jsx(Se,{open:e,onOpenChange:e=>!e&&s(),children:l.jsxs(De,{className:"sm:max-w-md","aria-describedby":"mark-visit-modal-description",children:[l.jsx("div",{id:"mark-visit-modal-description",className:"sr-only",children:c?"Formulário para registrar primeira visita realizada":"Formulário para registrar nova visita realizada"}),l.jsx(Ee,{children:l.jsxs(ke,{className:"flex items-center gap-2",children:[l.jsx($,{className:"h-5 w-5 text-blue-600"}),c?"Registrar Primeira Visita Realizada":"Registrar Nova Visita Realizada"]})}),l.jsxs("div",{className:"space-y-4",children:[l.jsx("div",{className:"text-sm text-muted-foreground",children:c?`Confirmar que a primeira visita ao membro <strong>${t}</strong> foi realizada.`:`Confirmar que uma nova visita ao membro <strong>${t}</strong> foi realizada.`}),m&&l.jsxs("div",{className:"p-3 bg-blue-50 rounded-lg border border-blue-200",children:[l.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[l.jsx(V,{className:"h-4 w-4 text-blue-600"}),l.jsx("span",{className:"text-sm font-medium text-blue-800",children:"Histórico de Visitas"})]}),l.jsxs("div",{className:"space-y-1 text-xs text-blue-700",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{children:"Total de visitas:"}),l.jsxs(M,{variant:"secondary",className:"bg-blue-100 text-blue-700",children:[i," visita",i>1?"s":""]})]}),n&&l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("span",{children:"Última visita:"}),l.jsx("span",{className:"font-medium",children:(e=>{if(!e)return"";try{let s;return s=e.includes("T")||e.includes("Z")?new Date(e):new Date(e+"T00:00:00-03:00"),isNaN(s.getTime())?"Data inválida":s.toLocaleDateString("pt-BR")}catch(s){return"Data inválida"}})(n)})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"visit-date",children:c?"Data da Primeira Visita Realizada":"Data da Nova Visita Realizada"}),l.jsx(U,{id:"visit-date",type:"date",value:o,onChange:e=>d(e.target.value),className:"w-full",max:(new Date).toISOString().split("T")[0]}),l.jsx("p",{className:"text-xs text-muted-foreground",children:c?"Esta será a primeira visita realizada registrada para este membro.":"Esta visita realizada será adicionada ao histórico existente."})]}),l.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[l.jsxs(_,{variant:"outline",onClick:()=>{d(""),s()},disabled:r,children:[l.jsx(ze,{className:"h-4 w-4 mr-2"}),"Cancelar"]}),l.jsxs(_,{onClick:()=>{o&&a(o)},disabled:!o||r,className:"bg-green-600 hover:bg-green-700",children:[l.jsx(K,{className:"h-4 w-4 mr-2"}),r?"Confirmando...":c?"Confirmar Primeira Visita Realizada":"Confirmar Nova Visita Realizada"]})]})]})]})})};function Na({user:e,onClick:s,onApprove:a,onReject:t,onEdit:r,onDelete:i,onView:n,onScheduleVisit:o,onDiscipleRequest:d,showActions:c=!0,relationshipsData:m=[],potentialMissionaries:u=[],hasPendingDiscipleRequest:x=!1}){const[h,p]=R.useState(e),[f,j]=R.useState(!1),[v,g]=R.useState(!1),[N,b]=R.useState(!1),[y,w]=R.useState(!1),[C,S]=R.useState([]),[D,E]=R.useState(!1),[k,A]=R.useState(h.interestedSituation||""),[P,I]=R.useState(null),[O,z]=R.useState([]),{toast:q}=F(),{user:V}=L(),B=[{value:"new",label:"Novo Interessado",description:"Primeiro contato"},{value:"contacted",label:"Contatado",description:"Já foi contatado"},{value:"meeting_scheduled",label:"Reunião Agendada",description:"Reunião marcada"},{value:"meeting_done",label:"Reunião Realizada",description:"Primeira reunião feita"},{value:"follow_up",label:"Acompanhamento",description:"Em processo de discipulado"},{value:"baptized",label:"Batizado",description:"Já foi batizado"},{value:"member",label:"Membro",description:"Tornou-se membro da igreja"},{value:"inactive",label:"Inativo",description:"Não responde mais"},{value:"rejected",label:"Rejeitou",description:"Não tem interesse"}];R.useEffect(()=>{p(e)},[e]),R.useEffect(()=>{h?.id&&"admin"===V?.role&&(async()=>{try{const e=await fetch(`/api/spiritual-check-in/${h.id}`);if(e.ok){const s=await e.json();I(s)}}catch(e){}})()},[h?.id,V?.role]),R.useEffect(()=>{if(m&&"interested"===h.role){const e=m.filter(e=>e.interestedId===h.id&&"active"===e.status).map(e=>({id:e.missionaryId,name:e.missionaryName||"Usuário não encontrado",relationshipId:e.id}));z(e)}},[m,h.id,h.role]);const U=e=>{z(e)},se=()=>h.photo?h.photo.startsWith("http")?h.photo:`/uploads/${h.photo}`:"",ae=async()=>{if(!f){j(!0);try{const e=await fetch(`/api/users/${h.id}/visit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitDate:(new Date).toISOString().split("T")[0]})});if(!e.ok)throw new Error("Erro ao marcar visita");{const s=await e.json();p(e=>({...e,extraData:{...e.extraData,...s.extraData}})),q({title:"Visita marcada!",description:`Visita registrada para ${h.name}`})}}catch(e){q({title:"Erro",description:"Não foi possível marcar a visita. Tente novamente.",variant:"destructive"})}finally{j(!1)}}},te=()=>h.extraData?.visited||!1,re=()=>h.extraData?.visitCount||0,ie=()=>h.extraData?.lastVisitDate,ne=e=>new Date(e).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"});return l.jsxs(Q,{className:`cursor-pointer transition-all duration-200 hover:shadow-md border-l-4 ${"admin"===h.role?"border-l-blue-500":h.role.includes("missionary")?"border-l-purple-500":h.role.includes("member")?"border-l-green-500":"border-l-orange-500"} ${te()?"bg-green-50 border-green-200":"bg-white"}`,onClick:s,children:[l.jsxs(J,{className:"p-3 sm:p-4",children:[l.jsx("div",{className:"flex flex-col sm:flex-row gap-2 sm:gap-4",children:l.jsxs("div",{className:"flex items-start gap-3 sm:gap-4 flex-1 min-w-0",children:[l.jsx("div",{className:"flex-shrink-0",children:l.jsxs(ve,{className:"h-10 w-10 sm:h-12 sm:w-12 cursor-pointer hover:ring-2 hover:ring-blue-500 transition-all duration-200",onClick:e=>{e.stopPropagation(),"admin"===V?.role&&b(!0)},children:[l.jsx(ge,{src:se(),alt:h.name}),l.jsx(Ne,{className:"text-sm sm:text-lg font-semibold",children:(()=>{if(!h.name||"string"!=typeof h.name)return"U";const e=h.name.split(" ");return 1===e.length?e[0][0].toUpperCase():(e[0][0]+e[e.length-1][0]).toUpperCase()})()})]})}),l.jsxs("div",{className:"flex-1 min-w-0",children:[l.jsxs("div",{className:"flex items-center justify-between gap-2",children:[l.jsx("h3",{className:"text-base sm:text-lg font-semibold text-foreground truncate flex-1","data-testid":`text-name-${h.id}`,children:h.name||"Usuário sem nome"}),c&&l.jsxs("div",{className:"flex items-center gap-1",onClick:e=>e.stopPropagation(),children:[l.jsx(_,{size:"sm",variant:"ghost",disabled:f,className:`h-7 transition-all duration-200 rounded-full ${te()?"text-green-600 hover:text-green-700 bg-green-50 hover:bg-green-100 border border-green-200":"text-blue-600 hover:text-blue-700 hover:bg-blue-50 border border-blue-200"} ${f?"opacity-50 cursor-not-allowed":""} ${te()&&re()>1?"px-2":"w-7 px-0"}`,onClick:e=>{e.stopPropagation(),te()?g(!0):ae()},title:te()?"🖱️ Clique: atualizar data da visita":"Marcar visita como realizada",children:f?l.jsx("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-current"}):te()?l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(Te,{className:"h-3 w-3"}),re()>1&&l.jsxs("span",{className:"text-[10px] font-medium",children:[re(),"x"]})]}):l.jsx(Ze,{className:"h-3 w-3"})}),l.jsx(_,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-green-600 hover:text-green-700 hover:bg-green-50 rounded-full border border-green-200",onClick:e=>{e.stopPropagation(),n?.()},title:"Visualizar detalhes",children:l.jsx(Y,{className:"h-3 w-3"})}),"interested"===h.role&&l.jsx(va,{interestedId:h.id,currentDiscipuladores:O,onDiscipuladoresChange:U}),l.jsx(_,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-purple-600 hover:text-purple-700 hover:bg-purple-50 rounded-full border border-purple-200",onClick:e=>{e.stopPropagation(),o?.()},title:"Agendar visita futura",children:l.jsx($,{className:"h-3 w-3"})}),(e=>{if(!e)return!1;const s=e.replace(/\D/g,"");return s.length>=10&&s.length<=15})(h.phone)&&l.jsx(_,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-green-600 hover:text-green-700 hover:bg-green-50 rounded-full border border-green-200",onClick:e=>{e.stopPropagation(),(()=>{if(!h.phone)return;const e=`https://wa.me/55${h.phone.replace(/\D/g,"")}`;window.open(e,"_blank")})()},title:"Enviar WhatsApp",children:l.jsx(H,{className:"h-3 w-3"})}),l.jsx(_,{size:"sm",variant:"ghost",className:"h-7 w-7 p-0 text-red-600 hover:text-red-700 hover:bg-red-50 rounded-full border border-red-200",onClick:e=>{e.stopPropagation(),i?.()},title:"Excluir usuário",children:l.jsx(Fe,{className:"h-3 w-3"})})]})]}),l.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-2 mt-2",children:["admin"===h.role&&l.jsx(M,{variant:"outline",className:"text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 bg-blue-100 text-blue-700 border-blue-300",children:"Admin"}),h.role.includes("member")&&l.jsx(M,{variant:"outline",className:"text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 bg-green-100 text-green-700 border-green-300",children:"Membro"}),h.role.includes("missionary")&&l.jsx(M,{variant:"outline",className:"text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 bg-purple-100 text-purple-700 border-purple-300",children:"Missionário"}),"interested"===h.role&&l.jsx(M,{variant:"outline",className:"text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 bg-orange-100 text-orange-700 border-orange-300",children:"Interessado"}),l.jsx(M,{variant:"outline",className:"text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 "+("approved"===h.status?"bg-green-100 text-green-700 border-green-300":"pending"===h.status?"bg-yellow-100 text-yellow-700 border-yellow-300":"bg-red-100 text-red-700 border-red-300"),children:"approved"===h.status?"Aprovado":"pending"===h.status?"Pendente":"Rejeitado"}),"interested"===h.role&&x&&l.jsxs(M,{variant:"outline",className:"text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5 bg-blue-100 text-blue-700 border-blue-300 cursor-pointer hover:bg-blue-200 transition-colors",onClick:e=>{e.stopPropagation(),d?.()},title:"Clique para autorizar discipulado",children:[l.jsx(Me,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 mr-0.5 sm:mr-1"}),l.jsx("span",{className:"hidden sm:inline",children:"Autorizar"}),l.jsx("span",{className:"sm:hidden",children:"Auth"})]})]})]})]})}),l.jsxs("div",{className:"mt-2 space-y-1.5 sm:space-y-1 text-xs sm:text-sm text-muted-foreground",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(W,{className:"h-3 w-3"}),l.jsx("span",{className:"truncate","data-testid":`text-first-access-${h.id}`,children:l.jsx("strong",{children:(e=>{if(!e)return"usuario";const s=e.trim().split(/\s+/);if(1===s.length)return s[0].toLowerCase();const a=s[0].toLowerCase(),t=s[s.length-1].toLowerCase();return`${a.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,"")}.${t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-z0-9]/g,"")}`})(h.name)})})]}),"interested"===h.role&&l.jsx("div",{className:"mt-1 flex items-center justify-start",children:l.jsx(ja,{interestedId:h.id,currentDiscipuladores:O,onDiscipuladoresChange:U})}),l.jsxs("div",{className:"space-y-1",children:[h.phone&&l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(Z,{className:"h-3 w-3 flex-shrink-0"}),l.jsx("span",{className:"truncate","data-testid":`text-phone-${h.id}`,children:h.phone})]}),h.church&&l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(_e,{className:"h-3 w-3 flex-shrink-0"}),l.jsx("span",{className:"truncate","data-testid":`text-church-${h.id}`,children:h.church})]}),h.address&&l.jsxs("div",{className:"flex items-start gap-1",children:[l.jsx(_e,{className:"h-3 w-3 mt-0.5 flex-shrink-0"}),l.jsx("div",{className:"flex-1 min-w-0",children:l.jsx("div",{className:"text-xs sm:text-sm text-muted-foreground break-words","data-testid":`text-address-${h.id}`,children:h.address})})]})]}),"interested"===h.role&&l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsxs(ha,{open:D,children:[l.jsx(pa,{asChild:!0,children:l.jsxs(_,{variant:"outline",role:"combobox","aria-expanded":D,className:"w-[200px] justify-between text-xs h-7",onClick:e=>{e.stopPropagation(),E(!D)},children:[k?B.find(e=>e.value===k)?.label:"Selecionar situação...",l.jsx(Ye,{className:"ml-2 h-3 w-3 shrink-0 opacity-50"})]})}),l.jsxs(fa,{className:"w-64 p-0 z-50",side:"bottom",align:"start",children:[l.jsxs("div",{className:"flex justify-between items-center p-2 border-b",children:[l.jsx("span",{className:"text-sm font-medium",children:"Selecionar Situação"}),l.jsx(_,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0",onClick:()=>E(!1),children:"✕"})]}),l.jsxs(_s,{children:[l.jsx(qs,{placeholder:"Buscar situação...",className:"h-8",id:"situation-search",name:"situation-search"}),l.jsx(Vs,{children:"Nenhuma situação encontrada."}),l.jsx(Bs,{children:l.jsx($s,{children:B.map(e=>l.jsxs(Us,{value:e.value,onSelect:e=>{(async e=>{try{if(!(await fetch(`/api/users/${h.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({interestedSituation:e})})).ok)throw new Error("Erro ao atualizar situação");p(s=>({...s,interestedSituation:e})),A(e),E(!1),q({title:"Situação atualizada!",description:`Situação do interessado atualizada para: ${B.find(s=>s.value===e)?.label}`})}catch(s){q({title:"Erro",description:"Não foi possível atualizar a situação. Tente novamente.",variant:"destructive"})}})(e)},className:"text-xs",children:[l.jsx(G,{className:T("mr-2 h-3 w-3",k===e.value?"opacity-100":"opacity-0")}),l.jsxs("div",{className:"flex flex-col",children:[l.jsx("span",{className:"font-medium",children:e.label}),l.jsx("span",{className:"text-xs text-muted-foreground",children:e.description})]})]},e.value))})})]})]})]}),l.jsx(M,{variant:"outline",className:"text-[10px] px-1.5 py-0.5 bg-blue-100 text-blue-700 border-blue-300",children:h.interestedSituation||"Não definida"})]}),l.jsxs("div",{className:"flex items-center gap-2 mt-1.5 pt-1.5 border-t border-gray-100",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(X,{className:"h-3 w-3 text-yellow-500"}),l.jsxs("span",{className:"text-[10px] sm:text-xs font-medium",children:[void 0!==h.calculatedPoints?h.calculatedPoints:h.points||0," pts"]})]}),l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(be,{iconType:ye(void 0!==h.calculatedPoints?h.calculatedPoints:h.points||0),className:"h-3 w-3"}),l.jsx("span",{className:"text-[10px] sm:text-xs font-medium",title:Ce(void 0!==h.calculatedPoints?h.calculatedPoints:h.points||0),children:we(void 0!==h.calculatedPoints?h.calculatedPoints:h.points||0)})]})]}),"admin"===V?.role&&l.jsxs("div",{className:"flex items-center gap-2 mt-1.5 pt-1.5 border-t border-gray-100",children:[l.jsxs("div",{className:"flex items-center gap-1",children:[l.jsx(ee,{className:"h-3 w-3 text-pink-500"}),l.jsx("span",{className:"text-[10px] sm:text-xs font-medium",children:"Check-in Espiritual:"})]}),P&&P.checkIns&&P.checkIns.length>0?l.jsx("div",{className:"flex items-center gap-1",children:(()=>{const e=P.checkIns[0],s=(e=>{switch(e){case 1:return{emoji:"🍃",label:"Distante",color:"bg-red-100 text-red-700"};case 2:return{emoji:"🔍",label:"Buscando",color:"bg-orange-100 text-orange-700"};case 3:return{emoji:"🌱",label:"Enraizando",color:"bg-yellow-100 text-yellow-700"};case 4:return{emoji:"🌳",label:"Frutificando",color:"bg-blue-100 text-blue-700"};case 5:return{emoji:"✨",label:"Intimidade",color:"bg-green-100 text-green-700"};default:return{emoji:"❓",label:"Sem check-in",color:"bg-gray-100 text-gray-600"}}})(e.score);return l.jsxs(l.Fragment,{children:[l.jsx("span",{className:"text-sm sm:text-lg",children:s.emoji}),l.jsx(M,{className:`${s.color} text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5`,children:s.label}),e.notes&&l.jsxs("div",{className:"flex items-center gap-1 ml-1 sm:ml-2",children:[l.jsx(H,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3 text-blue-500"}),l.jsx("span",{className:"text-[10px] sm:text-xs text-blue-600",children:"Com observações"})]})]})})()}):l.jsx(M,{className:"bg-gray-100 text-gray-600 text-[10px] sm:text-xs px-1.5 sm:px-2 py-0.5",children:"Sem check-in"})]}),te()&&l.jsxs("div",{className:"mt-1.5 flex items-center gap-2 text-[10px] sm:text-xs",children:[l.jsxs("div",{className:"flex items-center gap-1 text-green-600",children:[l.jsx(K,{className:"h-2.5 w-2.5 sm:h-3 sm:w-3"}),l.jsx("span",{children:"Visitado"})]}),re()>1&&l.jsxs(M,{variant:"secondary",className:"text-[10px] sm:text-xs px-1 py-0 bg-green-100 text-green-700",children:[re()," visitas"]}),ie()&&l.jsxs("span",{className:"text-muted-foreground",children:["Última: ",ne(ie())]})]})]})]}),l.jsx(ga,{isOpen:v,onClose:()=>g(!1),onConfirm:async e=>{try{const s=await fetch(`/api/users/${h.id}/visit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitDate:e})});if(!s.ok)throw new Error("Erro ao marcar visita");{const e=await s.json();p(s=>({...s,extraData:{...s.extraData,...e.extraData}})),g(!1),q({title:"Visita marcada!",description:`Visita registrada para ${h.name}`})}}catch(s){q({title:"Erro",description:"Não foi possível marcar a visita. Tente novamente.",variant:"destructive"})}},userName:h.name,isLoading:f,visitCount:re(),lastVisitDate:ie()}),l.jsx(Se,{open:N,onOpenChange:b,children:l.jsxs(De,{className:"max-w-md",children:[l.jsxs(Ee,{children:[l.jsx(ke,{children:"Foto de Perfil"}),l.jsxs(Ae,{children:["Foto de perfil de ",h.name]})]}),se()?l.jsx("div",{className:"flex justify-center",children:l.jsx("img",{src:se(),alt:h.name,className:"max-w-full max-h-96 object-contain rounded-lg"})}):l.jsx("div",{className:"text-sm text-muted-foreground",children:"Este usuário ainda não possui foto de perfil."})]})}),l.jsx(Se,{open:y,onOpenChange:w,children:l.jsxs(De,{className:"max-w-md",children:[l.jsxs(Ee,{children:[l.jsx(ke,{children:"Histórico de Visitas"}),l.jsxs(Ae,{children:["Histórico de visitas para ",h.name]})]}),l.jsx("div",{className:"space-y-4",children:C.length>0?l.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:C.map((e,s)=>l.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),l.jsxs("span",{className:"text-sm font-medium",children:["Visita #",C.length-s]})]}),l.jsx("div",{className:"text-sm text-muted-foreground",children:ne(e.visit_date)})]},e.id||s))}):l.jsx("div",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhuma visita registrada ainda."})})]})})]})}const ba=({user:e,isOpen:s,onClose:a,onUpdate:t})=>{const[r,i]=R.useState({}),[n,o]=R.useState({}),[d,c]=R.useState(!1);if(!e)return null;const m=(e,s)=>{i(s=>({...s,[e]:!0})),o(a=>({...a,[e]:s}))},u=(s,a,u,x="text",h)=>{const p=r[s],f=p?n[s]:u;return p?l.jsxs("div",{className:"space-y-2",children:[l.jsx("label",{className:"text-sm font-medium",children:a}),l.jsxs("div",{className:"flex gap-2",children:["textarea"===x?l.jsx(qe,{value:f||"",onChange:e=>o(a=>({...a,[s]:e.target.value})),className:"flex-1",rows:3}):"select"===x?l.jsxs(te,{value:f||"",onValueChange:e=>o(a=>({...a,[s]:e})),children:[l.jsx(re,{className:"flex-1",children:l.jsx(ie,{placeholder:"Selecione..."})}),l.jsx(ne,{children:h?.map(e=>l.jsx(le,{value:e,children:e},e))})]}):l.jsx(U,{value:f||"",onChange:e=>o(a=>({...a,[s]:e.target.value})),className:"flex-1"}),l.jsx(_,{size:"sm",variant:"ghost",onClick:()=>(async s=>{const a=n[s];c(!0);try{await t(e.id,{[s]:a}),i(e=>({...e,[s]:!1})),o(e=>{const a={...e};return delete a[s],a})}catch(r){}finally{c(!1)}})(s),disabled:d,className:"h-8 w-8 p-0 text-green-600 hover:text-green-700",children:l.jsx(G,{className:"h-4 w-4"})}),l.jsx(_,{size:"sm",variant:"ghost",onClick:()=>(e=>{i(s=>({...s,[e]:!1})),o(s=>{const a={...s};return delete a[e],a})})(s),disabled:d,className:"h-8 w-8 p-0 text-red-600 hover:text-red-700",children:l.jsx(q,{className:"h-4 w-4"})})]})]}):l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsx("label",{className:"text-sm font-medium",children:a}),l.jsx(_,{size:"sm",variant:"ghost",onClick:()=>m(s,u),className:"h-6 w-6 p-0 text-blue-600 hover:text-blue-700",children:l.jsx(Ue,{className:"h-3 w-3"})})]}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:u||"Não informado"})]})},x=e=>{if(!e)return null;try{const s=e.toString().trim().replace(/['"]/g,"");if(!isNaN(e)&&"number"==typeof e){const s=new Date(1900,0,1),a=e-2,t=new Date(s.getTime()+24*a*60*60*1e3);if(!isNaN(t.getTime())&&t.getFullYear()>1900)return t}if(s.includes("/")){const e=s.split("/");if(3===e.length){const[s,a,t]=e,r=parseInt(s),i=parseInt(a);let n=parseInt(t);if(n<100&&(n+=n<50?2e3:1900),r>=1&&r<=31&&i>=1&&i<=12&&n>=1900&&n<=2100){const e=new Date(n,i-1,r);if(e.getDate()===r&&e.getMonth()===i-1&&e.getFullYear()===n)return e}}}if(s.includes("-")&&s.match(/^\d{1,2}-\d{1,2}-\d{4}$/)){const e=s.split("-"),[a,t,r]=e,i=parseInt(a),n=parseInt(t),l=parseInt(r);if(i>=1&&i<=31&&n>=1&&n<=12&&l>=1900&&l<=2100){const e=new Date(l,n-1,i);if(e.getDate()===i&&e.getMonth()===n-1&&e.getFullYear()===l)return e}}if(s.match(/^\d{4}-\d{2}-\d{2}$/)){const e=new Date(s);if(!isNaN(e.getTime())&&e.getFullYear()>1900)return e}if(s.match(/^\d{4}\/\d{2}\/\d{2}$/)){const e=s.split("/"),[a,t,r]=e,i=parseInt(a),n=parseInt(t),l=parseInt(r);if(i>=1900&&i<=2100&&n>=1&&n<=12&&l>=1&&l<=31){const e=new Date(i,n-1,l);if(e.getDate()===l&&e.getMonth()===n-1&&e.getFullYear()===i)return e}}if(s.includes(".")&&s.match(/^\d{1,2}\.\d{1,2}\.\d{4}$/)){const e=s.split("."),[a,t,r]=e,i=parseInt(a),n=parseInt(t),l=parseInt(r);if(i>=1&&i<=31&&n>=1&&n<=12&&l>=1900&&l<=2100){const e=new Date(l,n-1,i);if(e.getDate()===i&&e.getMonth()===n-1&&e.getFullYear()===l)return e}}if(s.includes(".")&&s.match(/^\d{1,2}\.\d{1,2}\.\d{2}$/)){const e=s.split("."),[a,t,r]=e,i=parseInt(a),n=parseInt(t);let l=parseInt(r);if(l+=l<50?2e3:1900,i>=1&&i<=31&&n>=1&&n<=12&&l>=1900&&l<=2100){const e=new Date(l,n-1,i);if(e.getDate()===i&&e.getMonth()===n-1&&e.getFullYear()===l)return e}}if(s.includes("-")&&s.includes("/")){const e=s.match(/^(\d{1,2}\/\d{1,2})-\d{1,2}\/\d{1,2}\/(\d{4})$/);if(e){const s=e[1]+"/"+e[2];return x(s)}}if(s.includes("-")&&s.includes("/")&&!s.match(/\d{4}/)){const e=s.match(/^(\d{1,2}\/\d{1,2})-\d{1,2}\/\d{1,2}$/);if(e){const s=(new Date).getFullYear(),a=e[1]+"/"+s;return x(a)}}if(s.match(/^\d{1,2}\/\d{1,2}$/)){const e=(new Date).getFullYear();return x(s+"/"+e)}const a=new Date(e);return!isNaN(a.getTime())&&a.getFullYear()>1900?a:null}catch(s){return null}},h=e=>{if(!e)return"Não informado";const s=x(e);return s?Math.floor(((new Date).getTime()-s.getTime())/315576e5)+" anos":"Não informado"},p=e=>{if(!e)return"Não informado";const s=x(e);return s?s.toLocaleDateString("pt-BR"):"Não informado"},f=(()=>{try{const s=e.extra_data||e.extraData;return s&&"string"==typeof s?JSON.parse(s):s&&"object"==typeof s?s:{}}catch(s){return{}}})(),j=e=>{switch(e){case"admin":return"Administrador";case"missionary":return"Missionário";case"member":return"Membro";case"interested":return"Interessado";default:return"Desconhecido"}},v=e=>{switch(e){case"single":return"Solteiro(a)";case"married":return"Casado(a)";case"divorced":return"Divorciado(a)";case"widowed":return"Viúvo(a)";default:return"Não informado"}},g=()=>e.departments?"string"==typeof e.departments?e.departments.split(",").map(e=>e.trim()).filter(e=>e):Array.isArray(e.departments)?e.departments:[]:[],N=()=>{try{if(e.extraData&&"string"==typeof e.extraData){const s=JSON.parse(e.extraData);return s.phoneWarning?{hasWarning:!0,originalPhone:s.originalPhone}:{hasWarning:!1}}return{hasWarning:!1}}catch{return{hasWarning:!1}}};return l.jsx(Se,{open:s,onOpenChange:e=>!e&&a(),children:l.jsxs(De,{className:"max-w-6xl max-h-[90vh] overflow-y-auto",children:[l.jsxs(Ee,{children:[l.jsx("div",{className:"flex items-center justify-between",children:l.jsxs(ke,{className:"flex items-center gap-3",children:[l.jsxs(ve,{className:"h-12 w-12",children:[l.jsx(ge,{src:e.profilePhoto}),l.jsx(Ne,{className:"bg-primary text-primary-foreground",children:e.name?.charAt(0)||"U"})]}),l.jsxs("div",{children:[l.jsx("div",{className:"text-xl font-bold",children:e.name}),l.jsx("div",{className:"text-sm text-muted-foreground",children:e.email})]}),l.jsx(M,{variant:"outline",className:"ml-2",children:j(e.role)})]})}),l.jsx(Ae,{children:"Informações detalhadas do membro"})]}),l.jsxs("div",{className:"space-y-6",children:[l.jsxs(Q,{className:"shadow-divine",children:[l.jsx(se,{children:l.jsxs(ae,{className:"flex items-center gap-2",children:[l.jsx(W,{className:"h-5 w-5"}),"Informações Básicas"]})}),l.jsx(J,{children:l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[l.jsx("div",{children:u("church","Igreja",e.church)}),l.jsx("div",{children:u("name","Nome",e.name)}),l.jsx("div",{children:u("church_code","Código",e.church_code||e.churchCode)}),l.jsxs("div",{children:[l.jsx("div",{className:"flex items-center justify-between",children:l.jsx("label",{className:"text-sm font-medium",children:"Tipo"})}),l.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:l.jsx(M,{variant:"secondary",children:j(e.role)})})]}),l.jsx("div",{children:u("extraData.sexo","Sexo",f.sexo)}),l.jsxs("div",{children:[l.jsx("div",{className:"flex items-center justify-between",children:l.jsx("label",{className:"text-sm font-medium",children:"Idade"})}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.idade||(e=>{if(!e)return"Não informado";const s=x(e);return s?Math.floor(((new Date).getTime()-s.getTime())/315576e5)+" anos":"Não informado"})(e.birth_date||e.birthDate)})]}),l.jsxs("div",{children:[l.jsx("div",{className:"flex items-center justify-between",children:l.jsx("label",{className:"text-sm font-medium",children:"Nascimento"})}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:(e=>{if(!e)return"Não informado";const s=x(e);return s?s.toLocaleDateString("pt-BR"):"Não informado"})(e.birth_date||e.birthDate)})]}),l.jsx("div",{children:u("engajamento","Engajamento",e.engajamento)}),l.jsx("div",{children:u("classificacao","Classificação",e.classificacao)}),l.jsxs("div",{children:[l.jsx("div",{className:"flex items-center justify-between",children:l.jsx("label",{className:"text-sm font-medium",children:"Estado Civil"})}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:v(e.civil_status||e.civilStatus)})]}),l.jsxs("div",{children:[l.jsx("div",{className:"flex items-center justify-between",children:l.jsx("label",{className:"text-sm font-medium",children:"Ocupação"})}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.occupation||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("div",{className:"flex items-center justify-between",children:l.jsx("label",{className:"text-sm font-medium",children:"Educação"})}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.education||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("div",{className:"flex items-center justify-between",children:l.jsx("label",{className:"text-sm font-medium",children:"Status"})}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:l.jsx(M,{variant:"approved"===e.status?"default":"secondary",children:"approved"===e.status?"Aprovado":"pending"===e.status?"Pendente":"Recusado"})})]})]})})]}),l.jsxs(Q,{className:"shadow-divine",children:[l.jsx(se,{children:l.jsxs(ae,{className:"flex items-center gap-2",children:[l.jsx($e,{className:"h-5 w-5"}),"Dízimos e Ofertas"]})}),l.jsx(J,{children:l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Classificação"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.level||"Iniciante"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Dizimista"}),l.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:l.jsx(M,{variant:e.is_donor||e.isDonor?"default":"secondary",children:e.dizimista_type||(e.is_donor||e.isDonor?"Sim":"Não")})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"É Dizimista (DB)"}),l.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:l.jsx(M,{variant:e.is_tither||e.isTither?"default":"secondary",children:e.is_tither||e.isTither?"Sim":"Não"})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"É Doador"}),l.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:l.jsx(M,{variant:e.is_donor||e.isDonor?"default":"secondary",children:e.is_donor||e.isDonor?"Sim":"Não"})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Dízimos - 12m"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.dizimos12m||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Último dízimo - 12m"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:p(f.ultimoDizimo)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Valor dízimo - 12m"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.valorDizimo||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Número de meses s/ dizimar"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.numeroMesesSemDizimar||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Dizimista antes do últ. dízimo"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.dizimistaAntesUltimoDizimo||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Ofertante"}),l.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:l.jsx(M,{variant:e.isOffering?"default":"secondary",children:e.ofertante_type||(e.isOffering?"Sim":"Não")})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Ofertas - 12m"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.ofertas12m||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Última oferta - 12m"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:p(f.ultimaOferta)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Valor oferta - 12m"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.valorOferta||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Número de meses s/ ofertar"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.numeroMesesSemOfertar||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Ofertante antes da últ. oferta"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.ofertanteAntesUltimaOferta||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Último movimento"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.ultimoMovimento||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Data do último movimento"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:p(f.dataUltimoMovimento)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Tipo de entrada"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.tipoEntrada||"Não informado"})]})]})})]}),l.jsxs(Q,{className:"shadow-divine",children:[l.jsx(se,{children:l.jsxs(ae,{className:"flex items-center gap-2",children:[l.jsx(ee,{className:"h-5 w-5"}),"Batismo e Vida Espiritual"]})}),l.jsx(J,{children:l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Tempo de batismo"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:h(e.baptism_date||e.baptismDate)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Batismo"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:p(e.baptism_date||e.baptismDate)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Tempo de batismo"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.tempoBatismo||h(e.baptism_date||e.baptismDate)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Localidade do batismo"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.localidadeBatismo||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Batizado por"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.batizadoPor||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Idade no Batismo"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.idadeBatismo||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Tempo de batismo - anos"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:h(e.baptism_date||e.baptismDate)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Religião anterior"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.previousReligion||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Como conheceu a IASD"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.comoConheceu||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Fator decisivo"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.fatorDecisivo||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Como estudou a Bíblia"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.comoEstudou||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Tipo de Entrada"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.tipoEntrada||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Instrutor bíblico"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.biblicalInstructor||f.instrutorBiblico||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Instrutor bíblico 2"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.instrutorBiblico2||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Tem cargo"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.temCargo||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Teen"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.teen||"Não informado"})]}),l.jsxs("div",{className:"md:col-span-2",children:[l.jsx("label",{className:"text-sm font-medium",children:"Departamentos e cargos"}),l.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:g().length>0?g().map((e,s)=>l.jsx(M,{variant:"secondary","data-testid":`badge-department-${s}`,children:e},s)):l.jsx("span",{className:"text-sm text-muted-foreground",children:"Nenhum departamento"})})]})]})})]}),l.jsxs(Q,{className:"shadow-divine",children:[l.jsx(se,{children:l.jsxs(ae,{className:"flex items-center gap-2",children:[l.jsx(V,{className:"h-5 w-5"}),"Informações Familiares"]})}),l.jsx(J,{children:l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Nome da mãe"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.nomeMae||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Nome do pai"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.nomePai||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Estado civil"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:v(e.civilStatus)})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Data de casamento"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:p(f.dataCasamento)})]})]})})]}),l.jsxs(Q,{className:"shadow-divine",children:[l.jsx(se,{children:l.jsxs(ae,{className:"flex items-center gap-2",children:[l.jsx(We,{className:"h-5 w-5"}),"Educação e Profissão"]})}),l.jsx(J,{children:l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Grau de educação"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.education||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Ocupação"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.occupation||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Endereço Completo"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.address||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Religião Anterior"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.previous_religion||e.previousReligion||("Família/parentes"===f.comoConheceu?"Nenhuma":"Não informado")})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Instrutor Bíblico"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.biblical_instructor||e.biblicalInstructor||f.batizadoPor||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Primeiro Acesso"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:l.jsx(M,{variant:e.first_access||e.firstAccess?"default":"secondary",children:e.first_access||e.firstAccess?"Sim":"Não"})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Aluno educação Adv."}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.alunoEducacao||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Parentesco p/ c/ aluno"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.parentesco||"Não informado"})]})]})})]}),l.jsxs(Q,{className:"shadow-divine",children:[l.jsx(se,{children:l.jsxs(ae,{className:"flex items-center gap-2",children:[l.jsx(Z,{className:"h-5 w-5"}),"Contato e Endereço"]})}),l.jsx(J,{children:l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[l.jsxs("div",{children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("label",{className:"text-sm font-medium flex items-center gap-2",children:["Celular",N().hasWarning&&l.jsx(Be,{className:"h-4 w-4 text-yellow-500"})]}),l.jsx(_,{size:"sm",variant:"ghost",onClick:()=>m("phone",e.phone),className:"h-6 w-6 p-0 text-blue-600 hover:text-blue-700",children:l.jsx(Ue,{className:"h-3 w-3"})})]}),l.jsxs("div",{children:[l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.phone||"Não informado"}),N().hasWarning&&l.jsxs("div",{className:"flex items-center gap-2 mt-1 p-2 bg-yellow-50 dark:bg-yellow-900/20 rounded-md",children:[l.jsx(Be,{className:"h-4 w-4 text-yellow-600"}),l.jsxs("div",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:[l.jsx("strong",{children:"Telefone original:"})," ",N().originalPhone,l.jsx("br",{}),l.jsx("span",{className:"text-muted-foreground",children:"Telefone muito curto durante a importação"})]})]})]})]}),l.jsx("div",{children:u("email","Email",e.email)}),l.jsx("div",{children:u("extraData.cidadeEstado","Cidade e Estado",f.cidadeEstado)}),l.jsx("div",{children:u("extraData.bairro","Bairro",f.bairro)}),l.jsx("div",{className:"md:col-span-2",children:u("address","Endereço",e.address,"textarea")}),l.jsx("div",{children:u("extraData.cidadeNascimento","Cidade de nascimento",f.cidadeNascimento)}),l.jsx("div",{children:u("extraData.estadoNascimento","Estado de nascimento",f.estadoNascimento)}),l.jsx("div",{children:u("cpf","CPF",e.cpf)}),l.jsxs("div",{children:[l.jsx("div",{className:"flex items-center justify-between",children:l.jsx("label",{className:"text-sm font-medium",children:"CPF válido"})}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:l.jsx(M,{variant:e.cpf_valido?"default":"secondary",children:e.cpf_valido?"Sim":"Não"})})]})]})})]}),l.jsxs(Q,{className:"shadow-divine",children:[l.jsx(se,{children:l.jsxs(ae,{className:"flex items-center gap-2",children:[l.jsx(X,{className:"h-5 w-5"}),"Escola Sabatina"]})}),l.jsx(J,{children:l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Nome da unidade"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.nome_unidade||f.cidadeEstado||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Matriculado na ES"}),l.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:l.jsx(M,{variant:e.isEnrolledES?"default":"secondary",children:e.isEnrolledES?"Sim":"Não"})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Tem lição"}),l.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:l.jsx(M,{variant:e.tem_licao||e.hasLesson?"default":"secondary",children:e.tem_licao||e.hasLesson?"Sim":"Não"})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Período ES"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.esPeriod||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Comunhão"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.comunhao??"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Missão"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.missao??"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Estudo bíblico"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.estudo_biblico??"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Batizou alguém"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.batizou_alguem?"Sim":"Não"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Disc. pós batismal"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.disc_pos_batismal??"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Total presença no cartão"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.presencaTotal||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Presença no quiz local"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.presencaQuizLocal||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Presença no quiz outra unidade"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.presencaQuizOutraUnidade||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Presença no quiz online"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.presencaQuizOnline||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Total de presença"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.total_presenca??e.attendance??0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Teve participação"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.teveParticipacao||"Não informado"})]})]})})]}),l.jsxs(Q,{className:"shadow-divine",children:[l.jsx(se,{children:l.jsxs(ae,{className:"flex items-center gap-2",children:[l.jsx(Je,{className:"h-5 w-5"}),"Colaboração e Outros"]})}),l.jsx(J,{children:l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Campo - colaborador"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.campoColaborador||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Área - colaborador"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.areaColaborador||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Estabelecimento - colaborador"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.estabelecimentoColaborador||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Função - colaborador"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.funcaoColaborador||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Campos vazios/inválidos"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:l.jsx(M,{variant:e.campos_vazios?"destructive":"default",children:e.campos_vazios?"Tem campos vazios":"Completo"})})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Nome dos campos vazios no ACMS"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.nomeCamposVazios||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Pontos"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.points||0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Nível"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.level||"Iniciante"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Frequência"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.attendance||0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Pontuação"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:e.points||0})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Código (extra)"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.codigo||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Bairro"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.bairro||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Cidade/Estado"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.cidadeEstado||"Não informado"})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Valor Dízimo"}),l.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f.valorDizimo?`R$ ${f.valorDizimo}`:"Não informado"})]})]})})]}),e.observations&&l.jsxs(Q,{className:"shadow-divine",children:[l.jsx(se,{children:l.jsxs(ae,{className:"flex items-center gap-2",children:[l.jsx(Be,{className:"h-5 w-5"}),"Observações"]})}),l.jsx(J,{children:l.jsx("p",{className:"text-sm text-muted-foreground",children:e.observations})})]})]}),l.jsx("div",{className:"flex justify-end gap-2 mt-6",children:l.jsxs(_,{variant:"outline",onClick:a,"data-testid":"button-close",children:[l.jsx(q,{className:"h-4 w-4 mr-2"}),"Fechar"]})})]})})},ya=({user:e,isOpen:s,onClose:a,onUpdate:t})=>{const{toast:r}=F(),i=oe(),[n,o]=R.useState({name:e?.name||"",email:e?.email||"",phone:e?.phone||"",role:e?.role||"interested",status:e?.status||"pending",church:e?.church||"",birthDate:e?.birthDate?new Date(e.birthDate).toISOString().split("T")[0]:"",civilStatus:e?.civilStatus||"",occupation:e?.occupation||"",education:e?.education||"",address:e?.address||"",observations:e?.observations||""}),d=pe({mutationFn:({userId:e,data:s})=>fetch(`/api/users/${e}`,{method:"PUT",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then(e=>e.json()),onSuccess:()=>{i.invalidateQueries({queryKey:["/api/users"]}),window.dispatchEvent(new CustomEvent("user-updated")),r({title:"Usuário atualizado",description:"As informações do usuário foram atualizadas com sucesso."}),a()},onError:()=>{r({title:"Erro",description:"Erro ao atualizar usuário. Tente novamente.",variant:"destructive"})}}),c=(e,s)=>{o(a=>({...a,[e]:s}))};return e?l.jsx(Se,{open:s,onOpenChange:e=>!e&&a(),children:l.jsxs(De,{className:"max-w-2xl max-h-[90vh] overflow-y-auto","aria-describedby":"edit-user-modal-description",children:[l.jsx("div",{id:"edit-user-modal-description",className:"sr-only",children:"Formulário para editar informações do usuário"}),l.jsx(Ee,{children:l.jsxs(ke,{children:["Editar Usuário - ",e.name]})}),l.jsxs("form",{onSubmit:s=>{s.preventDefault(),e?.id&&d.mutate({userId:e.id,data:n})},className:"space-y-4",children:[l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"name",children:"Nome Completo *"}),l.jsx(U,{id:"name",value:n.name,onChange:e=>c("name",e.target.value),required:!0})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"email",children:"Email *"}),l.jsx(U,{id:"email",type:"email",value:n.email,onChange:e=>c("email",e.target.value),required:!0})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"phone",children:"Telefone"}),l.jsx(U,{id:"phone",value:n.phone,onChange:e=>c("phone",e.target.value),placeholder:"(11) 99999-9999"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"birthDate",children:"Data de Nascimento"}),l.jsx(U,{id:"birthDate",type:"date",value:n.birthDate,onChange:e=>c("birthDate",e.target.value)})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"role",children:"Função"}),l.jsxs(te,{value:n.role,onValueChange:e=>c("role",e),children:[l.jsx(re,{children:l.jsx(ie,{})}),l.jsxs(ne,{children:[l.jsx(le,{value:"admin",children:"Administrador"}),l.jsx(le,{value:"missionary",children:"Missionário"}),l.jsx(le,{value:"member",children:"Membro"}),l.jsx(le,{value:"interested",children:"Interessado"})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"status",children:"Status"}),l.jsxs(te,{value:n.status,onValueChange:e=>c("status",e),children:[l.jsx(re,{children:l.jsx(ie,{})}),l.jsxs(ne,{children:[l.jsx(le,{value:"approved",children:"Aprovado"}),l.jsx(le,{value:"pending",children:"Pendente"}),l.jsx(le,{value:"rejected",children:"Rejeitado"})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"church",children:"Igreja"}),l.jsx(U,{id:"church",value:n.church,onChange:e=>c("church",e.target.value)})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"civilStatus",children:"Estado Civil"}),l.jsxs(te,{value:n.civilStatus,onValueChange:e=>c("civilStatus",e),children:[l.jsx(re,{children:l.jsx(ie,{})}),l.jsxs(ne,{children:[l.jsx(le,{value:"single",children:"Solteiro(a)"}),l.jsx(le,{value:"married",children:"Casado(a)"}),l.jsx(le,{value:"divorced",children:"Divorciado(a)"}),l.jsx(le,{value:"widowed",children:"Viúvo(a)"})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"occupation",children:"Profissão"}),l.jsx(U,{id:"occupation",value:n.occupation,onChange:e=>c("occupation",e.target.value)})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"education",children:"Escolaridade"}),l.jsx(U,{id:"education",value:n.education,onChange:e=>c("education",e.target.value)})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"address",children:"Endereço"}),l.jsx(qe,{id:"address",value:n.address,onChange:e=>c("address",e.target.value),placeholder:"Rua, número, bairro, cidade, estado",rows:3})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"observations",children:"Observações"}),l.jsx(qe,{id:"observations",value:n.observations,onChange:e=>c("observations",e.target.value),placeholder:"Observações sobre o usuário...",rows:3})]}),l.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[l.jsx(_,{type:"button",variant:"outline",onClick:a,children:"Cancelar"}),l.jsx(_,{type:"submit",disabled:d.isPending,children:d.isPending?"Salvando...":"Salvar Alterações"})]})]})]})}):null},wa=({user:e,isOpen:s,onClose:a})=>{const{toast:t}=F(),r=oe(),[i,n]=R.useState({title:`Visita - ${e?.name||"Usuário"}`,description:"",scheduledAt:"",scheduledTime:"",notes:""}),o=pe({mutationFn:async s=>{const a=await fetch("/api/calendar/events",{method:"POST",body:JSON.stringify({events:[{title:`Visita - ${e?.name}`,description:s.notes||`Visita agendada para ${e?.name}`,startDate:s.scheduledAt+"T"+s.scheduledTime,endDate:s.scheduledAt+"T"+s.scheduledTime,category:"Visitas",location:e?.address||"",maxAttendees:2}]}),headers:{"Content-Type":"application/json"}}),t=await a.json();if(!a.ok)throw new Error(t.error||"Erro ao criar evento no calendário");try{const e=await fetch("/api/google-drive/process-pending",{method:"POST",headers:{"Content-Type":"application/json"}});await e.json()}catch(r){}return t},onSuccess:()=>{r.invalidateQueries({queryKey:["/api/calendar/events"]}),r.invalidateQueries({queryKey:["events"]}),t({title:"Visita agendada",description:"A visita foi agendada com sucesso na agenda e sincronizada com a planilha."}),a()},onError:e=>{t({title:"Erro",description:`Erro ao agendar visita: ${e.message}`,variant:"destructive"})}}),d=(e,s)=>{n(a=>({...a,[e]:s}))};return e?l.jsx(Se,{open:s,onOpenChange:e=>!e&&a(),children:l.jsxs(De,{className:"max-w-sm","aria-describedby":"schedule-visit-modal-description",children:[l.jsx("div",{id:"schedule-visit-modal-description",className:"sr-only",children:"Formulário para agendar visita ao membro"}),l.jsx(Ee,{children:l.jsxs(ke,{className:"flex items-center gap-2 text-lg",children:[l.jsx($,{className:"h-5 w-5"}),"Agendar Visita"]})}),l.jsxs("form",{onSubmit:e=>{e.preventDefault(),i.scheduledAt&&i.scheduledTime?o.mutate(i):t({title:"Data e hora obrigatórias",description:"Por favor, selecione uma data e hora para a visita.",variant:"destructive"})},className:"space-y-4",children:[l.jsxs("div",{className:"bg-muted/30 p-3 rounded-lg",children:[l.jsx("h4",{className:"font-medium text-sm mb-2",children:"Visitando:"}),l.jsxs("div",{className:"text-sm space-y-1",children:[l.jsxs("p",{children:[l.jsx("strong",{children:"Nome:"})," ",e.name]}),e.phone&&l.jsxs("p",{children:[l.jsx("strong",{children:"Telefone:"})," ",e.phone]}),e.address&&l.jsxs("p",{children:[l.jsx("strong",{children:"Endereço:"})," ",e.address]})]})]}),l.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"scheduledAt",className:"text-sm",children:"Data"}),l.jsx(U,{id:"scheduledAt",type:"date",value:i.scheduledAt,onChange:e=>d("scheduledAt",e.target.value),required:!0,className:"h-9"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"scheduledTime",className:"text-sm",children:"Hora"}),l.jsx(U,{id:"scheduledTime",type:"time",value:i.scheduledTime,onChange:e=>d("scheduledTime",e.target.value),required:!0,className:"h-9"})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(B,{htmlFor:"notes",className:"text-sm",children:"Observações"}),l.jsx(qe,{id:"notes",value:i.notes,onChange:e=>d("notes",e.target.value),placeholder:"Motivo da visita, objetivos...",rows:2,className:"text-sm"})]}),l.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[l.jsx(_,{type:"button",variant:"outline",onClick:a,size:"sm",children:"Cancelar"}),l.jsx(_,{type:"submit",disabled:o.isPending,className:"bg-purple-600 hover:bg-purple-700",size:"sm",children:o.isPending?"Agendando...":"Agendar"})]})]})]})}):null},Ca=({roleFilter:e,setRoleFilter:s,users:a,userRole:t})=>"missionary"===t?l.jsxs(M,{variant:"secondary",className:"text-[10px] sm:text-sm px-1.5 sm:px-3 py-1 sm:py-1.5 bg-gradient-to-r from-purple-50 to-blue-50 text-purple-700 border-purple-300/50",children:[l.jsx(ee,{className:"h-2.5 w-2.5 sm:h-4 sm:w-4 mr-0.5 sm:mr-2"}),l.jsx("span",{className:"font-semibold",children:"0 vinculados"})]}):l.jsxs(l.Fragment,{children:[l.jsxs(M,{variant:"admin"===e?"default":"outline",className:"group relative cursor-pointer transition-all duration-300 ease-out transform hover:scale-105 hover:shadow-lg text-[10px] sm:text-sm px-1.5 sm:px-3 py-1 sm:py-1.5 "+("admin"===e?"bg-gradient-to-r from-blue-600 to-blue-700 text-white shadow-lg shadow-blue-500/25 border-0":"bg-gradient-to-r from-blue-50 to-blue-100 text-blue-700 border-blue-300/50 hover:from-blue-100 hover:to-blue-200 hover:border-blue-400"),onClick:()=>s("admin"===e?"all":"admin"),"data-testid":"stat-admin",children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-400/20 to-transparent rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),l.jsx(Ke,{className:"h-2.5 w-2.5 sm:h-4 sm:w-4 mr-0.5 sm:mr-2 drop-shadow-sm"}),l.jsx("span",{className:"font-semibold tracking-wide hidden sm:inline",children:"Administradores"}),l.jsx("span",{className:"font-semibold tracking-wide sm:hidden",children:"Admins"}),l.jsx("span",{className:"ml-0.5 sm:ml-2 px-1 sm:px-2 py-0.5 bg-white/20 rounded-full text-[10px] sm:text-sm font-bold",children:a.filter(e=>"admin"===e.role).length})]}),l.jsxs(M,{variant:"member"===e?"default":"outline",className:"group relative cursor-pointer transition-all duration-300 ease-out transform hover:scale-105 hover:shadow-lg text-[10px] sm:text-sm px-1.5 sm:px-3 py-1 sm:py-1.5 "+("member"===e?"bg-gradient-to-r from-emerald-600 to-emerald-700 text-white shadow-lg shadow-emerald-500/25 border-0":"bg-gradient-to-r from-emerald-50 to-emerald-100 text-emerald-700 border-emerald-300/50 hover:from-emerald-100 hover:to-emerald-200 hover:border-emerald-400"),onClick:()=>s("member"===e?"all":"member"),"data-testid":"stat-member",children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-400/20 to-transparent rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),l.jsx(W,{className:"h-2.5 w-2.5 sm:h-4 sm:w-4 mr-0.5 sm:mr-2 drop-shadow-sm"}),l.jsx("span",{className:"font-semibold tracking-wide",children:"Membros"}),l.jsx("span",{className:"ml-0.5 sm:ml-2 px-1 sm:px-2 py-0.5 bg-white/20 rounded-full text-[10px] sm:text-sm font-bold",children:a.filter(e=>e.role.includes("member")).length})]}),l.jsxs(M,{variant:"missionary"===e?"default":"outline",className:"group relative cursor-pointer transition-all duration-300 ease-out transform hover:scale-105 hover:shadow-lg text-[10px] sm:text-sm px-1.5 sm:px-3 py-1 sm:py-1.5 "+("missionary"===e?"bg-gradient-to-r from-violet-600 to-violet-700 text-white shadow-lg shadow-violet-500/25 border-0":"bg-gradient-to-r from-violet-50 to-violet-100 text-violet-700 border-violet-300/50 hover:from-violet-100 hover:to-violet-200 hover:border-violet-400"),onClick:()=>s("missionary"===e?"all":"missionary"),"data-testid":"stat-missionary",children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-violet-400/20 to-transparent rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),l.jsx(ee,{className:"h-2.5 w-2.5 sm:h-4 sm:w-4 mr-0.5 sm:mr-2 drop-shadow-sm"}),l.jsx("span",{className:"font-semibold tracking-wide hidden sm:inline",children:"Missionários"}),l.jsx("span",{className:"font-semibold tracking-wide sm:hidden",children:"Miss."}),l.jsx("span",{className:"ml-0.5 sm:ml-2 px-1 sm:px-2 py-0.5 bg-white/20 rounded-full text-[10px] sm:text-sm font-bold",children:a.filter(e=>e.role.includes("missionary")).length})]}),l.jsxs(M,{variant:"interested"===e?"default":"outline",className:"group relative cursor-pointer transition-all duration-300 ease-out transform hover:scale-105 hover:shadow-lg text-[10px] sm:text-sm px-1.5 sm:px-3 py-1 sm:py-1.5 "+("interested"===e?"bg-gradient-to-r from-amber-600 to-amber-700 text-white shadow-lg shadow-amber-500/25 border-0":"bg-gradient-to-r from-amber-50 to-amber-100 text-amber-700 border-amber-300/50 hover:from-amber-100 hover:to-amber-200 hover:border-amber-400"),onClick:()=>s("interested"===e?"all":"interested"),"data-testid":"stat-interested",children:[l.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-amber-400/20 to-transparent rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),l.jsx(Le,{className:"h-2.5 w-2.5 sm:h-4 sm:w-4 mr-0.5 sm:mr-2 drop-shadow-sm"}),l.jsx("span",{className:"font-semibold tracking-wide hidden sm:inline",children:"Interessados"}),l.jsx("span",{className:"font-semibold tracking-wide sm:hidden",children:"Int."}),l.jsx("span",{className:"ml-0.5 sm:ml-2 px-1 sm:px-2 py-0.5 bg-white/20 rounded-full text-[10px] sm:text-sm font-bold",children:a.filter(e=>"interested"===e.role).length})]})]});var Sa="AlertDialog",[Da,Ea]=m(Sa,[S]),ka=S(),Aa=e=>{const{__scopeAlertDialog:s,...t}=e,r=ka(s);return l.jsx(a,{...r,...t,modal:!0})};Aa.displayName=Sa;R.forwardRef((e,s)=>{const{__scopeAlertDialog:a,...t}=e,r=ka(a);return l.jsx(I,{...r,...t,ref:s})}).displayName="AlertDialogTrigger";var Pa=e=>{const{__scopeAlertDialog:s,...a}=e,r=ka(s);return l.jsx(t,{...r,...a})};Pa.displayName="AlertDialogPortal";var Ia=R.forwardRef((e,s)=>{const{__scopeAlertDialog:a,...t}=e,i=ka(a);return l.jsx(r,{...i,...t,ref:s})});Ia.displayName="AlertDialogOverlay";var Ra="AlertDialogContent",[Oa,za]=Da(Ra),Ta=E("AlertDialogContent"),Fa=R.forwardRef((e,s)=>{const{__scopeAlertDialog:a,children:t,...r}=e,n=ka(a),o=R.useRef(null),d=u(s,o),c=R.useRef(null);return l.jsx(D,{contentName:Ra,titleName:Ma,docsSlug:"alert-dialog",children:l.jsx(Oa,{scope:a,cancelRef:c,children:l.jsxs(i,{role:"alertdialog",...n,...r,ref:d,onOpenAutoFocus:x(r.onOpenAutoFocus,e=>{e.preventDefault(),c.current?.focus({preventScroll:!0})}),onPointerDownOutside:e=>e.preventDefault(),onInteractOutside:e=>e.preventDefault(),children:[l.jsx(Ta,{children:t}),l.jsx(Ka,{contentRef:o})]})})})});Fa.displayName=Ra;var Ma="AlertDialogTitle",_a=R.forwardRef((e,s)=>{const{__scopeAlertDialog:a,...t}=e,r=ka(a);return l.jsx(k,{...r,...t,ref:s})});_a.displayName=Ma;var qa="AlertDialogDescription",$a=R.forwardRef((e,s)=>{const{__scopeAlertDialog:a,...t}=e,r=ka(a);return l.jsx(A,{...r,...t,ref:s})});$a.displayName=qa;var Va=R.forwardRef((e,s)=>{const{__scopeAlertDialog:a,...t}=e,r=ka(a);return l.jsx(P,{...r,...t,ref:s})});Va.displayName="AlertDialogAction";var Ba="AlertDialogCancel",Ua=R.forwardRef((e,s)=>{const{__scopeAlertDialog:a,...t}=e,{cancelRef:r}=za(Ba,a),i=ka(a),n=u(s,r);return l.jsx(P,{...i,...t,ref:n})});Ua.displayName=Ba;var Ka=({contentRef:e})=>{const s=`\`${Ra}\` requires a description for the component to be accessible for screen reader users.\n\nYou can add a description to the \`${Ra}\` by passing a \`${qa}\` component as a child, which also benefits sighted users by adding visible context to the dialog.\n\nAlternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Ra}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.\n\nFor more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return R.useEffect(()=>{document.getElementById(e.current?.getAttribute("aria-describedby"))},[s,e]),null},La=Ia,Qa=Fa,Ja=Va,Ya=Ua,Ha=_a,Wa=$a;const Za=Aa,Ga=Pa,Xa=R.forwardRef(({className:e,...s},a)=>l.jsx(La,{className:T("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:a}));Xa.displayName=La.displayName;const et=R.forwardRef(({className:e,...s},a)=>l.jsxs(Ga,{children:[l.jsx(Xa,{}),l.jsx(Qa,{ref:a,className:T("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s})]}));et.displayName=Qa.displayName;const st=({className:e,...s})=>l.jsx("div",{className:T("flex flex-col space-y-2 text-center sm:text-left",e),...s});st.displayName="AlertDialogHeader";const at=({className:e,...s})=>l.jsx("div",{className:T("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});at.displayName="AlertDialogFooter";const tt=R.forwardRef(({className:e,...s},a)=>l.jsx(Ha,{ref:a,className:T("text-lg font-semibold",e),...s}));tt.displayName=Ha.displayName;const rt=R.forwardRef(({className:e,...s},a)=>l.jsx(Wa,{ref:a,className:T("text-sm text-muted-foreground",e),...s}));rt.displayName=Wa.displayName;const it=R.forwardRef(({className:e,...s},a)=>l.jsx(Ja,{ref:a,className:T(de(),e),...s}));it.displayName=Ja.displayName;const nt=R.forwardRef(({className:e,...s},a)=>l.jsx(Ya,{ref:a,className:T(de({variant:"outline"}),"mt-2 sm:mt-0",e),...s}));function lt(){const{user:e}=L();fe();const{toast:s}=F(),a=oe(),[t,r]=R.useState(""),[i,n]=R.useState("all"),[o,d]=R.useState("all"),[c,m]=R.useState("name"),[u,x]=R.useState("asc"),[h,p]=R.useState("all"),[f,j]=R.useState("all"),[v,g]=R.useState("all"),[N,b]=R.useState("all"),[y,w]=R.useState("all"),[C,S]=R.useState("all"),[D,E]=R.useState(null),[k,A]=R.useState(!1),[P,I]=R.useState(!1),[z,T]=R.useState(!1),[q,$]=R.useState(!1),[V,B]=R.useState(null),[K,Q]=R.useState(!1),[J,Y]=R.useState(null),[H,Z]=R.useState(""),[G,se]=R.useState(!1),[ae,de]=R.useState(null),[ve,ge]=R.useState(""),[Ne,be]=R.useState(!1),[ye,we]=R.useState(0),[Ce,Se]=R.useState(""),{data:De,isLoading:Ee,error:ke}=O({queryKey:["/api/users"],queryFn:async()=>{try{const e=await fetch("/api/users");if(!e.ok)throw new Error("Falha ao carregar usuários");const s=await e.json();return Array.isArray(s)?s:[]}catch(e){return[]}},refetchOnWindowFocus:!1,refetchOnMount:!0,staleTime:6e5,gcTime:9e5,retry:1}),Ae=Array.isArray(De)?De:[],{data:Pe=[]}=O({queryKey:["all-relationships"],queryFn:async()=>{try{const e=await fetch("/api/relationships");if(!e.ok)return[];return await e.json()}catch(e){return[]}},enabled:!0}),Re=Array.isArray(Pe)?Pe:[],{data:ze}=O({queryKey:["/api/spiritual-checkins/scores"],queryFn:async()=>{const e=await fetch("/api/spiritual-checkins/scores");if(!e.ok)throw new Error("Failed to fetch spiritual check-ins");return e.json()},staleTime:6e4}),{data:Te=[]}=O({queryKey:["churches"],queryFn:async()=>{const e=await fetch("/api/churches");if(!e.ok)throw new Error("Erro ao buscar igrejas");return e.json()}}),{data:Fe=[]}=O({queryKey:["discipleship-requests"],queryFn:async()=>{const e=await fetch("/api/discipleship-requests");if(!e.ok)throw new Error("Erro ao buscar solicitações de discipulado");return e.json()}}),_e=Ae.map(e=>({...e,hasPendingDiscipleRequest:Fe.some(s=>s.interestedId===e.id&&"pending"===s.status)})),qe=e=>"pending"===e.status?1:(e.points||0)<300?2:(e.attendance||0)<50?3:e.isApproved?5:4,$e=e=>{g(e),"all"!==e&&(r(""),n("all"),d("all"),j("all"),p("all"),S("all"),b("all"))},Ue=e=>"all"===e?Ae.length:Ae.filter(s=>{const a=s.points||0;switch(e){case"vale":return a>=0&&a<=299;case"sinai":return a>=300&&a<=399;case"nebo":return a>=400&&a<=499;case"moria":return a>=500&&a<=599;case"carmelo":return a>=600&&a<=699;case"hermon":return a>=700&&a<=799;case"siao":return a>=800&&a<=899;case"oliveiras":return a>=900&&a<=999;case"topo":return a>=1e3;default:return!1}}).length,Ke=e=>"all"===e?Ae.filter(e=>"interested"===e.role).length:Ae.filter(s=>{if("interested"!==s.role)return!1;const a=s.extraData?.situacaoInteressado;switch(e){case"A":return"A"===a;case"B":return"B"===a;case"C":return"C"===a;case"D":return"D"===a;case"no-situation":return!a||""===a;case"total":return!0;default:return!1}}).length,Le=e=>"all"===e?Ae.length:Ae.filter(s=>{const a=s.extraData?.spiritualCheckInScore;switch(e){case"score-1":return 1===a;case"score-2":return 2===a;case"score-3":return 3===a;case"score-4":return 4===a;case"score-5":return 5===a;case"no-checkin":return!a||0===a;default:return!1}}).length,Je=_e.filter(s=>{const a=s.name&&"string"==typeof s.name&&s.name.toLowerCase().includes(t.toLowerCase())||s.email&&"string"==typeof s.email&&s.email.toLowerCase().includes(t.toLowerCase());let r=!i||"all"===i||s.role===i;"missionary"===i&&(r=s.role.includes("missionary"));const n=!o||"all"===o||s.status===o,l="all"===f||s.church===f;let d=!0;"missionary"===C?d=s.role.includes("missionary"):"non-missionary"===C&&(d=!s.role.includes("missionary"));let c=!0;if("all"!==v){const e=s.points||0;switch(v){case"vale":c=e>=0&&e<300;break;case"sinai":c=e>=300&&e<400;break;case"nebo":c=e>=400&&e<500;break;case"moria":c=e>=500&&e<600;break;case"carmelo":c=e>=600&&e<700;break;case"hermon":c=e>=700&&e<800;break;case"siao":c=e>=800&&e<900;break;case"oliveiras":c=e>=900&&e<1e3;break;case"topo":c=e>=1e3;break;default:c=!0}}let m=!0;"all"!==N&&(m="no-situation"===N?"interested"===s.role&&!s.interestedSituation:"total"===N?"interested"===s.role:"interested"===s.role&&s.interestedSituation===N);let u=!0;if("all"!==y)switch(y){case"score-1":u=1===s.emotionalScore;break;case"score-2":u=2===s.emotionalScore;break;case"score-3":u=3===s.emotionalScore;break;case"score-4":u=4===s.emotionalScore;break;case"score-5":u=5===s.emotionalScore;break;case"no-checkin":u=!s.emotionalScore;break;default:u=!0}let x=!0;return"missionary"===e?.role&&(x="interested"!==s.role&&s.id===e.id),a&&r&&n&&l&&c&&m&&u&&d&&x}).sort((e,s)=>{let a,t;switch(c){case"name":default:a=e.name.toLowerCase(),t=s.name.toLowerCase();break;case"points":a=e.points||0,t=s.points||0;break;case"attendance":a=e.attendance||0,t=s.attendance||0;break;case"createdAt":a=new Date(e.createdAt||0),t=new Date(s.createdAt||0);break;case"priority":a=qe(e),t=qe(s)}return"asc"===u?a>t?1:-1:a<t?1:-1}),Ye=pe({mutationFn:e=>fetch(`/api/users/${e}/approve`,{method:"POST"}).then(e=>e.json()),onSuccess:()=>{a.invalidateQueries({queryKey:["/api/users/with-points"]}),window.dispatchEvent(new CustomEvent("user-approved")),s({title:"Usuário aprovado",description:"O usuário foi aprovado com sucesso."})}}),We=pe({mutationFn:e=>fetch(`/api/users/${e}/reject`,{method:"POST"}).then(e=>e.json()),onSuccess:()=>{a.invalidateQueries({queryKey:["/api/users/with-points"]}),window.dispatchEvent(new CustomEvent("user-rejected")),s({title:"Usuário rejeitado",description:"O usuário foi rejeitado.",variant:"destructive"})}}),Ze=pe({mutationFn:({userId:e,data:s})=>fetch(`/api/users/${e}`,{method:"PUT",body:JSON.stringify(s),headers:{"Content-Type":"application/json"}}).then(e=>e.json()),onSuccess:()=>{a.invalidateQueries({queryKey:["/api/users/with-points"]}),window.dispatchEvent(new CustomEvent("user-updated")),s({title:"Usuário atualizado",description:"As informações do usuário foram atualizadas com sucesso."})}}),Ge=(e,s)=>{Ze.mutate({userId:e,data:s}),E(e=>e?{...e,...s}:null)},Xe=pe({mutationFn:async e=>{const s=await fetch(`/api/users/${e}`,{method:"DELETE"});if(!s.ok)throw new Error("Failed to delete user");return s.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["/api/users/with-points"]}),s({title:"✅ Usuário excluído",description:"Usuário excluído com sucesso!"}),$(!1),B(null)},onError:e=>{s({title:"❌ Erro ao excluir usuário",description:e.message||"Não foi possível excluir o usuário.",variant:"destructive"})}}),es=pe({mutationFn:async({userId:e,message:s})=>{const a=await fetch(`/api/users/${e}/disciple`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:s})});if(!a.ok){const e=await a.json();throw new Error(e.error||"Failed to disciple user")}return a.json()},onSuccess:()=>{a.invalidateQueries({queryKey:["/api/users"]}),s({title:"✅ Solicitação enviada",description:"Solicitação de discipulado enviada com sucesso!"}),Q(!1),Y(null),Z("")},onError:e=>{s({title:"❌ Erro ao solicitar discipulado",description:e.message||"Não foi possível enviar a solicitação.",variant:"destructive"})}}),ss=async t=>{if(ae)try{if(!(await fetch(`/api/discipleship-requests/${ae.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t,adminNotes:ve.trim(),processedBy:e?.id||1})})).ok)throw new Error("Erro ao processar solicitação");a.invalidateQueries({queryKey:["discipleship-requests"]}),a.invalidateQueries({queryKey:["relationships"]}),a.invalidateQueries({queryKey:["church-interested"]}),a.invalidateQueries({queryKey:["my-interested"]}),se(!1),de(null),ge(""),s({title:"✅ Solicitação processada!",description:`A solicitação foi ${"approved"===t?"aprovada":"rejeitada"} com sucesso.`})}catch(r){s({title:"❌ Erro ao processar",description:r.message||"Não foi possível processar a solicitação.",variant:"destructive"})}};R.useEffect(()=>{let e;const t=async()=>{try{const e=await fetch("/api/system/recalculation-status");if(e.ok){const t=await e.json();t.isRecalculating?(be(!0),we(t.progress||0),Se(t.message||"Recalculando pontos...")):(be(!1),Ne&&(a.invalidateQueries({queryKey:["/api/users"]}),s({title:"✅ Recálculo concluído!",description:"Os pontos foram atualizados com sucesso."})))}}catch(e){}};return e=setInterval(t,2e3),t(),()=>{e&&clearInterval(e)}},[Ne,a,s]);(()=>{const e=oe(),s=pe({mutationFn:async({userId:e,visitDate:s})=>{const a=await fetch(`/api/users/${e}/visit`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitDate:s})});if(!a.ok){const e=await a.json();throw new Error(e.error||"Erro ao marcar visita")}return a.json()},onSuccess:()=>{e.invalidateQueries({queryKey:["users"]}),e.invalidateQueries({queryKey:["/api/dashboard/stats"]}),e.invalidateQueries({queryKey:["/api/dashboard/visits"]}),e.invalidateQueries({queryKey:["/api/dashboard"]}),e.invalidateQueries({queryKey:["dashboard"]}),e.refetchQueries({queryKey:["/api/dashboard/visits"]})}});s.mutate,s.isPending,s.error})();const as=Ae.filter(e=>"pending"===e.status).length;return Ee?l.jsx(ce,{children:l.jsx("div",{className:"p-4 space-y-4",children:l.jsx("div",{className:"flex items-center justify-center py-8",children:l.jsxs("div",{className:"text-center",children:[l.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),l.jsx("p",{className:"text-muted-foreground",children:"Carregando usuários..."})]})})})}):ke?l.jsx(ce,{children:l.jsx("div",{className:"p-4 space-y-4",children:l.jsx("div",{className:"flex items-center justify-center py-8",children:l.jsxs("div",{className:"text-center",children:[l.jsx("p",{className:"text-destructive",children:"Erro ao carregar usuários"}),l.jsx(_,{onClick:()=>a.invalidateQueries({queryKey:["/api/users"]}),className:"mt-2",children:"Tentar novamente"})]})})})}):l.jsx(ce,{children:l.jsxs("div",{className:"p-1 sm:p-4 space-y-2 sm:space-y-4",children:[l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-2 sm:gap-3",children:[l.jsxs("div",{className:"flex items-center space-x-1.5 sm:space-x-2",children:[l.jsx(W,{className:"h-4 w-4 sm:h-6 sm:w-6 text-primary"}),l.jsx("h1",{className:"text-base sm:text-2xl font-bold text-foreground",children:"missionary"===e?.role?"Interessados":"Usuários"}),as>0&&l.jsx(M,{variant:"destructive",className:"ml-1.5 sm:ml-2 text-[10px] sm:text-xs px-1.5 py-0.5","data-testid":"badge-pending-count",children:as}),"missionary"===e?.role&&l.jsx(M,{variant:"secondary",className:"ml-1.5 sm:ml-2 text-[10px] sm:text-xs px-1.5 py-0.5",children:"0"})]}),l.jsx("div",{className:"flex items-center gap-1.5 sm:gap-2",children:"admin"===e?.role&&l.jsx(l.Fragment,{children:l.jsxs(_,{size:"sm",className:"bg-primary hover:bg-primary-dark text-[10px] sm:text-sm h-7 sm:h-8 px-2 sm:px-3","data-testid":"button-new-user",children:[l.jsx(Oe,{className:"h-3 w-3 sm:h-4 sm:w-4"}),l.jsx("span",{className:"hidden sm:inline ml-1",children:"Novo"})]})})})]}),Ne&&l.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 shadow-md animate-pulse",children:[l.jsxs("div",{className:"flex items-center justify-between mb-2",children:[l.jsxs("div",{className:"flex items-center gap-2",children:[l.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-blue-600 border-t-transparent"}),l.jsx("p",{className:"text-sm font-medium text-blue-900",children:Ce})]}),l.jsxs("p",{className:"text-sm font-bold text-blue-900",children:[Math.round(ye),"%"]})]}),l.jsx("div",{className:"w-full bg-blue-200 rounded-full h-3 overflow-hidden shadow-inner",children:l.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 h-full rounded-full transition-all duration-500 ease-out flex items-center justify-end pr-2",style:{width:`${ye}%`},children:ye>10&&l.jsxs("span",{className:"text-[10px] font-bold text-white drop-shadow",children:[Math.round(ye),"%"]})})}),l.jsx("p",{className:"text-xs text-blue-700 mt-2",children:"Aguarde enquanto os pontos são recalculados. A página será atualizada automaticamente."})]}),l.jsx("div",{className:"flex flex-wrap gap-1 sm:gap-4 mt-3 sm:mt-6 p-1.5 sm:p-4 bg-gradient-to-r from-slate-50 to-gray-50 rounded-lg sm:rounded-xl border border-slate-200/50 shadow-sm",children:l.jsx(Ca,{roleFilter:i,setRoleFilter:n,users:Ae,userRole:e?.role})}),l.jsxs("div",{className:"space-y-3 sm:space-y-4 mt-4 sm:mt-6 p-2 sm:p-4 bg-gradient-to-r from-slate-50 to-gray-50 rounded-lg sm:rounded-xl border border-slate-200/50 shadow-sm",style:{display:"none"},children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("h3",{className:"text-sm sm:text-lg font-semibold text-foreground flex items-center gap-1.5 sm:gap-2",children:[l.jsx(X,{className:"h-4 w-4 sm:h-5 sm:w-5 text-yellow-500 drop-shadow-sm"}),l.jsx("span",{className:"hidden sm:inline",children:"missionary"===e?.role?"Meus Interessados por Montes e Estatísticas":"Usuários por Montes e Estatísticas"}),l.jsx("span",{className:"sm:hidden",children:"missionary"===e?.role?"Interessados por Montes":"Usuários por Montes"})]})}),!1,!1]}),l.jsxs("div",{className:"space-y-4 mt-6 p-4 bg-gradient-to-r from-slate-50 to-gray-50 rounded-xl border border-slate-200/50 shadow-sm",style:{display:"none"},children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("h3",{className:"text-lg font-semibold text-foreground flex items-center gap-2",children:[l.jsx(ee,{className:"h-5 w-5 text-red-500 drop-shadow-sm"}),"Situação dos Interessados"]})}),!1]}),l.jsxs("div",{className:"space-y-4 mt-6 p-4 bg-gradient-to-r from-purple-50 to-pink-50 rounded-xl border border-purple-200/50 shadow-sm",style:{display:"none"},children:[l.jsx("div",{className:"flex items-center gap-2",children:l.jsxs("h3",{className:"text-lg font-semibold text-foreground flex items-center gap-2",children:[l.jsx(ee,{className:"h-5 w-5 text-purple-500 drop-shadow-sm"}),"Check-in Espiritual"]})}),!1]}),l.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[l.jsxs("div",{className:"relative",children:[l.jsx(Ie,{className:"absolute left-2.5 sm:left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-3.5 w-3.5 sm:h-4 sm:w-4"}),l.jsx(U,{placeholder:"Buscar por nome ou email...",value:t,onChange:e=>r(e.target.value),className:"pl-8 sm:pl-10 text-xs sm:text-base h-8 sm:h-10","data-testid":"input-search"})]}),l.jsxs("div",{className:"flex flex-col sm:flex-row gap-1.5 sm:gap-2",children:[l.jsx("div",{className:"flex-1 min-w-[100px] sm:min-w-[120px]",children:l.jsxs(te,{value:i,onValueChange:n,children:[l.jsx(re,{"data-testid":"select-role-filter",className:"text-xs sm:text-sm h-7 sm:h-10",children:l.jsx(ie,{placeholder:"Papel"})}),l.jsxs(ne,{children:[l.jsx(le,{value:"all",children:"Todos os papéis"}),l.jsx(le,{value:"admin",children:"Administrador"}),l.jsx(le,{value:"missionary",children:"Missionário"}),l.jsx(le,{value:"member",children:"Membro"}),l.jsx(le,{value:"interested",children:"Interessado"})]})]})}),l.jsx("div",{className:"flex-1 min-w-[100px] sm:min-w-[120px]",children:l.jsxs(te,{value:o,onValueChange:d,children:[l.jsx(re,{"data-testid":"select-status-filter",className:"text-xs sm:text-sm h-7 sm:h-10",children:l.jsx(ie,{placeholder:"Status"})}),l.jsxs(ne,{children:[l.jsx(le,{value:"all",children:"Todos os status"}),l.jsx(le,{value:"approved",children:"Aprovado"}),l.jsx(le,{value:"pending",children:"Pendente"}),l.jsx(le,{value:"rejected",children:"Rejeitado"})]})]})}),l.jsx("div",{className:"flex-1 min-w-[100px] sm:min-w-[120px]",children:l.jsxs(te,{value:f,onValueChange:j,children:[l.jsx(re,{"data-testid":"select-church-filter",className:"text-xs sm:text-sm h-7 sm:h-10",children:l.jsx(ie,{placeholder:"Igreja"})}),l.jsxs(ne,{children:[l.jsx(le,{value:"all",children:"Todas as igrejas"}),Te.map(e=>l.jsx(le,{value:e.name,children:e.name},e.id))]})]})}),l.jsx("div",{className:"flex-1 min-w-[100px] sm:min-w-[120px]",children:l.jsxs(te,{value:C,onValueChange:S,children:[l.jsx(re,{"data-testid":"select-missionary-profile-filter",className:"text-xs sm:text-sm h-7 sm:h-10",children:l.jsx(ie,{placeholder:"Filtrar por role"})}),l.jsxs(ne,{children:[l.jsx(le,{value:"all",children:"Todos os roles"}),l.jsx(le,{value:"missionary",children:"Missionários"}),l.jsx(le,{value:"non-missionary",children:"Não missionários"})]})]})}),l.jsx("div",{className:"flex-1 min-w-[100px] sm:min-w-[120px]",children:l.jsxs(te,{value:v,onValueChange:$e,children:[l.jsx(re,{className:"text-xs sm:text-sm h-7 sm:h-10",children:l.jsx(ie,{placeholder:"Montes"})}),l.jsxs(ne,{children:[l.jsxs(le,{value:"all",children:["Todos os Montes (",Ue("all"),")"]}),l.jsxs(le,{value:"vale",children:["Vale (0-299 pts) (",Ue("vale"),")"]}),l.jsxs(le,{value:"sinai",children:["Sinai (300-399 pts) (",Ue("sinai"),")"]}),l.jsxs(le,{value:"nebo",children:["Nebo (400-499 pts) (",Ue("nebo"),")"]}),l.jsxs(le,{value:"moria",children:["Moriá (500-599 pts) (",Ue("moria"),")"]}),l.jsxs(le,{value:"carmelo",children:["Carmelo (600-699 pts) (",Ue("carmelo"),")"]}),l.jsxs(le,{value:"hermon",children:["Hermon (700-799 pts) (",Ue("hermon"),")"]}),l.jsxs(le,{value:"siao",children:["Sião (800-899 pts) (",Ue("siao"),")"]}),l.jsxs(le,{value:"oliveiras",children:["Oliveiras (900-999 pts) (",Ue("oliveiras"),")"]}),l.jsxs(le,{value:"topo",children:["Topo (1000+ pts) (",Ue("topo"),")"]})]})]})}),l.jsx("div",{className:"flex-1 min-w-[100px] sm:min-w-[120px]",children:l.jsxs(te,{value:N,onValueChange:e=>{b(e),"all"!==e&&(r(""),n("all"),d("all"),j("all"),p("all"),S("all"),g("all"),w("all"))},children:[l.jsx(re,{className:"text-xs sm:text-sm h-7 sm:h-10",children:l.jsx(ie,{placeholder:"Situação Interessados"})}),l.jsxs(ne,{children:[l.jsxs(le,{value:"all",children:["Todas as Situações (",Ke("all"),")"]}),l.jsxs(le,{value:"A",children:["Pronto para Batismo (A) (",Ke("A"),")"]}),l.jsxs(le,{value:"B",children:["Detalhes Pessoais (B) (",Ke("B"),")"]}),l.jsxs(le,{value:"C",children:["Estudando Bíblia (C) (",Ke("C"),")"]}),l.jsxs(le,{value:"D",children:["Iniciante (D) (",Ke("D"),")"]}),l.jsxs(le,{value:"no-situation",children:["Sem Situação (",Ke("no-situation"),")"]}),l.jsxs(le,{value:"total",children:["Todos Interessados (",Ke("total"),")"]})]})]})}),l.jsx("div",{className:"flex-1 min-w-[100px] sm:min-w-[120px]",children:l.jsxs(te,{value:y,onValueChange:e=>{w(e),"all"!==e&&(r(""),n("all"),d("all"),j("all"),p("all"),S("all"),g("all"),b("all"))},children:[l.jsx(re,{className:"text-xs sm:text-sm h-7 sm:h-10",children:l.jsx(ie,{placeholder:"Check-in Espiritual"})}),l.jsxs(ne,{children:[l.jsxs(le,{value:"all",children:["Todos os Check-ins (",Le("all"),")"]}),l.jsxs(le,{value:"score-1",children:["🍃 Distante (1) (",Le("score-1"),")"]}),l.jsxs(le,{value:"score-2",children:["🔍 Buscando (2) (",Le("score-2"),")"]}),l.jsxs(le,{value:"score-3",children:["🌱 Enraizando (3) (",Le("score-3"),")"]}),l.jsxs(le,{value:"score-4",children:["🌳 Frutificando (4) (",Le("score-4"),")"]}),l.jsxs(le,{value:"score-5",children:["✨ Intimidade (5) (",Le("score-5"),")"]})]})]})}),l.jsxs(me,{children:[l.jsx(ue,{asChild:!0,children:l.jsxs(_,{variant:"outline",size:"sm",className:"min-w-[80px] sm:min-w-[140px] text-xs sm:text-sm h-7 sm:h-10 px-2 sm:px-3",children:["asc"===u?l.jsx(je,{className:"h-2.5 w-2.5 sm:h-4 sm:w-4 mr-0.5 sm:mr-1"}):l.jsx(Qe,{className:"h-2.5 w-2.5 sm:h-4 sm:w-4 mr-0.5 sm:mr-1"}),l.jsxs("span",{className:"hidden sm:inline",children:["name"===c&&"Nome","points"===c&&"Pontos","attendance"===c&&"Frequência","createdAt"===c&&"Data Cadastro","priority"===c&&"Prioridade"]}),l.jsxs("span",{className:"sm:hidden text-[10px]",children:["name"===c&&"Nome","points"===c&&"Pts","attendance"===c&&"Freq","createdAt"===c&&"Data","priority"===c&&"Pri"]})]})}),l.jsxs(xe,{align:"end",children:[l.jsxs(he,{onClick:()=>{m("name"),x("asc")},children:[l.jsx(je,{className:"h-4 w-4 mr-2"}),"Nome A-Z"]}),l.jsxs(he,{onClick:()=>{m("name"),x("desc")},children:[l.jsx(Qe,{className:"h-4 w-4 mr-2"}),"Nome Z-A"]}),l.jsxs(he,{onClick:()=>{m("points"),x("desc")},children:[l.jsx(X,{className:"h-4 w-4 mr-2"}),"Maior Pontuação"]}),l.jsxs(he,{onClick:()=>{m("points"),x("asc")},children:[l.jsx(X,{className:"h-4 w-4 mr-2"}),"Menor Pontuação"]}),l.jsxs(he,{onClick:()=>{m("attendance"),x("desc")},children:[l.jsx(He,{className:"h-4 w-4 mr-2"}),"Maior Frequência"]}),l.jsxs(he,{onClick:()=>{m("attendance"),x("asc")},children:[l.jsx(He,{className:"h-4 w-4 mr-2"}),"Menor Frequência"]}),l.jsxs(he,{onClick:()=>{m("createdAt"),x("desc")},children:[l.jsx(Me,{className:"h-4 w-4 mr-2"}),"Mais Recentes"]}),l.jsxs(he,{onClick:()=>{m("createdAt"),x("asc")},children:[l.jsx(Me,{className:"h-4 w-4 mr-2"}),"Mais Antigos"]}),l.jsxs(he,{onClick:()=>{m("priority"),x("asc")},children:[l.jsx(Be,{className:"h-4 w-4 mr-2"}),"Prioridade (Alta → Baixa)"]})]})]})]})]}),l.jsxs("div",{className:"space-y-1.5 sm:space-y-3",children:["missionary"===e?.role&&l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1.5 sm:gap-2 p-1.5 sm:p-3 bg-gradient-to-r from-purple-50 to-blue-50 rounded-md sm:rounded-lg border border-purple-200",children:[l.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[l.jsx(ee,{className:"h-3 w-3 sm:h-4 sm:w-4 text-purple-600"}),l.jsx("span",{className:"text-[10px] sm:text-sm font-medium text-purple-800",children:"Seus interessados vinculados"}),l.jsx(M,{variant:"secondary",className:"text-[10px] sm:text-xs px-1.5 py-0.5",children:"0"})]}),l.jsx("div",{className:"text-[10px] sm:text-xs text-purple-600",children:"Solicite acesso ao admin para ver todos"})]}),"all"!==v&&l.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-1.5 sm:gap-2 p-1.5 sm:p-3 bg-gradient-to-r from-blue-50 to-purple-50 rounded-md sm:rounded-lg border border-blue-200",children:[l.jsxs("div",{className:"flex items-center gap-1.5 sm:gap-2",children:[l.jsx(Ve,{className:"h-3 w-3 sm:h-4 sm:w-4 text-blue-600"}),l.jsx("span",{className:"text-[10px] sm:text-sm font-medium text-blue-800",children:(()=>{if("all"===v)return null;return{vale:"Vale do Jordão",sinai:"Monte Sinai",nebo:"Monte Nebo",moria:"Monte Moriá",carmelo:"Monte Carmelo",hermon:"Monte Hermon",siao:"Monte Sião",oliveiras:"Monte das Oliveiras",topo:"O Topo"}[v]})()}),l.jsx(M,{variant:"secondary",className:"text-[10px] sm:text-xs px-1.5 py-0.5",children:Je.length})]}),l.jsx(_,{variant:"outline",size:"sm",onClick:()=>$e("all"),className:"h-6 sm:h-7 px-1.5 sm:px-3 text-[10px] sm:text-xs self-start sm:self-auto",children:"Ver Todos"})]}),Je.map(s=>l.jsx(Na,{user:s,onApprove:()=>{return e=s.id,void Ye.mutate(e);var e},onReject:()=>{return e=s.id,void We.mutate(e);var e},onEdit:()=>(E(s),void I(!0)),onDelete:()=>(B(s),void $(!0)),onView:()=>(E(s),void A(!0)),onScheduleVisit:()=>(E(s),void T(!0)),onDiscipleRequest:()=>(e=>{const s=Fe.find(s=>s.interestedId===e.id&&"pending"===s.status);s&&(de(s),ge(s.adminNotes||""),se(!0))})(s),showActions:"admin"===e?.role,relationshipsData:Re,hasPendingDiscipleRequest:s.hasPendingDiscipleRequest},s.id))]}),0===Je.length&&l.jsxs("div",{className:"text-center py-8","data-testid":"empty-state",children:[l.jsx(W,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),l.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Nenhum usuário encontrado"}),l.jsx("p",{className:"text-muted-foreground",children:"Tente ajustar os filtros de busca."})]}),l.jsx(ba,{user:D,isOpen:k,onClose:()=>A(!1),onUpdate:Ge}),l.jsx(ya,{user:D,isOpen:P,onClose:()=>I(!1),onUpdate:Ge}),l.jsx(wa,{user:D,isOpen:z,onClose:()=>T(!1)}),l.jsx(Za,{open:q,onOpenChange:$,children:l.jsxs(et,{children:[l.jsxs(st,{children:[l.jsx(tt,{children:"Confirmar exclusão"}),l.jsxs(rt,{children:['Tem certeza que deseja excluir o usuário "',V?.name,'"? Esta ação não pode ser desfeita.']})]}),l.jsxs(at,{children:[l.jsx(nt,{children:"Cancelar"}),l.jsx(it,{onClick:()=>{V&&Xe.mutate(V.id)},className:"bg-red-600 hover:bg-red-700",children:"Excluir"})]})]})}),l.jsx(Za,{open:K,onOpenChange:Q,children:l.jsxs(et,{children:[l.jsxs(st,{children:[l.jsx(tt,{children:"Solicitar Discipulado"}),l.jsxs(rt,{children:['Digite uma mensagem para solicitar o discipulado de "',J?.name,'". Esta solicitação será enviada para aprovação do administrador.']})]}),l.jsx("div",{className:"grid gap-4 py-4",children:l.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[l.jsx("label",{htmlFor:"disciple-message",className:"text-right text-sm font-medium",children:"Mensagem:"}),l.jsx("textarea",{id:"disciple-message",value:H,onChange:e=>Z(e.target.value),className:"col-span-3 min-h-[100px] p-3 border border-gray-300 rounded-md resize-none focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Digite sua mensagem de solicitação..."})]})}),l.jsxs(at,{children:[l.jsx(nt,{children:"Cancelar"}),l.jsx(it,{onClick:()=>{J&&H.trim()&&es.mutate({userId:J.id,message:H.trim()})},disabled:!H.trim()||es.isPending,className:"bg-blue-600 hover:bg-blue-700",children:es.isPending?"Enviando...":"Enviar Solicitação"})]})]})}),G&&ae&&l.jsx(Za,{open:G,onOpenChange:se,children:l.jsxs(et,{children:[l.jsxs(st,{children:[l.jsx(tt,{children:"Autorizar Discipulado"}),l.jsx(rt,{children:"Aprove ou rejeite a solicitação de discipulado"})]}),l.jsx("div",{className:"grid gap-4 py-4",children:l.jsxs("div",{className:"space-y-3",children:[l.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[l.jsxs("div",{children:[l.jsx("span",{className:"font-medium text-muted-foreground",children:"Missionário:"}),l.jsx("div",{className:"font-medium",children:_e.find(e=>e.id===ae.missionaryId)?.name||`Usuário ${ae.missionaryId}`})]}),l.jsxs("div",{children:[l.jsx("span",{className:"font-medium text-muted-foreground",children:"Interessado:"}),l.jsx("div",{className:"font-medium",children:_e.find(e=>e.id===ae.interestedId)?.name||`Usuário ${ae.interestedId}`})]})]}),ae.notes&&l.jsxs("div",{children:[l.jsx("span",{className:"font-medium text-muted-foreground",children:"Observações do Missionário:"}),l.jsx("div",{className:"text-sm bg-muted/50 p-2 rounded mt-1",children:ae.notes})]}),l.jsxs("div",{children:[l.jsx("label",{className:"text-sm font-medium",children:"Notas do Administrador:"}),l.jsx("textarea",{value:ve,onChange:e=>ge(e.target.value),className:"w-full mt-1 p-2 border rounded-md",rows:3,placeholder:"Adicione observações sobre sua decisão..."})]})]})}),l.jsxs(at,{children:[l.jsx(nt,{onClick:()=>se(!1),children:"Cancelar"}),"approved"===ae.status&&l.jsx(it,{onClick:()=>(async t=>{try{const r=Fe.filter(e=>e.interestedId===t&&"approved"===e.status);for(const s of r)(await fetch(`/api/discipleship-requests/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"rejected",adminNotes:"Discipulado desvinculado pelo administrador - solicitação rejeitada automaticamente",processedBy:e?.id||1})})).ok;if(!(await fetch(`/api/relationships/active/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"}})).ok)throw new Error("Erro ao remover discipulado");const i=["discipleship-requests","all-discipleship-requests","relationships","all-relationships","users","my-interested","user-relationships"];i.forEach(e=>{a.invalidateQueries({queryKey:[e]})}),["discipleship-requests","all-discipleship-requests","relationships","all-relationships"].forEach(e=>{a.refetchQueries({queryKey:[e]})}),await new Promise(e=>setTimeout(e,500)),i.forEach(e=>{a.invalidateQueries({queryKey:[e]})}),s({title:"✅ Discipulado removido!",description:`O relacionamento foi removido e ${r.length} solicitações foram rejeitadas automaticamente.`})}catch(r){s({title:"❌ Erro ao remover",description:r.message||"Não foi possível remover o discipulado.",variant:"destructive"})}})(ae.interestedId),className:"bg-orange-600 hover:bg-orange-700",children:"Remover Discipulado"}),l.jsx(it,{onClick:()=>ss("rejected"),className:"bg-red-600 hover:bg-red-700",children:"Rejeitar"}),l.jsx(it,{onClick:()=>ss("approved"),className:"bg-green-600 hover:bg-green-700",children:"Aprovar"})]})]})})]})})}nt.displayName=Ya.displayName;export{lt as default};
