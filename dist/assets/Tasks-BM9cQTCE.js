import{j as e}from"./ui-CM4P41nz.js";import{r as a}from"./vendor-v6ZOr5pf.js";import{u as s}from"./useQuery-i8KjDa18.js";import{l as t,j as i,a6 as r,z as n,k as l,B as o,R as c,a7 as d,e as h,E as m,L as u,I as x,p as g,q as p,r as f,s as j,t as y,C as v,c as w,a8 as b,Q as N,v as k,a9 as C}from"./index-BZPjCuBe.js";import{D as S,e as _,a as T,b as E,c as L}from"./dialog-D2FSaf0L.js";import{T as D}from"./textarea-Dtr_5dpa.js";import{T as P,a as I,b as O,c as q}from"./tabs-hBHJ1hIN.js";import{C as A}from"./checkbox-CvVnWZoH.js";import{n as $}from"./notificationService-Bb4GK-tC.js";import{u as z}from"./useMutation-CURL3hhE.js";import{W as K,a as Q}from"./wifi-Ci5digGR.js";import{S as F}from"./search-D3DisyzJ.js";import{T as M}from"./trash-2-DONUTpy1.js";import{C as B}from"./clock-i_GsdQLf.js";import"./charts-56rtB2he.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=t("CirclePlus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),R=t("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]),J=t("SquareCheck",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),W=t("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H={high:{color:"bg-red-50 text-red-700 border-red-200",icon:e.jsx(C,{className:"h-3 w-3"}),label:"Alta"},medium:{color:"bg-yellow-50 text-yellow-700 border-yellow-200",icon:e.jsx(B,{className:"h-3 w-3"}),label:"MÃ©dia"},low:{color:"bg-green-50 text-green-700 border-green-200",icon:e.jsx(b,{className:"h-3 w-3"}),label:"Baixa"}},U={pending:{color:"bg-gray-50 text-gray-700 border-gray-200",icon:e.jsx(b,{className:"h-3 w-3"}),label:"Pendente"},in_progress:{color:"bg-blue-50 text-blue-700 border-blue-200",icon:e.jsx(B,{className:"h-3 w-3"}),label:"Em Progresso"},completed:{color:"bg-green-50 text-green-700 border-green-200",icon:e.jsx(N,{className:"h-3 w-3"}),label:"ConcluÃ­da"}},G="/api/google-sheets/proxy",X="1i-x-0KiciwACRztoKX-YHlXT4FsrAzaKwuH-hHkD8go",Y="tarefas";function Z(){const t=i(),[C,Z]=a.useState(""),[ee,ae]=a.useState("all"),[se,te]=a.useState("all"),[ie,re]=a.useState(!1),[ne,le]=a.useState(!1),[oe,ce]=a.useState(null),[de,he]=a.useState([]),[me,ue]=a.useState({title:"",description:"",priority:"medium",due_date:"",assigned_to:"none",tags:[]}),{data:xe,loading:ge,syncing:pe,isOnline:fe,create:je,update:ye,remove:ve,sync:we,syncInfo:be}=function({storeName:e,endpoint:t,queryKey:n,autoFetch:l=!0,syncInterval:o=3e4,headers:c={},transformBeforeSave:d,transformAfterLoad:h}){const m=i(),[u,x]=a.useState(navigator.onLine),[g,p]=a.useState(!1),[f,j]=a.useState({lastSync:null,pendingCount:0,errorCount:0});a.useEffect(()=>{const e=()=>{const e=navigator.onLine;x(e),e&&C()};return window.addEventListener("online",e),window.addEventListener("offline",e),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",e)}},[]);const{data:y,isLoading:v}=s({queryKey:n,queryFn:async()=>{Math.random().toString(36).substr(2,5);let a=await r.getAll(e);if(h&&(a=a.map(h)),navigator.onLine&&l)try{const a=await fetch(t,{headers:{"x-user-id":"1",...c}});if(a.ok){const s=await a.json(),t=Array.isArray(s)?s:s[e]||s.data||[];await r.clear(e);for(const a of t){const s=d?d(a):a;await r.save(e,{...s,_synced:!0})}return h?t.map(h):t}}catch(s){}return a},staleTime:5e3,gcTime:36e5}),w=y?Array.from(y.reduce((e,a)=>{const s=String(a.id),t=s.startsWith("temp_"),i=Array.from(e.values()).find(e=>String(e.title).toLowerCase().trim()===String(a.title).toLowerCase().trim());if(i){const r=String(i.id),n=r.startsWith("temp_");!t&&n?(e.delete(r),e.set(s,a)):t&&!n||parseInt(s)<parseInt(r)&&(e.delete(r),e.set(s,a))}else e.set(s,a);return e},new Map)).map(([e,a])=>a):[];y&&(w.length,y.length);const b=z({mutationFn:async a=>{if(navigator.onLine)try{const s=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json","x-user-id":"1",...c},body:JSON.stringify(a)});if(s.ok){const a=await s.json(),t=a[e.slice(0,-1)]||a;if(t&&t.id)return await r.save(e,{...t,_synced:!0}),t}}catch(l){}const s=`temp_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,i={...a,id:s,created_at:(new Date).toISOString(),_localCreated:!0,_synced:!1},n=d?d(i):i;return await r.save(e,n),await r.addToSyncQueue({type:"CREATE",storeName:e,endpoint:t,data:i}),i},onSuccess:e=>{m.invalidateQueries({queryKey:n}),_()}}),N=z({mutationFn:async({id:a,updates:s})=>{const i=await r.getById(e,a);if(!i)throw new Error(`Item ${a} nÃ£o encontrado`);const n={...i,...s,updated_at:(new Date).toISOString(),_synced:!1},l=d?d(n):n;if(await r.save(e,l),await r.addToSyncQueue({type:"UPDATE",storeName:e,endpoint:t,data:n,originalUpdates:s}),navigator.onLine)try{const i=await fetch(`${t}/${a}`,{method:"PUT",headers:{"Content-Type":"application/json","x-user-id":"1",...c},body:JSON.stringify(s)});if(i.ok){const s=await i.json(),t=s[e.slice(0,-1)]||s;if(t){if(t.id&&t.id!==a)try{await r.delete(e,a)}catch(o){}return await r.save(e,{...t,_synced:!0}),t}}}catch(h){}return n},onSuccess:()=>{m.invalidateQueries({queryKey:n}),_()}}),k=z({mutationFn:async a=>{const s=(await r.getSyncQueue()).filter(e=>!(String(e.data?.id)===String(a)));if(await r.saveSyncQueue(s),await r.delete(e,a),navigator.onLine)try{(await fetch(`${t}/${a}`,{method:"DELETE",headers:{"x-user-id":"1",...c}})).ok}catch(i){}else await r.addToSyncQueue({type:"DELETE",storeName:e,endpoint:t,data:{id:a}})},onSuccess:async(e,a)=>{await m.invalidateQueries({queryKey:n}),await m.refetchQueries({queryKey:n,type:"active"}),_()}}),C=a.useCallback(async()=>{if(!navigator.onLine||g)return{success:0,failed:0,errors:[]};p(!0);try{const e=await r.syncWithServer();return await m.invalidateQueries({queryKey:n}),await _(),e}catch(e){return{success:0,failed:0,errors:[String(e)]}}finally{p(!1)}},[g,m,n,e]),S=a.useCallback(async()=>{await m.invalidateQueries({queryKey:n})},[m,n]),_=a.useCallback(async()=>{const e=await r.getSyncInfo();j(e)},[]);return a.useEffect(()=>{_()},[_]),a.useEffect(()=>{if(!o||!u)return;const e=setInterval(()=>{navigator.onLine&&!g&&C()},o);return()=>clearInterval(e)},[o,u,g,C]),{data:w||[],loading:v,syncing:g,isOnline:u,create:e=>b.mutateAsync(e),update:(e,a)=>N.mutateAsync({id:e,updates:a}),remove:e=>k.mutateAsync(e),refresh:S,sync:C,syncInfo:f}}({storeName:"tasks",endpoint:"/api/tasks",queryKey:["tasks"],autoFetch:!0,syncInterval:3e4});a.useEffect(()=>{r.init().then(()=>{})},[]),a.useEffect(()=>{he([])},[C,ee,se]),a.useEffect(()=>{if(!fe)return;let e=0;const a=setInterval(async()=>{if(fe){e++;try{be.pendingCount>0&&await we(),e%2==0&&await Se(!1)}catch(a){}}},2e3);return()=>{clearInterval(a)}},[fe,be.pendingCount]),a.useEffect(()=>{if(!fe)return;const e=setTimeout(async()=>{try{const e=(await r.getAll("tasks")).filter(e=>String(e.id).startsWith("temp_"));if(e.length>0){await we();await t.invalidateQueries({queryKey:["tasks"]}),await t.refetchQueries({queryKey:["tasks"],type:"active"}),await new Promise(e=>setTimeout(e,2e3));const a=await fetch("/api/tasks",{headers:{"x-user-id":"1","Cache-Control":"no-cache"}});if(a.ok){const s=(await a.json()).tasks||[];for(const a of e){const e=s.find(e=>e.title===a.title&&!String(e.id).startsWith("temp_"));e&&(await Ne(e),await new Promise(e=>setTimeout(e,300)))}}}}catch(e){}},1500);return()=>clearTimeout(e)},[fe]);const Ne=async e=>{if(fe)try{const a={id:e.id,titulo:e.title,descricao:e.description||"",status:"completed"===e.status?"ConcluÃ­da":"in_progress"===e.status?"Em Progresso":"Pendente",prioridade:"high"===e.priority?"Alta":"low"===e.priority?"Baixa":"MÃ©dia",responsavel:e.assigned_to_name||"Sistema",criador:e.created_by_name||"App",data_criacao:new Date(e.created_at).toLocaleDateString("pt-BR"),data_vencimento:e.due_date?new Date(e.due_date).toLocaleDateString("pt-BR"):"",data_conclusao:e.completed_at?new Date(e.completed_at).toLocaleDateString("pt-BR"):"",tags:e.tags?.join(",")||""},s=await fetch(G,{method:"POST",headers:{"Content-Type":"application/json","x-user-id":"1"},body:JSON.stringify({action:"addTask",spreadsheetId:X,sheetName:Y,taskData:a})});if(s.ok){(await s.json()).success}}catch(a){}},ke=async e=>{if(fe)try{const a=await fetch("/api/tasks",{headers:{"x-user-id":"1"}});if(a.ok){const s=(await a.json()).tasks||[];if(!s.find(a=>a.id===e.id))return}await fetch(G,{method:"POST",headers:{"Content-Type":"application/json","x-user-id":"1"},body:JSON.stringify({action:"deleteTask",spreadsheetId:X,sheetName:Y,taskId:e.id})});await Ne(e)}catch(a){}},Ce=async e=>{if(fe)try{const a=await fetch(G,{method:"POST",headers:{"Content-Type":"application/json","x-user-id":"1"},body:JSON.stringify({action:"deleteTask",spreadsheetId:X,sheetName:Y,taskId:e})});if(a.ok){(await a.json()).success}}catch(a){}},Se=async(e=!1)=>{if(fe)try{e&&n.info("Sincronizando do Google Sheets...");const s=await fetch(G,{method:"POST",headers:{"Content-Type":"application/json","x-user-id":"1"},body:JSON.stringify({action:"getTasks",spreadsheetId:X,sheetName:Y})});if(!s.ok)throw new Error("Erro ao buscar tarefas do Google Sheets");const i=(await s.json()).tasks||[],r=await fetch("/api/tasks",{headers:{"x-user-id":"1","Cache-Control":"no-cache"}});if(!r.ok)throw new Error("Erro ao buscar tarefas do servidor");const l=(await r.json()).tasks||[],o=new Map(l.map(e=>[e.id,e])),c=new Map(i.map(e=>[e.id,e]));let d=0,h=0,m=0;for(const e of l)if(!c.has(e.id))try{await fetch(`/api/tasks/${e.id}`,{method:"DELETE",headers:{"x-user-id":"1"}}),m++}catch(a){}for(const e of i){const s=o.get(e.id);if(s){if(s.title!==e.titulo||s.description!==e.descricao)try{await fetch(`/api/tasks/${e.id}`,{method:"PUT",headers:{"Content-Type":"application/json","x-user-id":"1"},body:JSON.stringify({title:e.titulo,description:e.descricao||"",status:"ConcluÃ­da"===e.status?"completed":"Em Progresso"===e.status?"in_progress":"pending",priority:"Alta"===e.prioridade?"high":"Baixa"===e.prioridade?"low":"medium"})}),h++}catch(a){}}else try{await fetch("/api/tasks",{method:"POST",headers:{"Content-Type":"application/json","x-user-id":"1"},body:JSON.stringify({id:e.id,title:e.titulo,description:e.descricao||"",status:"ConcluÃ­da"===e.status?"completed":"Em Progresso"===e.status?"in_progress":"pending",priority:"Alta"===e.prioridade?"high":"Baixa"===e.prioridade?"low":"medium",created_by:1})}),d++}catch(a){}}await t.invalidateQueries({queryKey:["tasks"]}),await t.refetchQueries({queryKey:["tasks"],type:"active"}),e&&(d>0||h>0||m>0)&&n.success(`Sincronizado do Sheets: ${d} criadas, ${h} atualizadas, ${m} deletadas`)}catch(a){e&&n.error("Erro ao sincronizar do Google Sheets")}else e&&n.error("VocÃª estÃ¡ offline")},_e=e=>{he(a=>a.includes(e)?a.filter(a=>a!==e):[...a,e])},{data:Te}=s({queryKey:["tasks-users"],queryFn:async()=>{const e=await fetch("/api/tasks/users",{headers:{"x-user-id":"1"}});if(!e.ok)throw new Error("Erro ao buscar usuÃ¡rios");return e.json()}}),Ee=Te?.users||[],Le=xe.filter(e=>{const a=e.title.toLowerCase().includes(C.toLowerCase())||e.description?.toLowerCase().includes(C.toLowerCase())||e.assigned_to_name?.toLowerCase().includes(C.toLowerCase()),s="all"===se||e.status===se,t="all"===ee||e.priority===ee;return a&&s&&t}),De=Le.filter(e=>"pending"===e.status),Pe=Le.filter(e=>"in_progress"===e.status),Ie=Le.filter(e=>"completed"===e.status),Oe=({task:a})=>{const s=!1===a._synced||!0===a._localCreated,i=de.includes(a.id);return e.jsxs(v,{className:`group relative overflow-hidden bg-white border-0 shadow-sm hover:shadow-md transition-shadow duration-200 mb-4 ${s?"border-l-4 border-l-yellow-400":""} ${i?"ring-2 ring-blue-500 shadow-xl":""}`,children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-gray-50/50 to-white opacity-0 group-hover:opacity-100 transition-opacity duration-300"}),e.jsx(w,{className:"p-6 relative z-10",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("button",{onClick:()=>(async e=>{const a="completed"===e.status?"pending":"completed";try{if(await ye(e.id,{status:a,completed_at:"completed"===a?(new Date).toISOString():void 0}),fe){const s={...e,status:a,completed_at:"completed"===a?(new Date).toISOString():void 0};ke(s)}}catch(s){n.error("Erro ao alterar status")}})(a),className:"flex-shrink-0 transition-all duration-200 hover:scale-110",children:"completed"===a.status?e.jsx(N,{className:"h-5 w-5 text-green-500"}):e.jsx(b,{className:"h-5 w-5 text-gray-300 hover:text-gray-500"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:a.title}),s&&e.jsxs(o,{className:"bg-yellow-100 text-yellow-700 border-yellow-200 text-xs",children:[e.jsx(d,{className:"h-2 w-2 mr-1"}),"Offline"]})]}),a.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-3 line-clamp-2",children:a.description}),e.jsxs("div",{className:"flex flex-wrap gap-2 mb-3",children:[e.jsxs(o,{className:`${U[a.status].color} border`,children:[U[a.status].icon,e.jsx("span",{className:"ml-1",children:U[a.status].label})]}),e.jsxs(o,{className:`${H[a.priority].color} border`,children:[H[a.priority].icon,e.jsx("span",{className:"ml-1",children:H[a.priority].label})]}),a.assigned_to_name&&e.jsxs(o,{className:"bg-blue-50 text-blue-700 border-blue-200",children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),a.assigned_to_name]})]}),a.tags&&a.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:a.tags.map((a,s)=>e.jsxs(o,{variant:"outline",className:"text-xs",children:[e.jsx(W,{className:"h-2 w-2 mr-1"}),a]},s))})]}),e.jsxs("div",{className:"flex items-center justify-between gap-2 pt-3 border-t border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(h,{onClick:()=>(e=>{ce(e),le(!0)})(a),variant:"ghost",size:"sm",className:"h-9 px-3 text-gray-600 hover:text-blue-600 hover:bg-blue-50 transition-all duration-200",children:[e.jsx(R,{className:"h-4 w-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Editar"})]}),e.jsxs(h,{onClick:()=>(async e=>{if(confirm("Tem certeza que deseja deletar esta tarefa?"))try{await ve(e),await t.invalidateQueries({queryKey:["tasks"]}),await t.refetchQueries({queryKey:["tasks"]}),n.success(fe?"Tarefa deletada!":"Deletada offline",{icon:fe?"âœ…":"ðŸ“´"}),fe&&Ce(e)}catch(a){n.error(`Erro ao deletar tarefa: ${a.message}`)}})(a.id),variant:"ghost",size:"sm",className:"h-9 px-3 text-gray-600 hover:text-red-600 hover:bg-red-50 transition-all duration-200",children:[e.jsx(M,{className:"h-4 w-4 mr-1.5"}),e.jsx("span",{className:"hidden sm:inline",children:"Deletar"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 rounded-md hover:bg-gray-50 transition-colors cursor-pointer",onClick:()=>_e(a.id),children:[e.jsx("span",{className:"text-sm text-gray-600 hidden sm:inline",children:"Selecionar"}),e.jsx(A,{checked:i,onCheckedChange:()=>_e(a.id),className:"flex-shrink-0","aria-label":`Selecionar tarefa ${a.title}`,onClick:e=>e.stopPropagation()})]})]})]})})]})},qe=({icon:a,title:s,description:t})=>e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"inline-flex p-4 rounded-full bg-gray-100 mb-4",children:e.jsx(a,{className:"h-8 w-8 text-gray-400"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s}),e.jsx("p",{className:"text-gray-500 max-w-sm mx-auto",children:t})]});return ge?e.jsx(l,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-white",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})})})}):e.jsx(l,{children:e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-white",children:e.jsxs("div",{className:"container mx-auto px-4 py-8 max-w-7xl",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-6 mb-8",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-gray-900 to-gray-700 bg-clip-text text-transparent",children:"Tarefas"}),fe?e.jsxs(o,{className:"bg-green-100 text-green-700 border-green-200 flex items-center gap-1",children:[e.jsx(K,{className:"h-3 w-3"}),"Online"]}):e.jsxs(o,{className:"bg-yellow-100 text-yellow-700 border-yellow-200 flex items-center gap-1",children:[e.jsx(Q,{className:"h-3 w-3"}),"Offline"]})]}),e.jsx("p",{className:"text-gray-600 text-lg",children:"Organize e acompanhe suas tarefas"}),be.lastSync&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-gray-500",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500"}),e.jsxs("span",{children:["Ãšltima sincronizaÃ§Ã£o: ",new Date(be.lastSync).toLocaleString("pt-BR")]})]}),pe&&e.jsxs(o,{className:"bg-blue-100 text-blue-700 border-blue-200 flex items-center gap-1 animate-pulse",children:[e.jsx(c,{className:"h-3 w-3 animate-spin"}),"Sincronizando..."]}),be.pendingCount>0&&e.jsxs(o,{className:"bg-orange-100 text-orange-700 border-orange-200 flex items-center gap-1",children:[e.jsx(d,{className:"h-3 w-3"}),be.pendingCount," pendente",be.pendingCount>1?"s":""]})]}),e.jsxs("div",{className:"flex gap-3 flex-wrap",children:[fe&&!1,fe&&!1,e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>window.open("/settings","_blank"),className:"flex items-center gap-2",children:[e.jsx(m,{className:"h-4 w-4"}),"Configurar"]}),e.jsxs(S,{open:ie,onOpenChange:re,children:[e.jsx(_,{asChild:!0,children:e.jsxs(h,{className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white shadow-lg hover:shadow-xl transition-all duration-300 px-6 py-3",children:[e.jsx(V,{className:"h-5 w-5 mr-2"}),"Nova Tarefa"]})}),e.jsxs(T,{className:"max-w-md",children:[e.jsx(E,{children:e.jsx(L,{className:"text-xl font-semibold",children:"Nova Tarefa"})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"title",children:"TÃ­tulo *"}),e.jsx(x,{id:"title",value:me.title,onChange:e=>ue({...me,title:e.target.value}),placeholder:"Digite o tÃ­tulo da tarefa",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"description",children:"DescriÃ§Ã£o"}),e.jsx(D,{id:"description",value:me.description,onChange:e=>ue({...me,description:e.target.value}),placeholder:"Descreva a tarefa em detalhes",className:"mt-1",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"priority",children:"Prioridade"}),e.jsxs(g,{value:me.priority,onValueChange:e=>ue({...me,priority:e}),children:[e.jsx(p,{className:"mt-1",children:e.jsx(f,{})}),e.jsxs(j,{children:[e.jsx(y,{value:"low",children:"Baixa"}),e.jsx(y,{value:"medium",children:"MÃ©dia"}),e.jsx(y,{value:"high",children:"Alta"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"due_date",children:"Vencimento"}),e.jsx(x,{id:"due_date",type:"date",value:me.due_date,onChange:e=>ue({...me,due_date:e.target.value}),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"assigned_to",children:"ResponsÃ¡vel"}),e.jsxs(g,{value:me.assigned_to,onValueChange:e=>ue({...me,assigned_to:e}),children:[e.jsx(p,{className:"mt-1",children:e.jsx(f,{placeholder:"Selecione"})}),e.jsxs(j,{children:[e.jsx(y,{value:"none",children:"Sem responsÃ¡vel"}),Ee.map(a=>e.jsx(y,{value:a.id.toString(),children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(h,{variant:"outline",onClick:()=>re(!1),children:"Cancelar"}),e.jsx(h,{onClick:async()=>{if(me.title.trim())try{const a={title:me.title,description:me.description,priority:me.priority,due_date:me.due_date||void 0,assigned_to:me.assigned_to&&"none"!==me.assigned_to?parseInt(me.assigned_to):void 0,status:"pending",created_by:1,tags:me.tags},s=await je(a);if(re(!1),ue({title:"",description:"",priority:"medium",due_date:"",assigned_to:"none",tags:[]}),n.success(fe?"Tarefa criada!":"Tarefa salva offline",{icon:fe?"âœ…":"ðŸ“´"}),fe&&s&&!String(s.id).startsWith("temp_")&&Ne(s),fe&&me.assigned_to&&"none"!==me.assigned_to)try{await $.notifyTaskCreated(me.title,parseInt(me.assigned_to))}catch(e){}}catch(e){n.error("Erro ao criar tarefa")}else n.error("TÃ­tulo Ã© obrigatÃ³rio")},disabled:pe,className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800",children:"Criar Tarefa"})]})]})]})]})]})]}),e.jsx(v,{className:"mb-8 border-0 shadow-sm",children:e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-5 w-5"}),e.jsx(x,{placeholder:"Buscar tarefas...",value:C,onChange:e=>Z(e.target.value),className:"pl-12 h-12 text-base"})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(g,{value:se,onValueChange:te,children:[e.jsx(p,{className:"w-40",children:e.jsx(f,{placeholder:"Status"})}),e.jsxs(j,{children:[e.jsx(y,{value:"all",children:"Todos"}),e.jsx(y,{value:"pending",children:"Pendentes"}),e.jsx(y,{value:"in_progress",children:"Em Progresso"}),e.jsx(y,{value:"completed",children:"ConcluÃ­das"})]})]}),e.jsxs(g,{value:ee,onValueChange:ae,children:[e.jsx(p,{className:"w-40",children:e.jsx(f,{placeholder:"Prioridade"})}),e.jsxs(j,{children:[e.jsx(y,{value:"all",children:"Todas"}),e.jsx(y,{value:"high",children:"Alta"}),e.jsx(y,{value:"medium",children:"MÃ©dia"}),e.jsx(y,{value:"low",children:"Baixa"})]})]})]})]})})}),Le.length>0&&e.jsx(v,{className:"mb-6 border-blue-200 bg-gradient-to-r from-blue-50 to-white shadow-md",children:e.jsx(w,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(A,{checked:de.length===Le.length&&Le.length>0,onCheckedChange:()=>{de.length===Le.length?he([]):he(Le.map(e=>e.id))},className:"flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:de.length>0?`${de.length} selecionada${de.length>1?"s":""}`:"Selecionar todas"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[Le.length," tarefa",Le.length>1?"s":""," disponÃ­vel",Le.length>1?"is":""]})]})]}),de.length>0&&e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto",children:[e.jsx(h,{variant:"outline",size:"sm",onClick:()=>he([]),className:"flex-1 sm:flex-none",children:"Desmarcar"}),e.jsxs(h,{variant:"destructive",size:"sm",onClick:async()=>{if(0===de.length)return void n.error("Selecione pelo menos uma tarefa");const e=de.length;if(confirm(`Deletar ${e} tarefa${e>1?"s":""}?`))try{const a=[...de];for(const e of a)await ve(e);if(await t.invalidateQueries({queryKey:["tasks"]}),await t.refetchQueries({queryKey:["tasks"]}),he([]),n.success(`${e} tarefa${e>1?"s deletadas":" deletada"}!`),fe)for(const e of a)Ce(e)}catch(a){n.error(`Erro ao deletar tarefas: ${a.message}`)}},className:"flex-1 sm:flex-none bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Deletar (",de.length,")"]})]})]})})}),e.jsxs(P,{defaultValue:"pending",className:"space-y-6",children:[e.jsxs(I,{className:"grid w-full grid-cols-3 bg-white border shadow-sm",children:[e.jsxs(O,{value:"pending",className:"data-[state=active]:bg-blue-50 data-[state=active]:text-blue-700",children:[e.jsx(b,{className:"h-4 w-4 mr-2"}),"Pendentes (",De.length,")"]}),e.jsxs(O,{value:"in_progress",className:"data-[state=active]:bg-blue-50 data-[state=active]:text-blue-700",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Em Progresso (",Pe.length,")"]}),e.jsxs(O,{value:"completed",className:"data-[state=active]:bg-blue-50 data-[state=active]:text-blue-700",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"ConcluÃ­das (",Ie.length,")"]})]}),e.jsx(q,{value:"pending",className:"space-y-4",children:0===De.length?e.jsx(qe,{icon:b,title:"Nenhuma tarefa pendente",description:"Crie uma nova tarefa para comeÃ§ar"}):De.map(a=>e.jsx(Oe,{task:a},a.id))}),e.jsx(q,{value:"in_progress",className:"space-y-4",children:0===Pe.length?e.jsx(qe,{icon:B,title:"Nenhuma tarefa em progresso",description:"Mova tarefas pendentes para comeÃ§ar"}):Pe.map(a=>e.jsx(Oe,{task:a},a.id))}),e.jsx(q,{value:"completed",className:"space-y-4",children:0===Ie.length?e.jsx(qe,{icon:J,title:"Nenhuma tarefa concluÃ­da",description:"Complete tarefas para vÃª-las aqui"}):Ie.map(a=>e.jsx(Oe,{task:a},a.id))})]}),e.jsx(S,{open:ne,onOpenChange:le,children:e.jsxs(T,{className:"max-w-md",children:[e.jsx(E,{children:e.jsx(L,{className:"text-xl font-semibold",children:"Editar Tarefa"})}),oe&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"edit-title",children:"TÃ­tulo *"}),e.jsx(x,{id:"edit-title",value:oe.title,onChange:e=>ce({...oe,title:e.target.value}),placeholder:"Digite o tÃ­tulo",className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"edit-description",children:"DescriÃ§Ã£o"}),e.jsx(D,{id:"edit-description",value:oe.description||"",onChange:e=>ce({...oe,description:e.target.value}),placeholder:"Descreva a tarefa",className:"mt-1",rows:3})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"edit-priority",children:"Prioridade"}),e.jsxs(g,{value:oe.priority,onValueChange:e=>ce({...oe,priority:e}),children:[e.jsx(p,{className:"mt-1",children:e.jsx(f,{})}),e.jsxs(j,{children:[e.jsx(y,{value:"low",children:"Baixa"}),e.jsx(y,{value:"medium",children:"MÃ©dia"}),e.jsx(y,{value:"high",children:"Alta"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"edit-due_date",children:"Vencimento"}),e.jsx(x,{id:"edit-due_date",type:"date",value:oe.due_date?oe.due_date.split("T")[0]:"",onChange:e=>ce({...oe,due_date:e.target.value}),className:"mt-1"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"edit-status",children:"Status"}),e.jsxs(g,{value:oe.status,onValueChange:e=>ce({...oe,status:e}),children:[e.jsx(p,{className:"mt-1",children:e.jsx(f,{})}),e.jsxs(j,{children:[e.jsx(y,{value:"pending",children:"Pendente"}),e.jsx(y,{value:"in_progress",children:"Em Progresso"}),e.jsx(y,{value:"completed",children:"ConcluÃ­da"})]})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"edit-assigned_to",children:"ResponsÃ¡vel"}),e.jsxs(g,{value:oe.assigned_to?.toString()||"none",onValueChange:e=>ce({...oe,assigned_to:"none"===e?void 0:parseInt(e)}),children:[e.jsx(p,{className:"mt-1",children:e.jsx(f,{placeholder:"Selecione"})}),e.jsxs(j,{children:[e.jsx(y,{value:"none",children:"Sem responsÃ¡vel"}),Ee.map(a=>e.jsx(y,{value:a.id.toString(),children:a.name},a.id))]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(h,{variant:"outline",onClick:()=>le(!1),children:"Cancelar"}),e.jsx(h,{onClick:async()=>{if(oe)try{await ye(oe.id,{title:oe.title,description:oe.description,priority:oe.priority,due_date:oe.due_date,assigned_to:oe.assigned_to,status:oe.status}),le(!1),ce(null),n.success(fe?"Tarefa atualizada!":"Atualizada offline",{icon:fe?"âœ…":"ðŸ“´"}),fe&&oe&&ke(oe)}catch(e){n.error("Erro ao atualizar tarefa")}},disabled:pe,className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800",children:"Salvar"})]})]})]})})]})})})}export{Z as default};
