import{j as e}from"./ui-CM4P41nz.js";import{r as t,R as s}from"./vendor-v6ZOr5pf.js";import{l as a,f as r,C as i,a as n,d as o,b as d,e as l,m as c,n as m,c as x,o as h,B as u,U as p,X as g,L as v,I as j,p as b,q as f,r as y,s as N,t as w,v as D,g as k,j as C,k as E,D as S,w as T,x as $,y as z,R as I,z as F}from"./index-CWjLUraS.js";import{u as A}from"./useQuery-CEoHAwJT.js";import{E as M,F as O}from"./calendar-ZCcGuaC5.js";import{P as L}from"./plus-ByMwV0Hi.js";import{C as R}from"./cake-DRAFF-uV.js";import{C as P}from"./clock-IPBpP8bD.js";import{M as _}from"./map-pin-B4nyNfs3.js";import{D as q,a as J,b as U,c as K}from"./dialog-IGU4em-v.js";import{T as V}from"./textarea-B1r2XpXt.js";import{S as B}from"./save-r-JKR8Yz.js";import{T as Y}from"./trash-2-INpvcEn5.js";import{n as H}from"./notificationService-Bb4GK-tC.js";import"./charts-56rtB2he.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=a("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),Q=a("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),W=()=>{const{data:e,isLoading:s,error:a}=A({queryKey:["system","event-permissions"],queryFn:async()=>{const e=await fetch("/api/system/event-permissions");if(!e.ok)throw new Error("Erro ao carregar permissões");return await e.json()},staleTime:3e5}),r=t.useCallback(t=>{if(!e||!e[t])return["igreja-local","asr-geral","asr-administrativo","asr-pastores","visitas","reunioes","pregacoes"];return Object.keys(e[t]).filter(s=>e[t][s])},[e]),i=t.useCallback((t,s)=>!e||!e[t]||(e[t][s]||!1),[e]);return{permissions:e,isLoading:s,error:a,getAvailableEventTypes:r,canFilterEventType:i}},X=e=>{const[t,s,a]=e.split("-");return new Date(parseInt(t),parseInt(s)-1,parseInt(a)).toLocaleDateString("pt-BR")},Z=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],ee=["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],te={"igreja-local":"bg-gradient-to-r from-red-500 to-red-600 text-white border-red-700 shadow-red-200","asr-geral":"bg-gradient-to-r from-orange-500 to-orange-600 text-white border-orange-700 shadow-orange-200","asr-administrativo":"bg-gradient-to-r from-cyan-500 to-cyan-600 text-white border-cyan-700 shadow-cyan-200","asr-pastores":"bg-gradient-to-r from-purple-500 to-purple-600 text-white border-purple-700 shadow-purple-200",visitas:"bg-gradient-to-r from-green-500 to-green-600 text-white border-green-700 shadow-green-200",reunioes:"bg-gradient-to-r from-blue-500 to-blue-600 text-white border-blue-700 shadow-blue-200",pregacoes:"bg-gradient-to-r from-indigo-500 to-indigo-600 text-white border-indigo-700 shadow-indigo-200"},se=e=>{if(e.color){const t={"#ef4444":"bg-gradient-to-r from-red-500 to-red-600 text-white border-red-700 shadow-red-200","#f97316":"bg-gradient-to-r from-orange-500 to-orange-600 text-white border-orange-700 shadow-orange-200","#06b6d4":"bg-gradient-to-r from-cyan-500 to-cyan-600 text-white border-cyan-700 shadow-cyan-200","#8b5cf6":"bg-gradient-to-r from-purple-500 to-purple-600 text-white border-purple-700 shadow-purple-200","#22c55e":"bg-gradient-to-r from-green-500 to-green-600 text-white border-green-700 shadow-green-200","#3b82f6":"bg-gradient-to-r from-blue-500 to-blue-600 text-white border-blue-700 shadow-blue-200","#6366f1":"bg-gradient-to-r from-indigo-500 to-indigo-600 text-white border-indigo-700 shadow-indigo-200"};if(t[e.color])return t[e.color]}if(e.type&&te[e.type])return te[e.type];const t=e.title.toLowerCase();return t.includes("igreja")&&t.includes("local")?te["igreja-local"]:t.includes("asr")&&t.includes("geral")?te["asr-geral"]:t.includes("asr")&&t.includes("administrativo")?te["asr-administrativo"]:t.includes("asr")&&t.includes("pastores")?te["asr-pastores"]:t.includes("visita")||t.includes("evangelismo")||t.includes("missao")?te.visitas:t.includes("reuniao")||t.includes("reunião")?te.reunioes:t.includes("prega")||t.includes("sermao")||t.includes("culto")?te.pregacoes:te.reunioes},ae={"igreja-local":"Igreja Local","asr-geral":"ASR Geral","asr-administrativo":"ASR Administrativo","asr-pastores":"ASR Pastores",visitas:"Visitas",reunioes:"Reuniões",pregacoes:"Pregações"},re=t.memo(function({onEventClick:s,onNewEvent:a,onDateClick:g,events:v,activeFilters:j=[],eventTypes:b=[],showBirthdays:f=!1}){const{user:y}=r(),{canFilterEventType:N}=W(),[w,D]=t.useState(new Date),[k,C]=t.useState(new Set),[E,S]=t.useState(null),{birthdays:T,isLoading:$}=(()=>{const{user:e}=r(),{data:t={today:[],thisMonth:[],all:[]},isLoading:s,error:a}=A({queryKey:["birthdays",e?.id],queryFn:async()=>{const t={};e?.id&&(t["x-user-id"]=e.id.toString(),t["x-user-role"]=e.role);const s=await fetch("/api/users/birthdays",{headers:t});if(!s.ok)throw new Error("Falha ao buscar aniversariantes");return s.json()},enabled:!!e,staleTime:3e5,gcTime:6e5,refetchInterval:9e5,refetchOnWindowFocus:!1});return{birthdays:t,isLoading:s,error:a?a instanceof Error?a.message:"Erro desconhecido":null}})(),z=t.useCallback(e=>{C(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s})},[]),{data:I,isLoading:F,error:O}=A({queryKey:["events",y?.role],queryFn:()=>(async e=>{try{const t=[],s=await fetch(`/api/events?role=${e||"interested"}`),a=s.ok?await s.json():[],r=t.map(e=>({id:e.id,title:e.title||`Visita - ${e.requesterName||"Usuário"}`,description:e.description||e.notes,startDate:e.scheduledAt?e.scheduledAt.split("T")[0]:"",time:e.scheduledAt?e.scheduledAt.split("T")[1]?.substring(0,5):"",duration:e.duration||60,location:e.location,type:"visitas",attendees:1,maxAttendees:5,status:e.status||"scheduled",organizer:e.organizer||"Sistema"})),i=a.map(e=>{const t=e.date||e.start_date||e.startDate;let s="";t&&("string"==typeof t?s=t.split("T")[0]:t instanceof Date&&(s=t.toISOString().split("T")[0]));let a="";const r=e.end_date||e.endDate;return r&&("string"==typeof r?a=r.split("T")[0]:r instanceof Date&&(a=r.toISOString().split("T")[0])),{id:e.id,title:e.title,description:e.description,startDate:s,endDate:a||void 0,time:void 0,duration:void 0,location:e.location,type:e.type,attendees:void 0,maxAttendees:void 0,status:"confirmed",organizer:e.organizerId?`ID ${e.organizerId}`:"Sistema"}});return[...r,...i]}catch(O){return[]}})(y?.role),enabled:!!y?.role}),q=I?.filter(e=>{if(y?.role&&!N(y.role,e.type))return!1;if(j.length>0){return j.includes(e.type)}return!0}),J=e=>new Date(`2000-01-01T${e}`).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),U=e=>{if(!f)return[];const t=e.getMonth(),s=e.getDate();return(T.all||[]).filter(e=>{if(!e.birthDate)return!1;let a=e.birthDate;e.birthDate.includes("T")&&e.birthDate.includes("Z")&&(a=e.birthDate.split("T")[0]);const[r,i,n]=a.split("-"),o=parseInt(i)-1,d=parseInt(n),l=o===t&&d===s;return l})},K=(e=>{const t=e.getFullYear(),s=e.getMonth(),a=new Date(t,s,1),r=new Date(t,s+1,0).getDate(),i=a.getDay(),n=[];for(let o=0;o<i;o++)n.push(null);for(let o=1;o<=r;o++){const e=`${t}-${String(s+1).padStart(2,"0")}-${String(o).padStart(2,"0")}`;n.push(e)}return n})(w),V=e=>{if(!e)return!1;const t=new Date;return e===new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())).toISOString().split("T")[0]},B=e=>{e&&(S(e),g?.(e))},Y=e=>{return e?(t=e,(q?.filter(e=>{const s=e.startDate,a=e.endDate||e.startDate,r=new Date(t+"T00:00:00"),i=r>=new Date(s+"T00:00:00")&&r<=new Date(a+"T23:59:59");return e.endDate&&(e.startDate,e.endDate),i})||[]).sort((e,t)=>{const s=H(e),a=H(t);if(s&&!a)return-1;if(!s&&a)return 1;if(s&&a){const s=new Date(e.endDate||e.startDate).getTime()-new Date(e.startDate).getTime();return new Date(t.endDate||t.startDate).getTime()-new Date(t.startDate).getTime()-s}return e.title.localeCompare(t.title)})):[];var t},H=e=>e.endDate&&e.startDate!==e.endDate,Q=(e,t)=>H(e)&&e.startDate===t,re=(e,t)=>H(e)&&e.endDate===t,ie=(e,t)=>H(e)&&e.endDate&&t>e.startDate&&t<e.endDate;return F?e.jsx("div",{className:"text-center py-8",children:"Carregando calendário..."}):O?e.jsxs("div",{className:"text-center py-8 text-red-500",children:["Erro ao carregar eventos: ",O.message]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(i,{children:[e.jsx(n,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{className:"h-5 w-5 text-primary"}),e.jsxs(d,{className:"text-lg",children:[Z[w.getMonth()]," ",w.getFullYear()]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{D(new Date(w.getFullYear(),w.getMonth()-1,1))},"data-testid":"previous-month",children:e.jsx(c,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{D(new Date(w.getFullYear(),w.getMonth()+1,1))},"data-testid":"next-month",children:e.jsx(m,{className:"h-4 w-4"})}),e.jsxs(l,{size:"sm",onClick:a,className:"bg-primary hover:bg-primary-dark","data-testid":"new-event",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Novo Evento"]})]})]})}),e.jsxs(x,{children:[e.jsxs("div",{className:"block sm:hidden",children:[e.jsxs("div",{className:"grid grid-cols-7 gap-1 mb-4",children:[ee.map(t=>e.jsx("div",{className:"p-2 text-center text-sm font-medium text-muted-foreground border-b",children:t},t)),K.map((t,s)=>{const a=Y(t),r=V(t),i=E===t;return e.jsx("div",{className:h("min-h-[50px] p-2 border border-border cursor-pointer hover:bg-muted/50 transition-colors flex flex-col items-center justify-center",r&&"bg-primary/10 border-primary text-primary font-bold",i&&"bg-primary/20 border-primary",!t&&"bg-muted/20 cursor-not-allowed"),onClick:()=>B(t),"data-testid":t?`calendar-day-${t}`:`empty-day-${s}`,children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-base font-medium",children:parseInt(t.split("-")[2])}),a.length>0&&e.jsx("div",{className:"flex gap-0.5 mt-1 justify-center",children:(()=>{const s=a.reduce((e,t)=>(e[t.type]||(e[t.type]=[]),e[t.type].push(t),e),{});return Object.keys(s).slice(0,4).map((a,r)=>{const i=M.find(e=>e.id===a),n=i?.color||"bg-gray-500";return e.jsx("div",{className:`w-2 h-1 rounded-full ${n}`,title:`${i?.label||a}: ${s[a].length} evento(s)`},`${t}-${a}-${r}`)})})()})]})},s)})]}),E&&e.jsxs("div",{className:"mt-4 space-y-1",children:[e.jsxs("h3",{className:"text-lg font-semibold text-center mb-3",children:["Eventos do dia ",parseInt(E.split("-")[2])]}),Y(E).map(t=>{const a=H(t),r=Q(t,E),i=re(t,E),n=ie(t,E);return e.jsxs("div",{className:h("text-xs p-1.5 rounded-lg border-2 cursor-pointer hover:scale-105 hover:shadow-lg transition-all duration-200 shadow-md relative group overflow-hidden min-h-[2.5rem] flex flex-col",se(t),a&&"border-2 shadow-lg",r&&"rounded-l-lg rounded-r-none border-l-4 border-r-0",i&&"rounded-r-lg rounded-l-none border-r-4 border-l-0",n&&"rounded-none border-l-0 border-r-0"),onClick:()=>s?.(t),"data-testid":`mobile-event-${t.id}`,title:a?`${t.title} (${t.startDate} - ${t.endDate})`:t.title,children:[e.jsx("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-lg"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"font-semibold flex items-start gap-1.5 text-xs leading-tight",children:[a&&e.jsx(G,{className:"h-3 w-3 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs font-medium break-words leading-tight min-h-[1.2em]",children:a?r?`${t.title} (Início)`:i?`${t.title} (Fim)`:t.title:t.title})]}),t.time&&e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:"text-xs opacity-90",children:J(t.time)})})]})]},t.id)}),(()=>{const[t,s,a]=E.split("-"),r=new Date(parseInt(t),parseInt(s)-1,parseInt(a)),i=U(r);return i.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-md font-semibold mb-2",children:"Aniversariantes"}),i.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-gradient-to-r from-pink-400 to-pink-500 text-white border-2 border-pink-600 cursor-pointer hover:shadow-lg transition-all duration-200 shadow-md","data-testid":`mobile-birthday-${t.id}`,children:[e.jsx(R,{className:"h-5 w-5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:t.name}),e.jsx("div",{className:"text-sm opacity-90",children:"Aniversário"})]})]},`mobile-birthday-${t.id}`))]})})()]})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1 mb-4",children:[ee.map(t=>e.jsx("div",{className:"p-2 sm:p-2 p-3 text-center text-sm font-medium text-muted-foreground border-b",children:t},t)),K.map((t,a)=>{const r=Y(t),i=V(t),n=E===t;let o=[];if(t){const[e,s,a]=t.split("-"),r=new Date(parseInt(e),parseInt(s)-1,parseInt(a));o=U(r),o.length}return e.jsx("div",{className:h("min-h-[120px] sm:min-h-[120px] min-h-[140px] p-1 sm:p-1 p-2 border border-border cursor-pointer hover:bg-muted/50 transition-colors",i&&"bg-primary/10 border-primary",n&&"bg-primary/20",!t&&"bg-muted/20 cursor-not-allowed"),onClick:()=>B(t),"data-testid":t?`calendar-day-${t}`:`empty-day-${a}`,children:t&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:h("text-base sm:text-sm font-medium mb-1",i&&"text-primary font-bold"),children:parseInt(t.split("-")[2])}),e.jsxs("div",{className:"space-y-1 sm:space-y-0.5 mb-1 flex flex-col",children:[(k.has(t)?r:r.slice(0,3)).map(a=>{const r=H(a),i=Q(a,t),n=re(a,t),o=ie(a,t);return e.jsxs("div",{className:h("text-xs sm:text-xs text-sm p-2 sm:p-1.5 rounded-lg border-2 cursor-pointer hover:scale-105 hover:shadow-lg transition-all duration-200 shadow-md relative group overflow-hidden min-h-[3rem] sm:min-h-[2.5rem] flex flex-col",se(a),r&&"border-2 shadow-lg",i&&"rounded-l-lg rounded-r-none border-l-4 border-r-0",n&&"rounded-r-lg rounded-l-none border-r-4 border-l-0",o&&"rounded-none border-l-0 border-r-0"),onClick:e=>{e.stopPropagation(),s?.(a)},"data-testid":`event-${a.id}`,title:r?`${a.title} (${a.startDate} - ${a.endDate})`:a.title,children:[e.jsx("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-lg"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"font-semibold flex items-start gap-1.5 text-sm sm:text-xs leading-tight",children:[r&&e.jsx(G,{className:"h-4 w-4 sm:h-3 sm:w-3 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm sm:text-xs font-medium break-words leading-tight min-h-[1.2em]",children:r?i?`${a.title} (Início)`:n?`${a.title} (Fim)`:a.title:a.title})]}),a.time&&e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:"text-sm sm:text-xs opacity-90",children:J(a.time)})})]})]},a.id)}),r.length>3&&!k.has(t)&&e.jsx("div",{className:"text-xs text-muted-foreground text-center py-1 px-2 bg-gray-100/80 rounded-md border border-gray-200 hover:bg-gray-200/80 transition-colors cursor-pointer",onClick:e=>{e.stopPropagation(),z(t)},children:e.jsxs("span",{className:"font-medium",children:["+",r.length-3," mais eventos"]})}),r.length>3&&k.has(t)&&e.jsx("div",{className:"text-xs text-muted-foreground text-center py-1 px-2 bg-gray-100/80 rounded-md border border-gray-200 hover:bg-gray-200/80 transition-colors cursor-pointer",onClick:e=>{e.stopPropagation(),z(t)},children:e.jsx("span",{className:"font-medium",children:"Ver menos"})})]}),e.jsx("div",{className:"flex flex-col space-y-1 sm:space-y-0.5",children:o.map(t=>e.jsxs("div",{className:"p-2 sm:p-1.5 rounded-lg text-sm sm:text-xs cursor-pointer hover:scale-105 hover:shadow-lg transition-all duration-200 shadow-md bg-gradient-to-r from-pink-400 to-pink-500 text-white border-2 border-pink-600 flex-shrink-0 group relative overflow-hidden min-h-[2.5rem] sm:min-h-[2rem]","data-testid":`birthday-${t.id}`,children:[e.jsx("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-lg"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(R,{className:"h-4 w-4 sm:h-3 sm:w-3 flex-shrink-0"}),e.jsx("span",{className:"font-semibold break-words text-sm sm:text-xs",children:t.name})]}),e.jsxs("div",{className:"text-sm sm:text-xs opacity-90 mt-0.5 flex items-center gap-1",children:[e.jsx("div",{className:"w-1 h-1 bg-white/60 rounded-full"}),e.jsx("span",{children:"Aniversário"})]})]})]},`birthday-${t.id}`))})]})},a)})]})})]})]}),E&&e.jsxs(i,{className:"hidden sm:block",children:[e.jsx(n,{children:e.jsxs(d,{className:"text-lg",children:["Eventos do dia ",X(E)]})}),e.jsx(x,{children:e.jsx("div",{className:"space-y-3",children:0===Y(E).length?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(o,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Nenhum evento neste dia"}),e.jsxs(l,{variant:"outline",size:"sm",className:"mt-2",onClick:a,"data-testid":"add-event-selected-date",children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Adicionar Evento"]})]}):Y(E).map(t=>{const a=H(t),r=Q(t,E),i=re(t,E),n=ie(t,E);return e.jsx("div",{className:h("p-2 border rounded-lg hover:shadow-md transition-shadow cursor-pointer",a&&"border-2",r&&"border-l-4 border-l-green-500 rounded-l-lg",i&&"border-r-4 border-r-red-500 rounded-r-lg",n&&"border-t-2 border-b-2 border-t-blue-500 border-b-blue-500 rounded-none"),onClick:()=>s?.(t),"data-testid":`detailed-event-${t.id}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:a?r?`${t.title} (Início)`:i?`${t.title} (Fim)`:`${t.title} (Continua)`:t.title}),a&&e.jsxs(u,{variant:"secondary",className:"bg-blue-100 text-blue-800 text-xs",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),r?"Início":i?"Fim":"Continua"]})]}),t.description&&e.jsx("p",{className:"text-muted-foreground mt-1 text-xs",children:t.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"h-3 w-3"}),e.jsxs("span",{className:"text-xs",children:[t.time?J(t.time):""," (",t.duration||60,"min)"]})]}),t.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(_,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs",children:t.location})]}),t.attendees&&t.maxAttendees&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(p,{className:"h-3 w-3"}),e.jsxs("span",{className:"text-xs",children:[t.attendees,"/",t.maxAttendees]})]}),a&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(G,{className:"h-3 w-3"}),e.jsxs("span",{className:"text-xs",children:[r&&"Início",i&&"Fim",n&&"Continua"]})]})]})]}),e.jsx(u,{className:`${te[t.type]} font-medium shadow-sm text-xs`,children:ae[t.type]})]})},t.id)})})})]}),f&&e.jsxs(i,{children:[e.jsx(n,{className:"pb-3",children:e.jsxs(d,{className:"text-base flex items-center gap-2 text-green-800",children:[e.jsx(R,{className:"h-4 w-4 text-green-600"}),"Aniversariantes de ",Z[w.getMonth()]]})}),e.jsx(x,{children:$?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Carregando aniversariantes..."}):(()=>{const t=(T.all||[]).filter(e=>{if(!e.birthDate)return!1;const[t,s]=e.birthDate.split("-");return parseInt(s)-1===w.getUTCMonth()});return 0===t.length?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:["Nenhum aniversariante em ",Z[w.getMonth()]]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:t.map(t=>{const s=t.birthDate;let a="",r="";if(s.includes("-")){const[e,t,i]=s.split("-");a=i,r=t}else if(s.includes("/")){const[e,t,i]=s.split("/");a=e,r=t}return e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border bg-green-50 border-green-200","data-testid":`birthday-card-${t.id}`,children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:a}),e.jsx("div",{className:"text-xs text-green-500",children:Z[parseInt(r)-1]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",children:t.name}),t.church&&e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:t.church})]})]},t.id)})})})()})]})]})}),ie=e=>{const[t,s,a]=e.split("-");return new Date(parseInt(t),parseInt(s)-1,parseInt(a)).toLocaleDateString("pt-BR")},ne=[{value:"estudos",label:"Estudos"},{value:"reunioes",label:"Reuniões"},{value:"visitas",label:"Visitas"},{value:"oracao",label:"Oração"},{value:"chamadas",label:"Chamadas"},{value:"cultos",label:"Cultos"},{value:"igreja-local",label:"Igreja Local"},{value:"asr-geral",label:"ASR Geral"},{value:"asr-administrativo",label:"ASR Administrativo"},{value:"regional-distrital",label:"Regional/Distrital"}],oe=[{value:"scheduled",label:"Agendado"},{value:"confirmed",label:"Confirmado"},{value:"cancelled",label:"Cancelado"}],de=({event:s,isOpen:a,onClose:r,onSave:i,onDelete:n,isEditing:d=!1,eventTypes:c})=>{const m=c?c.map(e=>({value:e.id,label:e.label})):ne,[x,h]=t.useState(d||!s),[k,C]=t.useState(s||{title:"",description:"",startDate:(new Date).toISOString().split("T")[0],time:"09:00",duration:60,location:"",type:"igreja-local",maxAttendees:50,status:"scheduled",organizer:""}),E=e=>{const t=Math.floor(e/60),s=e%60;return 0===t?`${s}min`:0===s?`${t}h`:`${t}h ${s}min`};return e.jsx(q,{open:a,onOpenChange:e=>!e&&r(),children:e.jsxs(J,{className:"w-[90vw] max-w-md max-h-[80vh] overflow-y-auto p-2 sm:p-2","aria-describedby":"event-modal-description",children:[e.jsxs(U,{className:"flex flex-row items-center justify-between sticky top-0 bg-background pt-1 pb-1 border-b z-10",children:[e.jsx(K,{className:"text-xs sm:text-sm",children:s?x?"Editar Evento":"Detalhes do Evento":"Novo Evento"}),e.jsx("div",{id:"event-modal-description",className:"sr-only",children:s?x?"Formulário para editar evento existente":"Visualização dos detalhes do evento":"Formulário para criar novo evento"}),e.jsx("div",{className:"flex gap-1",children:s&&!x?e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>h(!0),"data-testid":"button-edit-event",className:"h-6 px-2 text-xs",children:[e.jsx(Q,{className:"h-3 w-3 mr-1"}),"Editar"]}):e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{s?(C(s),h(!1)):r()},"data-testid":"button-cancel-edit",className:"h-6 px-2 text-xs",children:[e.jsx(g,{className:"h-3 w-3 mr-1"}),"Cancelar"]}),e.jsxs(l,{size:"sm",onClick:()=>{i(k),h(!1),s||r()},"data-testid":"button-save-event",className:"h-6 px-2 text-xs",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),"Salvar"]})]})})]}),e.jsxs("div",{className:"space-y-2 pt-1 pb-2",children:[!x&&s&&e.jsx("div",{className:"flex items-start space-x-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold mb-1","data-testid":"text-event-title",children:s.title}),e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[e.jsx(u,{className:`${(e=>{const t={estudos:"bg-blue-500 text-white border-blue-600",reunioes:"bg-emerald-500 text-white border-emerald-600",visitas:"bg-purple-500 text-white border-purple-600",oracao:"bg-amber-500 text-white border-amber-600",chamadas:"bg-rose-500 text-white border-rose-600",cultos:"bg-indigo-500 text-white border-indigo-600","igreja-local":"bg-red-500 text-white border-red-600","asr-geral":"bg-orange-500 text-white border-orange-600","asr-administrativo":"bg-cyan-500 text-white border-cyan-600","regional-distrital":"bg-slate-500 text-white border-slate-600"};return t[e]||t.estudos})(s.type)} text-xs`,"data-testid":"badge-event-type",children:m.find(e=>e.value===s.type)?.label}),e.jsx(u,{className:`${(e=>{const t={scheduled:"bg-yellow-100 text-yellow-800",confirmed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"};return t[e]||t.scheduled})(s.status)} text-xs`,"data-testid":"badge-event-status",children:oe.find(e=>e.value===s.status)?.label}),s.isRecurring&&e.jsx(u,{variant:"outline","data-testid":"badge-recurring",className:"text-xs",children:"Recorrente"})]}),s.description&&e.jsx("p",{className:"text-xs text-muted-foreground mb-2","data-testid":"text-event-description",children:s.description})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(v,{htmlFor:"title",className:"text-xs",children:"Título"}),x?e.jsx(j,{id:"title",value:k.title,onChange:e=>C({...k,title:e.target.value}),placeholder:"Ex: Culto da Manhã","data-testid":"input-event-title",className:"mt-1 h-6 text-xs"}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s?.title})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(v,{htmlFor:"description",className:"text-xs",children:"Descrição"}),x?e.jsx(V,{id:"description",value:k.description,onChange:e=>C({...k,description:e.target.value}),placeholder:"Descrição opcional...",rows:2,"data-testid":"input-event-description",className:"mt-1 text-xs min-h-[60px]"}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s?.description||"Nenhuma descrição"})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"type",className:"text-xs",children:"Tipo"}),x?e.jsxs(b,{value:k.type,onValueChange:e=>C({...k,type:e}),children:[e.jsx(f,{"data-testid":"select-event-type",className:"mt-1 h-6 text-xs",children:e.jsx(y,{})}),e.jsx(N,{children:m.map(t=>e.jsx(w,{value:t.value,children:t.label},t.value))})]}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:m.find(e=>e.value===s?.type)?.label})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"status",className:"text-xs",children:"Status"}),x?e.jsxs(b,{value:k.status,onValueChange:e=>C({...k,status:e}),children:[e.jsx(f,{"data-testid":"select-event-status",className:"mt-1 h-6 text-xs",children:e.jsx(y,{})}),e.jsx(N,{children:oe.map(t=>e.jsx(w,{value:t.value,children:t.label},t.value))})]}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:oe.find(e=>e.value===s?.status)?.label})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"date",className:"text-xs",children:"Data de Início"}),x?e.jsx(j,{id:"date",type:"date",value:k.startDate,onChange:e=>C({...k,startDate:e.target.value}),"data-testid":"input-event-date",className:"mt-1 h-6 text-xs"}):e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(o,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s?.startDate?ie(s.startDate):"",s?.endDate&&s.endDate!==s.startDate&&e.jsxs("span",{className:"text-muted-foreground",children:[" - ",ie(s.endDate)]})]})]})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"endDate",className:"text-xs",children:"Data de Fim (opcional)"}),x?e.jsx(j,{id:"endDate",type:"date",value:k.endDate,onChange:e=>C({...k,endDate:e.target.value}),"data-testid":"input-event-end-date",className:"mt-1 h-6 text-xs"}):e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(o,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s?.endDate?ie(s.endDate):"Evento de um dia"})]})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"time",className:"text-xs",children:"Horário"}),x?e.jsx(j,{id:"time",type:"time",value:k.time,onChange:e=>C({...k,time:e.target.value}),"data-testid":"input-event-time",className:"mt-1 h-6 text-xs"}):e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(P,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s?.time," (",E(s?.duration||0),")"]})]})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"duration",className:"text-xs",children:"Duração"}),x?e.jsx(j,{id:"duration",type:"number",min:"15",step:"15",value:k.duration,onChange:e=>C({...k,duration:parseInt(e.target.value)}),"data-testid":"input-event-duration",className:"mt-1 h-6 text-xs"}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:E(s?.duration||0)})]}),e.jsxs("div",{children:[e.jsx(v,{htmlFor:"maxAttendees",className:"text-xs",children:"Capacidade"}),x?e.jsx(j,{id:"maxAttendees",type:"number",min:"1",value:k.maxAttendees,onChange:e=>C({...k,maxAttendees:parseInt(e.target.value)}),"data-testid":"input-event-capacity",className:"mt-1 h-6 text-xs"}):e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(p,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s?.attendees||0,"/",s?.maxAttendees," pessoas"]})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(v,{htmlFor:"location",className:"text-xs",children:"Local"}),x?e.jsx(j,{id:"location",value:k.location,onChange:e=>C({...k,location:e.target.value}),placeholder:"Ex: Igreja Central","data-testid":"input-event-location",className:"mt-1 h-6 text-xs"}):e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(_,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s?.location||"Local não informado"})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(v,{htmlFor:"organizer",className:"text-xs",children:"Organizador"}),x?e.jsx(j,{id:"organizer",value:k.organizer,onChange:e=>C({...k,organizer:e.target.value}),placeholder:"Nome do organizador","data-testid":"input-event-organizer",className:"mt-1 h-7 text-xs"}):e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(D,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s?.organizer||"Organizador não informado"})]})]})]}),s&&!x&&n&&e.jsx("div",{className:"flex justify-end pt-3 border-t mt-4",children:e.jsxs(l,{variant:"destructive",size:"sm",onClick:()=>n(s.id),"data-testid":"button-delete-event",className:"h-7 px-2 text-xs",children:[e.jsx(Y,{className:"h-3 w-3 mr-1"}),"Excluir"]})})]})]})})},le="/api/google-sheets/proxy",ce="1i-x-0KiciwACRztoKX-YHlXT4FsrAzaKwuH-hHkD8go",me="Agenda";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function xe(){const{toast:a}=k(),{user:i}=r();C();const[n,o]=t.useState(null),[d,c]=t.useState(!1),[m,x]=t.useState(!1),[h,p]=t.useState([]),[g,v]=t.useState(!1),[j,b]=t.useState(!1),{canFilterEventType:f,permissions:y,isLoading:N}=W();t.useEffect(()=>{const e=e=>{if(e.reason?.message?.includes("message channel closed")||e.reason?.message?.includes("listener indicated an asynchronous response"))return e.preventDefault(),e.stopPropagation(),!1},t=e=>{if(e.message?.includes("message channel closed")||e.message?.includes("listener indicated an asynchronous response"))return e.preventDefault(),e.stopPropagation(),!1};return window.addEventListener("unhandledrejection",e),window.addEventListener("error",t),()=>{window.removeEventListener("unhandledrejection",e),window.removeEventListener("error",t),c(!1)}},[]);const{data:w,isLoading:D,refetch:L}=A({queryKey:["events"],queryFn:async()=>{const e=await fetch("/api/calendar/events",{headers:{"x-user-id":"1"}});if(!e.ok)throw new Error("Erro ao buscar eventos");const t=await e.json(),s=Array.from(new Map(t.map(e=>[`${e.title}_${e.date}_${e.type}`,e])).values());return s.length,t.length,s},staleTime:12e4,gcTime:3e5,refetchInterval:6e5,refetchOnMount:!1,refetchOnWindowFocus:!1}),P=w?.map(e=>({...e,startDate:e.date||e.startDate,endDate:e.end_date||e.endDate||e.date}))||[],_=s.useMemo(()=>{const e=new Map;return M.forEach(t=>{e.set(t.id,t)}),P.forEach(t=>{if(t.type&&!e.has(t.type)){const s=t.color||"#64748b";e.set(t.type,{id:t.type,label:t.type.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),hexColor:s,color:"dynamic",isDynamic:!0})}}),Array.from(e.values())},[P]);t.useEffect(()=>{if(i?.role&&y&&!N&&_.length>0){const e=_.map(e=>e.id);p(e)}},[i?.role,y,N,_]),t.useEffect(()=>{let e=!0;const t=t=>{try{if(!e)return;t.detail&&t.detail.type}catch(s){}};return window.addEventListener("import-success",t),()=>{e=!1,window.removeEventListener("import-success",t)}},[]);const q=async e=>{try{const t={id:e.id,titulo:e.title,data_inicio:e.date||e.startDate,data_fim:e.end_date||e.endDate||e.date||e.startDate,categoria:e.type,descricao:e.description||"",local:e.location||""},s=await fetch(le,{method:"POST",headers:{"Content-Type":"application/json","x-user-id":"1"},body:JSON.stringify({action:"addEvent",spreadsheetId:ce,sheetName:me,eventData:t})});if(s.ok){(await s.json()).success}}catch(t){}},J=async e=>{try{await fetch(le,{method:"POST",headers:{"Content-Type":"application/json","x-user-id":"1"},body:JSON.stringify({action:"deleteEvent",spreadsheetId:ce,sheetName:me,eventId:e.id})}),await q(e)}catch(t){}},U=async e=>{try{const t=await fetch(le,{method:"POST",headers:{"Content-Type":"application/json","x-user-id":"1"},body:JSON.stringify({action:"deleteEvent",spreadsheetId:ce,sheetName:me,eventId:e})});if(t.ok){(await t.json()).success}}catch(t){}};return e.jsx(E,{children:e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Agenda"}),e.jsx("p",{className:"text-muted-foreground",children:"Sincronizada automaticamente com Google Sheets"})]})}),e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[e.jsxs(S,{children:[e.jsx(T,{asChild:!0,children:e.jsxs(l,{variant:"outline",size:"sm",className:"h-8",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Filtros de Eventos"]})}),e.jsxs($,{align:"start",className:"w-56",children:[e.jsxs("div",{className:"flex items-center justify-between p-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Tipos de Evento"}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{p([])},className:"h-auto p-1 text-xs",children:"Limpar"})]}),_.filter(e=>!i?.role||f(i.role,e.id)).map(t=>e.jsx(z,{checked:h.includes(t.id),onCheckedChange:e=>((e,t)=>{!i?.role||f(i.role,e)?p(t?t=>[...t,e]:t=>t.filter(t=>t!==e)):a({title:"Acesso negado",description:"Você não tem permissão para filtrar este tipo de evento.",variant:"destructive"})})(t.id,e),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-4 h-4 rounded-full shadow-sm ${t.isDynamic?"":t.color}`,style:t.isDynamic?{backgroundColor:t.hexColor||"#64748b"}:{}}),e.jsx("span",{children:t.label}),t.isDynamic&&e.jsx("span",{className:"text-xs text-emerald-600 ml-1",children:"✨"})]})},t.id))]})]}),e.jsxs(l,{variant:g?"default":"outline",size:"sm",className:g?"h-8 bg-pink-100 border-pink-300 text-pink-800 hover:bg-pink-200":"h-8 bg-pink-50 border-pink-200 text-pink-700 hover:bg-pink-100",onClick:()=>v(!g),children:[e.jsx(R,{className:"h-4 w-4 mr-2"}),g?"Ocultar Aniversariantes":"Mostrar Aniversariantes"]}),e.jsxs(l,{variant:"outline",size:"sm",onClick:async()=>{b(!0),await(async(e=!1)=>{try{e&&F.info("Sincronizando...");const t=await fetch("/api/calendar/google-drive-config"),s=await t.json();if(!s.spreadsheetUrl)return;const a=await fetch("/api/calendar/sync-google-drive",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({spreadsheetUrl:s.spreadsheetUrl})});if(a.ok){const t=await a.json();(t.importedCount>0||t.updatedCount>0||t.deletedCount>0)&&(await L(),e&&F.success("Sincronizado!"))}}catch(t){e&&F.error("Erro ao sincronizar")}})(!0),b(!1)},disabled:j,className:"h-8 flex items-center gap-2 bg-blue-50 border-blue-200 hover:bg-blue-100",children:[e.jsx(I,{className:"h-4 w-4 "+(j?"animate-spin":"")}),j?"Sincronizando...":"Sincronizar"]})]})}),h.length>0&&h.length<M.length&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Filtros ativos:"}),h.map(t=>{const s=M.find(e=>e.id===t);return s?e.jsx(u,{variant:"secondary",className:`${s.color} font-medium shadow-sm hover:shadow-md transition-shadow`,children:s.label},t):null})]}),e.jsx(re,{onEventClick:e=>{o(e),x(!1),c(!0)},onNewEvent:()=>{o(null),x(!0),c(!0)},activeFilters:h,eventTypes:M,showBirthdays:g}),e.jsx(de,{event:n||void 0,isOpen:d,onClose:()=>c(!1),onSave:async e=>{try{if(m){const s=await fetch("/api/calendar/events",{method:"POST",headers:{"Content-Type":"application/json","x-user-id":"1"},body:JSON.stringify({title:e.title,description:e.description||"",date:e.startDate,end_date:e.endDate||e.startDate,type:e.type||"reunioes",location:e.location||"",created_by:1})});if(!s.ok)throw new Error("Erro ao criar evento");const a=await s.json();if(await q(a),F.success("Evento criado!"),e.title&&e.startDate)try{await H.notifyEventCreated(e.title,e.startDate)}catch(t){}}else if(n){const t=await fetch(`/api/calendar/events/${n.id}`,{method:"PUT",headers:{"Content-Type":"application/json","x-user-id":"1"},body:JSON.stringify({title:e.title,description:e.description,date:e.startDate,end_date:e.endDate,type:e.type,location:e.location})});if(!t.ok)throw new Error("Erro ao atualizar evento");const s=await t.json();await J(s),F.success("Evento atualizado!")}await L(),c(!1)}catch(t){F.error(`Erro: ${t?.message||"Erro desconhecido"}`)}},onDelete:async e=>{try{if(!(await fetch(`/api/calendar/events/${e}`,{method:"DELETE",headers:{"x-user-id":"1"}})).ok)throw new Error("Erro ao deletar evento");await U(e),F.success("Evento deletado!"),await L(),c(!1)}catch(t){F.error("Erro ao deletar evento")}},isEditing:m,eventTypes:M})]})})}export{xe as default};
