import{c as e,g as a,j as s,T as t,f as i,C as o,d as r,a as n,b as l,L as c,I as d,B as m,U as u,H as x,e as p,Q as h,R as f,i as g,Z as j,o as v,K as N,_ as y,p as b,s as w,t as C,v as S,w as z,x as k,z as D,E as A,$ as E,P as T,a0 as I,a1 as P,X as M,a2 as O}from"./index-DtHhSAMi.js";import{j as L,P as $}from"./ui-D1vmdbY6.js";import{r as B}from"./vendor-Ber6wfih.js";import{S as F}from"./switch-BNtxM37h.js";import{A as V,B as U,C as q,T as R,a as Y,b as X,c as J}from"./tabs-LK06nZPd.js";import{D as H,a as _,b as G,c as Q,d as W}from"./dialog-btQUui9q.js";import{R as Z}from"./refresh-cw-DIFDUmW4.js";import{S as K,U as ee}from"./upload-v_97tXyL.js";import{T as ae}from"./triangle-alert-DS9XUE9b.js";import{T as se}from"./target-CNCei-m9.js";import{T as te}from"./trending-up-C0IrrWiD.js";import{G as ie,M as oe}from"./mountain-CZBc5s-M.js";import{S as re}from"./shield-CRWbCi8m.js";import{T as ne}from"./trash-2-DlKxqaye.js";import{P as le}from"./plus-7BUzL6h5.js";import{L as ce}from"./loader-circle-Cl-3bEuZ.js";import"./charts-leMEfCN9.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=e("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]),me=e("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]),ue=e("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]),xe=e("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var pe="horizontal",he=["horizontal","vertical"],fe=B.forwardRef((e,a)=>{const{decorative:s,orientation:t=pe,...i}=e,o=function(e){return he.includes(e)}(t)?t:pe,r=s?{role:"none"}:{"aria-orientation":"vertical"===o?o:void 0,role:"separator"};return L.jsx($.div,{"data-orientation":o,...r,...i,ref:a})});fe.displayName="Separator";var ge=fe;const je=B.forwardRef(({className:e,orientation:s="horizontal",decorative:t=!0,...i},o)=>L.jsx(ge,{ref:o,decorative:t,orientation:s,className:a("shrink-0 bg-border","horizontal"===s?"h-[1px] w-full":"h-full w-[1px]",e),...i}));je.displayName=ge.displayName;const ve=B.forwardRef(({className:e,...s},t)=>L.jsx("div",{className:"relative w-full overflow-auto",children:L.jsx("table",{ref:t,className:a("w-full caption-bottom text-sm",e),...s})}));ve.displayName="Table";const Ne=B.forwardRef(({className:e,...s},t)=>L.jsx("thead",{ref:t,className:a("[&_tr]:border-b",e),...s}));Ne.displayName="TableHeader";const ye=B.forwardRef(({className:e,...s},t)=>L.jsx("tbody",{ref:t,className:a("[&_tr:last-child]:border-0",e),...s}));ye.displayName="TableBody";B.forwardRef(({className:e,...s},t)=>L.jsx("tfoot",{ref:t,className:a("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...s})).displayName="TableFooter";const be=B.forwardRef(({className:e,...s},t)=>L.jsx("tr",{ref:t,className:a("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...s}));be.displayName="TableRow";const we=B.forwardRef(({className:e,...s},t)=>L.jsx("th",{ref:t,className:a("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...s}));we.displayName="TableHead";const Ce=B.forwardRef(({className:e,...s},t)=>L.jsx("td",{ref:t,className:a("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...s}));Ce.displayName="TableCell";B.forwardRef(({className:e,...s},t)=>L.jsx("caption",{ref:t,className:a("mt-4 text-sm text-muted-foreground",e),...s})).displayName="TableCaption";const Se={engajamento:{baixo:10,medio:25,alto:50},classificacao:{frequente:75,naoFrequente:25},dizimista:{naoDizimista:0,pontual:25,sazonal:50,recorrente:100},ofertante:{naoOfertante:0,pontual:25,sazonal:50,recorrente:100},tempoBatismo:{doisAnos:25,cincoAnos:50,dezAnos:100,vinteAnos:150,maisVinte:200},cargos:{umCargo:50,doisCargos:100,tresOuMais:150},nomeUnidade:{comUnidade:25},temLicao:{comLicao:50},pontuacaoDinamica:{multiplicador:5},totalPresenca:{zeroATres:25,quatroASete:50,oitoATreze:100},escolaSabatina:{comunhao:50,missao:75,estudoBiblico:100,batizouAlguem:200,discipuladoPosBatismo:25},cpfValido:{valido:50},camposVaziosACMS:{semCamposVazios:100}},ze=()=>{const{config:e,isLoading:a,saveConfig:g,resetConfig:j,updateConfig:v,getTotalMaxPoints:N,getConfigSummary:y,getCurrentUserAverage:b,calculateDistrictAverage:w}=(()=>{const[e,a]=B.useState(Se),[t,i]=B.useState(!1),{toast:o}=s();B.useEffect(()=>{(async()=>{try{const e=await fetch("/api/system/points-config");if(e.ok){const s=await e.json();a(s),localStorage.setItem("pointsConfig",JSON.stringify(s))}else{const e=localStorage.getItem("pointsConfig");e&&a(JSON.parse(e))}}catch(e){const s=localStorage.getItem("pointsConfig");s&&a(JSON.parse(s))}})()},[]);const r=()=>{var a,s,t,i,o,r,n,l,c,d,m,u,x,p,h,f,g;return(e.basicPoints||0)+(e.attendancePoints||0)+(e.eventPoints||0)+(e.donationPoints||0)+(((null==(a=e.engajamento)?void 0:a.alto)||0)+((null==(s=e.classificacao)?void 0:s.frequente)||0)+((null==(t=e.dizimista)?void 0:t.recorrente)||0)+((null==(i=e.ofertante)?void 0:i.recorrente)||0)+((null==(o=e.tempoBatismo)?void 0:o.maisVinte)||0)+((null==(r=e.cargos)?void 0:r.tresOuMais)||0)+((null==(n=e.nomeUnidade)?void 0:n.comUnidade)||0)+((null==(l=e.temLicao)?void 0:l.comLicao)||0)+((null==(c=e.totalPresenca)?void 0:c.oitoATreze)||0)+((null==(d=e.batizouAlguem)?void 0:d.sim)||0)+((null==(m=e.cpfValido)?void 0:m.valido)||0)+((null==(u=e.camposVaziosACMS)?void 0:u.completos)||0))+(((null==(x=e.escolaSabatina)?void 0:x.comunhao)||0)+((null==(p=e.escolaSabatina)?void 0:p.missao)||0)+((null==(h=e.escolaSabatina)?void 0:h.estudoBiblico)||0)+((null==(f=e.escolaSabatina)?void 0:f.batizouAlguem)||0)+((null==(g=e.escolaSabatina)?void 0:g.discipuladoPosBatismo)||0))};return{config:e,isLoading:t,saveConfig:async e=>{i(!0);try{const s=await fetch("/api/system/points-config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!s.ok)throw new Error("Erro ao salvar no servidor");const t=await s.json();return localStorage.setItem("pointsConfig",JSON.stringify(e)),a(e),t.updatedUsers>0?o({title:"Configura√ß√µes salvas!",description:`${t.updatedUsers} usu√°rios tiveram seus pontos recalculados automaticamente.`}):o({title:"Configura√ß√µes salvas!",description:"As configura√ß√µes foram salvas com sucesso."}),!0}catch(s){return o({title:"Erro ao salvar",description:"N√£o foi poss√≠vel salvar as configura√ß√µes.",variant:"destructive"}),!1}finally{i(!1)}},resetConfig:()=>{a(Se),localStorage.removeItem("pointsConfig"),o({title:"Configura√ß√µes resetadas",description:"As pontua√ß√µes foram restauradas para os valores padr√£o."})},updateConfig:(e,s,t)=>{a(a=>({...a,[e]:{...a[e],[s]:t}}))},getTotalMaxPoints:r,getConfigSummary:()=>({totalMaxPoints:r(),categoriesCount:Object.keys(e).length,criteriaCount:Object.values(e).reduce((e,a)=>e+Object.keys(a).length,0)}),getCurrentParameterAverage:async()=>{try{const e=await fetch("/api/system/parameter-average");if(!e.ok)throw new Error("Erro ao obter m√©dia atual");const a=await e.json();return a.success?parseFloat(a.currentAverage):0}catch(e){return 0}},getCurrentUserAverage:async()=>{try{const e=await fetch("/api/users");if(!e.ok)throw new Error("Erro ao obter usu√°rios");const a=(await e.json()).filter(e=>"admin@7care.com"!==e.email);return 0===a.length?0:a.reduce((e,a)=>e+(a.points||("admin"===a.role?1e3:"member"===a.role?500:"missionary"===a.role?750:250)),0)/a.length}catch(e){return 0}},calculateDistrictAverage:async e=>{try{const a=await fetch("/api/system/district-average",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetAverage:e})});if(!a.ok)throw new Error("Erro ao calcular m√©dia do distrito");const s=await a.json();return s.success?(await loadConfig(),o({title:"M√©dia do Distrito Ajustada!",description:`Nova m√©dia dos usu√°rios: ${s.newUserAverage} pontos. ${s.updatedUsers} usu√°rios atualizados automaticamente.`}),{success:!0,currentAverage:s.currentUserAverage,newAverage:s.newUserAverage,adjustmentFactor:s.adjustmentFactor,updatedUsers:s.updatedUsers}):{success:!1,error:s.error||"Erro desconhecido"}}catch(a){return{success:!1,error:"Erro ao conectar com o servidor"}}}}})(),{toast:C}=s(),[S,z]=B.useState(()=>{const e=localStorage.getItem("lastDistrictAverage");return e?Number(e):null}),[k,D]=B.useState(0),[A,E]=B.useState(1),[T,I]=B.useState(()=>localStorage.getItem("lastDistrictAverageDate"));if(B.useEffect(()=>{(async()=>{const e=await b();D(e)})()},[b]),!e)return L.jsx("div",{className:"flex items-center justify-center h-64",children:L.jsxs("div",{className:"text-center",children:[L.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),L.jsx("p",{className:"text-muted-foreground",children:"Carregando configura√ß√µes..."})]})});const P=(a,s,t,i)=>{const u=s;return L.jsxs(o,{children:[L.jsx(n,{children:L.jsxs(l,{className:"flex items-center gap-2",children:[L.jsx(u,{className:"h-5 w-5 text-primary"}),a]})}),L.jsx(r,{children:L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.map(a=>{var s;return L.jsxs("div",{className:"space-y-2",children:[L.jsx(c,{htmlFor:a.key,className:"text-sm font-medium",children:a.label}),L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx(d,{id:a.key,type:"number",min:"0",value:(null==(s=e[t])?void 0:s[a.key])||0,onChange:e=>v(t,a.key,parseInt(e.target.value)||0),className:"w-24"}),L.jsx(m,{variant:"secondary",className:"text-xs",children:"pontos"})]}),L.jsx("p",{className:"text-xs text-muted-foreground",children:a.description})]},a.key)})})})]})};return L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[L.jsx(t,{className:"h-6 w-6 text-yellow-600"}),"Base de C√°lculo do Sistema"]}),L.jsx("p",{className:"text-muted-foreground",children:"Configure os pontos para cada crit√©rio de avalia√ß√£o dos usu√°rios"})]}),L.jsxs("div",{className:"flex gap-2",children:[L.jsxs(i,{variant:"outline",onClick:()=>{j()},className:"flex items-center gap-2",children:[L.jsx(Z,{className:"h-4 w-4"}),"Resetar"]}),L.jsxs(i,{onClick:async()=>{await g(e)},disabled:a,className:"flex items-center gap-2",children:[L.jsx(K,{className:"h-4 w-4"}),a?"Salvando e recalculando...":"Salvar"]})]})]}),L.jsx(o,{className:"border-orange-200 bg-orange-50",children:L.jsx(r,{className:"pt-6",children:L.jsxs("div",{className:"flex items-center gap-2 text-orange-800",children:[L.jsx(ae,{className:"h-4 w-4"}),L.jsx("span",{className:"text-sm font-medium",children:"Aten√ß√£o: Altera√ß√µes afetam a base de c√°lculo de pontua√ß√£o de todos os usu√°rios. Os pontos ser√£o recalculados automaticamente ap√≥s salvar."})]})})}),L.jsxs("div",{className:"space-y-6",children:[P("Engajamento",te,"engajamento",[{key:"baixo",label:"Baixo",description:"Engajamento baixo"},{key:"medio",label:"M√©dio",description:"Engajamento m√©dio"},{key:"alto",label:"Alto",description:"Engajamento alto"}]),P("Classifica√ß√£o",u,"classificacao",[{key:"frequente",label:"Frequente",description:"Usu√°rios frequentes"},{key:"naoFrequente",label:"N√£o Frequente",description:"Usu√°rios n√£o frequentes"}]),P("Dizimista",ie,"dizimista",[{key:"naoDizimista",label:"N√£o dizimista",description:"Sem contribui√ß√£o"},{key:"pontual",label:"Pontual (1-3 meses)",description:"Contribui√ß√£o pontual"},{key:"sazonal",label:"Sazonal (4-7 meses)",description:"Contribui√ß√£o sazonal"},{key:"recorrente",label:"Recorrente (8-12 meses)",description:"Contribui√ß√£o recorrente"}]),P("Ofertante",x,"ofertante",[{key:"naoOfertante",label:"N√£o ofertante",description:"Sem ofertas"},{key:"pontual",label:"Pontual (1-3 meses)",description:"Ofertas pontuais"},{key:"sazonal",label:"Sazonal (4-7 meses)",description:"Ofertas sazonais"},{key:"recorrente",label:"Recorrente (8-12 meses)",description:"Ofertas recorrentes"}]),P("Tempo de Batismo",p,"tempoBatismo",[{key:"doisAnos",label:"0-2 anos",description:"Batismo recente"},{key:"cincoAnos",label:"3-5 anos",description:"Batismo intermedi√°rio"},{key:"dezAnos",label:"6-10 anos",description:"Batismo consolidado"},{key:"vinteAnos",label:"11-20 anos",description:"Batismo maduro"},{key:"maisVinte",label:"20+ anos",description:"Batismo veterano"}]),P("Cargos",V,"cargos",[{key:"umCargo",label:"1 cargo",description:"Um cargo de lideran√ßa"},{key:"doisCargos",label:"2 cargos",description:"Dois cargos de lideran√ßa"},{key:"tresOuMais",label:"3+ cargos",description:"Tr√™s ou mais cargos"}]),P("Nome da Unidade",h,"nomeUnidade",[{key:"comUnidade",label:"Com unidade",description:"Unidade cadastrada"}]),P("Tem Li√ß√£o",U,"temLicao",[{key:"comLicao",label:"Com li√ß√£o",description:"Participa√ß√£o em estudos"}]),P("Pontua√ß√£o Din√¢mica",f,"pontuacaoDinamica",[{key:"multiplicador",label:"Multiplicador",description:"Multiplicador para valores 0-13"}]),P("Total de Presen√ßa",p,"totalPresenca",[{key:"zeroATres",label:"0-3 presen√ßas",description:"Baixa frequ√™ncia"},{key:"quatroASete",label:"4-7 presen√ßas",description:"Frequ√™ncia regular"},{key:"oitoATreze",label:"8-13 presen√ßas",description:"Alta frequ√™ncia"}]),P("Escola Sabatina",q,"escolaSabatina",[{key:"comunhao",label:"Comunh√£o",description:"Presen√ßa na comunh√£o"},{key:"missao",label:"Miss√£o",description:"Participa√ß√£o em miss√µes"},{key:"estudoBiblico",label:"Estudo B√≠blico",description:"Participa√ß√£o em estudos b√≠blicos"},{key:"batizouAlguem",label:"Batizou Algu√©m",description:"Lideran√ßa em batismos"},{key:"discipuladoPosBatismo",label:"Discipulado P√≥s-Batismo",description:"Participa√ß√£o em estudos de discipulado"}]),P("CPF V√°lido",h,"cpfValido",[{key:"valido",label:"V√°lido",description:"Documenta√ß√£o em dia"}]),P("Campos Vazios ACMS",oe,"camposVaziosACMS",[{key:"semCamposVazios",label:"Sem campos vazios",description:"Perfil completo no sistema"}])]}),L.jsxs(o,{className:"bg-gradient-to-br from-orange-50 to-yellow-50 border-orange-200",children:[L.jsx(n,{children:L.jsxs(l,{className:"flex items-center gap-2",children:[L.jsx(se,{className:"h-5 w-5 text-orange-600"}),"M√©dia do Distrito"]})}),L.jsx(r,{children:L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"flex items-center gap-4",children:[L.jsxs("div",{className:"flex-1",children:[L.jsx(c,{htmlFor:"districtAverage",className:"text-sm font-medium",children:"M√©dia Desejada"}),L.jsx(d,{id:"districtAverage",type:"number",placeholder:S?`√öltima m√©dia: ${S}`:"Ex: 608",className:"mt-1",value:S||"",onChange:e=>z(e.target.value?Number(e.target.value):null)}),L.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:S?`√öltima m√©dia configurada: ${S} pontos`:"Digite a m√©dia desejada para o distrito"}),T&&L.jsxs("p",{className:"text-xs text-blue-600 mt-1",children:["üìÖ √öltima execu√ß√£o: ",T]})]}),L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsxs(i,{onClick:async()=>{if(S)try{const e=await w(S);if(e.success){D(parseFloat(e.newAverage)),E(parseFloat(e.adjustmentFactor)),localStorage.setItem("lastDistrictAverage",S.toString());const a=(new Date).toLocaleString("pt-BR");localStorage.setItem("lastDistrictAverageDate",a),I(a),C({title:"M√©dia do distrito calculada!",description:`Configura√ß√µes ajustadas para atingir m√©dia de ${S} pontos.`})}else C({title:"Erro ao calcular m√©dia",description:e.error||"Erro desconhecido",variant:"destructive"})}catch(e){C({title:"Erro ao calcular m√©dia",description:"Erro inesperado ao processar a solicita√ß√£o",variant:"destructive"})}},disabled:!S||a,className:"bg-orange-600 hover:bg-orange-700",children:[L.jsx(Z,{className:"h-4 w-4 mr-2"}),S&&T?"Recalcular":"Calcular"]}),L.jsx(i,{variant:"outline",onClick:()=>{z(null),D(0),E(1),I(null),localStorage.removeItem("lastDistrictAverage"),localStorage.removeItem("lastDistrictAverageDate")},disabled:a,children:"Resetar"})]})]}),S&&L.jsx("div",{className:"bg-white p-4 rounded-lg border border-orange-200",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsxs("p",{className:"text-sm font-medium text-orange-800",children:["M√©dia Atual dos Usu√°rios: ",L.jsx("span",{className:"font-bold",children:k.toFixed(1)})]}),L.jsxs("p",{className:"text-sm text-orange-800",children:["M√©dia Desejada: ",L.jsx("span",{className:"font-bold",children:S})]}),L.jsxs("p",{className:"text-sm text-orange-800",children:["Fator de Ajuste: ",L.jsxs("span",{className:"font-bold",children:[A.toFixed(2),"x"]})]})]}),L.jsxs(m,{variant:A>1?"default":"secondary",className:"text-sm",children:[A>1?"Aumentar":"Diminuir"," Pontua√ß√µes"]})]})})]})})]}),L.jsxs(o,{className:"bg-gradient-to-br from-purple-50 to-blue-50",children:[L.jsx(n,{children:L.jsxs(l,{className:"flex items-center gap-2",children:[L.jsx(t,{className:"h-5 w-5 text-yellow-600"}),"Resumo da Base de C√°lculo"]})}),L.jsx(r,{children:L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[L.jsxs("div",{className:"text-center p-4 bg-white rounded-lg",children:[L.jsx("div",{className:"text-2xl font-bold text-purple-600",children:N()}),L.jsx("div",{className:"text-sm text-muted-foreground",children:"Pontos M√°ximos Poss√≠veis"})]}),L.jsxs("div",{className:"text-center p-4 bg-white rounded-lg",children:[L.jsx("div",{className:"text-2xl font-bold text-green-600",children:y().categoriesCount}),L.jsx("div",{className:"text-sm text-muted-foreground",children:"Categorias Configuradas"})]}),L.jsxs("div",{className:"text-center p-4 bg-white rounded-lg",children:[L.jsx("div",{className:"text-2xl font-bold text-blue-600",children:y().criteriaCount}),L.jsx("div",{className:"text-sm text-muted-foreground",children:"Crit√©rios de Pontua√ß√£o"})]})]})})]})]})},ke={notifications:{emailEnabled:!0,pushEnabled:!0,meetingReminders:!0,messageAlerts:!0,weeklyReport:!1},privacy:{profileVisible:!0,contactInfoVisible:!1,attendanceVisible:!0},appearance:{theme:"system",language:"pt",dateFormat:"dd/mm/yyyy"},church:{name:"Igreja Adventista Central",address:"Rua das Flores, 123 - Centro",phone:"(11) 3333-4444",email:"contato@igrejacentral.org",website:"www.igrejacentral.org",meetingDays:["saturday","wednesday"]}};function De(){const{user:e}=g(),{toast:a}=s(),[t,u]=B.useState(ke),[x,p]=B.useState(!1),[$,V]=B.useState(!1),[U,q]=B.useState(null),[se,te]=B.useState(0),[ie,oe]=B.useState("upload"),[pe,he]=B.useState([]),[fe,ge]=B.useState([]),[Se,De]=B.useState([]),{lastImportDate:Ae,updateLastImportDate:Ee,getDaysSinceLastImport:Te,getFormattedLastImportDate:Ie}=(()=>{const[e,a]=B.useState(localStorage.getItem("lastImportDate")||"2025-01-20T14:30:00Z");return B.useEffect(()=>{const e=e=>{if(e.detail&&e.detail.timestamp){const s=e.detail.timestamp;a(s),localStorage.setItem("lastImportDate",s)}};return window.addEventListener("import-success",e),()=>{window.removeEventListener("import-success",e)}},[]),{lastImportDate:e,updateLastImportDate:e=>{a(e),localStorage.setItem("lastImportDate",e)},getDaysSinceLastImport:()=>{if(!e)return null;const a=new Date(e),s=new Date,t=Math.abs(s.getTime()-a.getTime());return Math.ceil(t/864e5)},getFormattedLastImportDate:()=>{if(!e)return"Nenhuma importa√ß√£o realizada";const a=new Date(e);return`${a.toLocaleDateString("pt-BR")} √†s ${a.toLocaleTimeString("pt-BR")}`}}})(),[Pe,Me]=B.useState(null),[Oe,Le]=B.useState([]),[$e,Be]=B.useState(null),[Fe,Ve]=B.useState(""),[Ue,qe]=B.useState(!1),[Re,Ye]=B.useState(!1),[Xe,Je]=B.useState(null),[He,_e]=B.useState(""),{refreshLogo:Ge,clearLogoSystem:Qe}=j(),[We,Ze]=B.useState({logo:{offsetX:0,offsetY:0},welcome:{offsetX:0,offsetY:0},actions:{offsetX:0,offsetY:0}}),Ke=async()=>{try{const e=await fetch("/api/churches");if(e.ok){const a=(await e.json()).map(e=>({id:e.id,name:e.name,address:e.address||"Endere√ßo n√£o informado",active:!0}));Le(a)}}catch(e){}};B.useEffect(()=>{"admin"===(null==e?void 0:e.role)&&(Ke(),(async()=>{try{const e=await fetch("/api/settings/default-church");if(e.ok){const a=await e.json();a.defaultChurch&&(Be(a.defaultChurch.id),Ve(a.defaultChurch.name))}}catch(e){}})())},[e]),B.useEffect(()=>{const e=localStorage.getItem("systemLogo");e&&""!==e&&_e(e)},[]),B.useEffect(()=>{const e=localStorage.getItem("mobileHeaderLayout");if(e)try{const a=JSON.parse(e);Ze(a)}catch(a){}},[]),B.useEffect(()=>{},[We]);const ea=(e,a,s)=>{Ze(t=>({...t,[e]:{...t[e],[a]:s}}))},aa=(e,a,s)=>{u(t=>({...t,[e]:{...t[e],[a]:s}}))},sa=async e=>{const s=Oe.find(a=>a.id===e);if(s)try{if((await fetch(`/api/churches/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({isActive:!s.active})})).ok){Le(a=>a.map(a=>a.id===e?{...a,active:!a.active}:a));const t=!s.active,i=t?"ativada":"desativada";a({title:"Igreja atualizada",description:`${s.name} foi ${i} com sucesso.${t?"":" Usu√°rios associados podem ser afetados."}`})}}catch(t){a({title:"Erro",description:"N√£o foi poss√≠vel atualizar o status da igreja.",variant:"destructive"})}},ta=async(e,s,t)=>{try{if((await fetch(`/api/churches/${e}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({[s]:t})})).ok)if(Le(a=>a.map(a=>a.id===e?{...a,[s]:t}:a)),"name"===s){const s=Oe.find(a=>a.id===e);a(s?{title:"Igreja atualizada",description:`Nome da igreja alterado de "${s.name}" para "${t}". Todos os usu√°rios associados ser√£o atualizados.`}:{title:"Igreja atualizada",description:"As informa√ß√µes da igreja foram salvas e todos os usu√°rios associados ser√£o atualizados."})}else a({title:"Igreja atualizada",description:"As informa√ß√µes da igreja foram salvas."})}catch(i){a({title:"Erro",description:"N√£o foi poss√≠vel atualizar a igreja.",variant:"destructive"})}},ia=(e,s)=>{window.confirm(`Tem certeza que deseja excluir a igreja "${s}"? Esta a√ß√£o n√£o pode ser desfeita.`)&&(Le(a=>a.filter(a=>a.id!==e)),a({title:"Igreja exclu√≠da",description:`${s} foi removida do sistema.`,variant:"destructive"}))},oa=e=>{if(!e)return"member";const a=e.toLowerCase().trim();return a.includes("admin")||a.includes("pastor")||a.includes("pastora")||a.includes("ministro")||a.includes("ministra")||a.includes("l√≠der")||a.includes("lider")||a.includes("coordenador")||a.includes("coordenadora")?"admin":a.includes("mission")||a.includes("mission√°rio")||a.includes("missionaria")||a.includes("di√°con")||a.includes("diacon")||a.includes("evangelista")||a.includes("pioneiro")||a.includes("pioneira")||a.includes("colportor")||a.includes("colportora")?"missionary":a.includes("interest")||a.includes("interessado")||a.includes("interessada")||a.includes("visit")||a.includes("visitante")||a.includes("simpatizante")||a.includes("estudante")||a.includes("candidato")||a.includes("candidata")||a.includes("prospecto")||a.includes("prospecta")?"interested":(a.includes("member")||a.includes("membro")||a.includes("fiel")||a.includes("batizado")||a.includes("batizada")||a.includes("adventista")||a.includes("crente")||a.includes("frequentador")||a.includes("frequentadora"),"member")},ra=e=>{if(!e)return null;try{const a=e.toString().trim().replace(/['"]/g,"");if(!isNaN(e)&&"number"==typeof e){const a=new Date(1900,0,1),s=e-2,t=new Date(a.getTime()+24*s*60*60*1e3);if(!isNaN(t.getTime())&&t.getFullYear()>1900)return t}if(a.includes("/")){const e=a.split("/");if(3===e.length){const[a,s,t]=e,i=parseInt(a),o=parseInt(s);let r=parseInt(t);if(r<100&&(r+=r<50?2e3:1900),i>=1&&i<=31&&o>=1&&o<=12&&r>=1900&&r<=2100){const e=new Date(r,o-1,i);if(e.getDate()===i&&e.getMonth()===o-1&&e.getFullYear()===r)return e}}}if(a.includes("-")&&a.match(/^\d{1,2}-\d{1,2}-\d{4}$/)){const e=a.split("-"),[s,t,i]=e,o=parseInt(s),r=parseInt(t),n=parseInt(i);if(o>=1&&o<=31&&r>=1&&r<=12&&n>=1900&&n<=2100){const e=new Date(n,r-1,o);if(e.getDate()===o&&e.getMonth()===r-1&&e.getFullYear()===n)return e}}if(a.match(/^\d{4}-\d{2}-\d{2}$/)){const e=new Date(a);if(!isNaN(e.getTime())&&e.getFullYear()>1900)return e}if(a.match(/^\d{4}\/\d{2}\/\d{2}$/)){const e=a.split("/"),[s,t,i]=e,o=parseInt(s),r=parseInt(t),n=parseInt(i);if(o>=1900&&o<=2100&&r>=1&&r<=12&&n>=1&&n<=31){const e=new Date(o,r-1,n);if(e.getDate()===n&&e.getMonth()===r-1&&e.getFullYear()===o)return e}}if(a.includes(".")&&a.match(/^\d{1,2}\.\d{1,2}\.\d{4}$/)){const e=a.split("."),[s,t,i]=e,o=parseInt(s),r=parseInt(t),n=parseInt(i);if(o>=1&&o<=31&&r>=1&&r<=12&&n>=1900&&n<=2100){const e=new Date(n,r-1,o);if(e.getDate()===o&&e.getMonth()===r-1&&e.getFullYear()===n)return e}}if(a.includes(".")&&a.match(/^\d{1,2}\.\d{1,2}\.\d{2}$/)){const e=a.split("."),[s,t,i]=e,o=parseInt(s),r=parseInt(t);let n=parseInt(i);if(n+=n<50?2e3:1900,o>=1&&o<=31&&r>=1&&r<=12&&n>=1900&&n<=2100){const e=new Date(n,r-1,o);if(e.getDate()===o&&e.getMonth()===r-1&&e.getFullYear()===n)return e}}if(a.includes("-")&&a.includes("/")){const e=a.match(/^(\d{1,2}\/\d{1,2})-\d{1,2}\/\d{1,2}\/(\d{4})$/);if(e){const a=e[1]+"/"+e[2];return ra(a)}}if(a.includes("-")&&a.includes("/")&&!a.match(/\d{4}/)){const e=a.match(/^(\d{1,2}\/\d{1,2})-\d{1,2}\/\d{1,2}$/);if(e){const a=(new Date).getFullYear(),s=e[1]+"/"+a;return ra(s)}}if(a.match(/^\d{1,2}\/\d{1,2}$/)){const e=(new Date).getFullYear();return ra(a+"/"+e)}const s=new Date(e);return!isNaN(s.getTime())&&s.getFullYear()>1900?s:null}catch(a){return null}},na=e=>{if(!e)return!1;const a=e.toString().toLowerCase();return"sim"===a||"true"===a||"1"===a||"yes"===a},la=e=>{if(!e)return{isDonor:!1,dizimistaType:"N√£o Dizimista"};const a=e.toString().trim(),s=a.toLowerCase();return"n√£o dizimista"===s||"nao dizimista"===s||"n√£o"===s||"nao"===s||"n"===s?{isDonor:!1,dizimistaType:"N√£o Dizimista"}:"pontual (1-3)"===s||"pontual"===s||s.includes("pontual")?{isDonor:!0,dizimistaType:"Pontual (1-3)"}:"sazonal (4-7)"===s||"sazonal"===s||s.includes("sazonal")?{isDonor:!0,dizimistaType:"Sazonal (4-7)"}:"recorrente (8-12)"===s||"recorrente"===s||s.includes("recorrente")?{isDonor:!0,dizimistaType:"Recorrente (8-12)"}:"sim"===s||"true"===s||"1"===s||"yes"===s?{isDonor:!0,dizimistaType:"Sim"}:{isDonor:!0,dizimistaType:a}},ca=e=>{if(!e)return{isOffering:!1,ofertanteType:"N√£o Ofertante"};const a=e.toString().trim(),s=a.toLowerCase();return"n√£o ofertante"===s||"nao ofertante"===s||"n√£o"===s||"nao"===s||"n"===s?{isOffering:!1,ofertanteType:"N√£o Ofertante"}:"pontual (1-3)"===s||"pontual"===s||s.includes("pontual")?{isOffering:!0,ofertanteType:"Pontual (1-3)"}:"sazonal (4-7)"===s||"sazonal"===s||s.includes("sazonal")?{isOffering:!0,ofertanteType:"Sazonal (4-7)"}:"recorrente (8-12)"===s||"recorrente"===s||s.includes("recorrente")?{isOffering:!0,ofertanteType:"Recorrente (8-12)"}:"sim"===s||"true"===s||"1"===s||"yes"===s?{isOffering:!0,ofertanteType:"Sim"}:{isOffering:!0,ofertanteType:a}},da=e=>{if(!e)return null;const a=e.toString().replace(/[^0-9]/g,"");if(a.length<10)return null;let s="";if(s=(a.startsWith("55")||11!==a.length)&&(a.startsWith("55")||10!==a.length)?a:"55"+a,13===s.length){return`+${s.substring(0,2)}(${s.substring(2,4)})${s.substring(4,9)}-${s.substring(9,13)}`}if(12===s.length){return`+${s.substring(0,2)}(${s.substring(2,4)})${s.substring(4,8)}-${s.substring(8,12)}`}return a},ma="member"===(null==e?void 0:e.role);return L.jsxs(v,{children:[L.jsxs("div",{className:"container mx-auto p-4 space-y-6",children:[L.jsxs("div",{className:"flex items-center gap-3",children:[L.jsx(N,{className:"h-6 w-6 text-primary"}),L.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Configura√ß√µes"})]}),L.jsxs(R,{defaultValue:"notifications",className:"space-y-6",children:[L.jsxs(Y,{className:"grid w-full grid-cols-8",children:[L.jsx(X,{value:"notifications",className:"text-xs",children:"Notifica√ß√µes"}),!ma&&L.jsxs(L.Fragment,{children:[L.jsx(X,{value:"privacy",className:"text-xs",children:"Privacidade"}),L.jsx(X,{value:"appearance",className:"text-xs",children:"Apar√™ncia"})]}),"admin"===(null==e?void 0:e.role)&&L.jsx(X,{value:"points-config",className:"text-xs",children:"Base de C√°lculo"}),"admin"===(null==e?void 0:e.role)&&L.jsx(X,{value:"system",className:"text-xs",children:"Sistema"}),"admin"===(null==e?void 0:e.role)&&L.jsx(X,{value:"church",className:"text-xs",children:"Igreja"}),"admin"===(null==e?void 0:e.role)&&L.jsx(X,{value:"data-management",className:"text-xs",children:"Gest√£o de Dados"})]}),L.jsx(J,{value:"notifications",className:"space-y-4",children:L.jsxs(o,{children:[L.jsxs(n,{children:[L.jsxs(l,{className:"flex items-center gap-2",children:[L.jsx(y,{className:"h-5 w-5"}),"Notifica√ß√µes"]}),L.jsx(b,{children:"Configure como voc√™ quer receber notifica√ß√µes"})]}),L.jsxs(r,{className:"space-y-6",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"space-y-0.5",children:[L.jsx("div",{className:"text-sm font-medium",children:"Notifica√ß√µes por email"}),L.jsx("div",{className:"text-xs text-muted-foreground",children:"Receba atualiza√ß√µes por email"})]}),L.jsx(F,{checked:t.notifications.emailEnabled,onCheckedChange:e=>aa("notifications","emailEnabled",e),"data-testid":"switch-email-notifications"})]}),L.jsx(je,{}),L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"space-y-0.5",children:[L.jsx("div",{className:"text-sm font-medium",children:"Notifica√ß√µes push"}),L.jsx("div",{className:"text-xs text-muted-foreground",children:"Notifica√ß√µes no dispositivo"})]}),L.jsx(F,{checked:t.notifications.pushEnabled,onCheckedChange:e=>aa("notifications","pushEnabled",e),"data-testid":"switch-push-notifications"})]}),L.jsx(je,{}),L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"space-y-0.5",children:[L.jsx("div",{className:"text-sm font-medium",children:"Lembretes de reuni√µes"}),L.jsx("div",{className:"text-xs text-muted-foreground",children:"Avisos antes dos eventos"})]}),L.jsx(F,{checked:t.notifications.meetingReminders,onCheckedChange:e=>aa("notifications","meetingReminders",e),"data-testid":"switch-meeting-reminders"})]}),L.jsx(je,{}),L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"space-y-0.5",children:[L.jsx("div",{className:"text-sm font-medium",children:"Alertas de mensagens"}),L.jsx("div",{className:"text-xs text-muted-foreground",children:"Notifica√ß√µes de novas mensagens"})]}),L.jsx(F,{checked:t.notifications.messageAlerts,onCheckedChange:e=>aa("notifications","messageAlerts",e),"data-testid":"switch-message-alerts"})]}),L.jsx(je,{}),L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"space-y-0.5",children:[L.jsx("div",{className:"text-sm font-medium",children:"Relat√≥rio semanal"}),L.jsx("div",{className:"text-xs text-muted-foreground",children:"Resumo das atividades da semana"})]}),L.jsx(F,{checked:t.notifications.weeklyReport,onCheckedChange:e=>aa("notifications","weeklyReport",e),"data-testid":"switch-weekly-report"})]})]})]})}),!ma&&L.jsx(J,{value:"privacy",className:"space-y-4",children:L.jsxs(o,{children:[L.jsxs(n,{children:[L.jsxs(l,{className:"flex items-center gap-2",children:[L.jsx(re,{className:"h-5 w-5"}),"Privacidade"]}),L.jsx(b,{children:"Controle a visibilidade das suas informa√ß√µes"})]}),L.jsxs(r,{className:"space-y-6",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"space-y-0.5",children:[L.jsx("div",{className:"text-sm font-medium",children:"Perfil vis√≠vel"}),L.jsx("div",{className:"text-xs text-muted-foreground",children:"Outros membros podem ver seu perfil"})]}),L.jsx(F,{checked:t.privacy.profileVisible,onCheckedChange:e=>aa("privacy","profileVisible",e),"data-testid":"switch-profile-visible"})]}),L.jsx(je,{}),L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"space-y-0.5",children:[L.jsx("div",{className:"text-sm font-medium",children:"Informa√ß√µes de contato"}),L.jsx("div",{className:"text-xs text-muted-foreground",children:"Mostrar telefone e email no perfil"})]}),L.jsx(F,{checked:t.privacy.contactInfoVisible,onCheckedChange:e=>aa("privacy","contactInfoVisible",e),"data-testid":"switch-contact-visible"})]}),L.jsx(je,{}),L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{className:"space-y-0.5",children:[L.jsx("div",{className:"text-sm font-medium",children:"Frequ√™ncia vis√≠vel"}),L.jsx("div",{className:"text-xs text-muted-foreground",children:"Mostrar sua frequ√™ncia nos eventos"})]}),L.jsx(F,{checked:t.privacy.attendanceVisible,onCheckedChange:e=>aa("privacy","attendanceVisible",e),"data-testid":"switch-attendance-visible"})]})]})]})}),!ma&&L.jsx(J,{value:"appearance",className:"space-y-4",children:L.jsxs(o,{children:[L.jsxs(n,{children:[L.jsxs(l,{className:"flex items-center gap-2",children:[L.jsx(xe,{className:"h-5 w-5"}),"Apar√™ncia"]}),L.jsx(b,{children:"Personalize a interface do aplicativo"})]}),L.jsxs(r,{className:"space-y-4",children:[L.jsxs("div",{className:"space-y-2",children:[L.jsx(c,{htmlFor:"theme",children:"Tema"}),L.jsxs(w,{value:t.appearance.theme,onValueChange:e=>aa("appearance","theme",e),children:[L.jsx(C,{"data-testid":"select-theme",children:L.jsx(S,{})}),L.jsxs(z,{children:[L.jsx(k,{value:"light",children:"Claro"}),L.jsx(k,{value:"dark",children:"Escuro"}),L.jsx(k,{value:"system",children:"Sistema"})]})]})]}),L.jsxs("div",{className:"space-y-2",children:[L.jsx(c,{htmlFor:"language",children:"Idioma"}),L.jsxs(w,{value:t.appearance.language,onValueChange:e=>aa("appearance","language",e),children:[L.jsx(C,{"data-testid":"select-language",children:L.jsx(S,{})}),L.jsxs(z,{children:[L.jsx(k,{value:"pt",children:"Portugu√™s"}),L.jsx(k,{value:"en",children:"English"}),L.jsx(k,{value:"es",children:"Espa√±ol"})]})]})]}),L.jsxs("div",{className:"space-y-2",children:[L.jsx(c,{htmlFor:"dateFormat",children:"Formato de data"}),L.jsxs(w,{value:t.appearance.dateFormat,onValueChange:e=>aa("appearance","dateFormat",e),children:[L.jsx(C,{"data-testid":"select-date-format",children:L.jsx(S,{})}),L.jsxs(z,{children:[L.jsx(k,{value:"dd/mm/yyyy",children:"DD/MM/AAAA"}),L.jsx(k,{value:"mm/dd/yyyy",children:"MM/DD/AAAA"}),L.jsx(k,{value:"yyyy-mm-dd",children:"AAAA-MM-DD"})]})]})]})]})]})}),"admin"===(null==e?void 0:e.role)&&L.jsx(J,{value:"system",className:"space-y-4",children:L.jsxs(o,{children:[L.jsxs(n,{children:[L.jsxs(l,{className:"flex items-center gap-2",children:[L.jsx(N,{className:"h-5 w-5"}),"Configura√ß√µes do Sistema"]}),L.jsx(b,{children:"Gerencie as configura√ß√µes globais do sistema"})]}),L.jsx(r,{className:"space-y-6",children:L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx("h3",{className:"text-lg font-semibold",children:"Logo do Sistema"}),L.jsx(m,{variant:"secondary",children:"Admin"})]}),L.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 rounded-lg border",children:[L.jsx("div",{className:"relative",children:He?L.jsxs(L.Fragment,{children:[L.jsx("img",{src:He,alt:"Logo atual do sistema",className:"w-16 h-16 object-contain",onError:e=>{e.currentTarget.style.display="none"}}),L.jsx("div",{className:"absolute -top-1 -right-1 w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center",children:L.jsx("span",{className:"text-xs text-white font-bold",children:"‚úì"})})]}):L.jsx("div",{className:"w-16 h-16 bg-gray-200 rounded-lg flex items-center justify-center",children:L.jsx("span",{className:"text-xs text-gray-500",children:"Sem logo"})})}),L.jsxs("div",{className:"flex-1",children:[L.jsx("p",{className:"text-sm font-medium text-gray-900",children:He?"Logo Atual":"Sem Logo Definida"}),L.jsx("p",{className:"text-xs text-gray-600",children:He?"Esta √© a logo que aparece em todo o sistema":"Nenhuma logo foi configurada para o sistema"}),He&&L.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Caminho: ",He]})]}),L.jsxs("div",{className:"flex gap-2",children:[L.jsx(i,{variant:"outline",size:"sm",onClick:()=>{localStorage.removeItem("systemLogo"),_e("")},title:"Remover logo atual",children:L.jsx(Z,{className:"h-4 w-4"})}),L.jsx(i,{variant:"outline",size:"sm",onClick:()=>{Ge(),a({title:"Logo atualizada!",description:"Cache limpo e logo recarregada."})},title:"Recarregar logo (limpar cache)",children:L.jsx(Z,{className:"h-4 w-4"})}),L.jsx(i,{variant:"destructive",size:"sm",onClick:()=>{Qe(),_e(""),a({title:"Sistema limpo!",description:"Todas as logos antigas foram removidas."})},title:"Limpar completamente o sistema de logo",children:L.jsx(ne,{className:"h-4 w-4"})})]})]}),L.jsx("div",{className:"space-y-4 p-4 border border-gray-200 rounded-lg bg-gray-50",children:L.jsxs("div",{className:"text-center",children:[L.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[L.jsx(N,{className:"h-5 w-5 text-gray-500"}),L.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Logo Atual do Sistema"})]}),L.jsx("p",{className:"text-xs text-gray-500",children:"A logo est√° salva no banco de dados e √© exibida automaticamente em todo o sistema."})]})}),L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx("h3",{className:"text-lg font-semibold",children:"Layout do Mobile Header"}),L.jsx(m,{variant:"secondary",children:"Admin"})]}),L.jsxs("div",{className:"p-4 bg-gray-50 rounded-lg border",children:[L.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Arraste e solte os elementos para ajustar suas posi√ß√µes no header m√≥vel"}),L.jsxs("div",{className:"bg-white rounded-lg border p-4 mb-4",children:[L.jsx("div",{className:"text-xs text-gray-500 mb-2 text-center",children:"Preview do Header"}),L.jsx("div",{className:"bg-gradient-to-r from-white via-blue-50/30 to-purple-50/30 rounded-lg p-3 border",children:L.jsxs("div",{className:"flex items-center gap-3",children:[L.jsxs("div",{className:"relative cursor-move bg-blue-100 p-2 rounded border-2 border-dashed border-blue-300",draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain","logo")},style:{transform:`translateX(${We.logo.offsetX}px) translateY(${We.logo.offsetY}px)`},children:[L.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded flex items-center justify-center text-white text-xs font-bold",children:"L"}),L.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-blue-600 rounded-full text-white text-xs flex items-center justify-center",children:"‚Üï"})]}),L.jsxs("div",{className:"relative cursor-move bg-green-100 p-2 rounded border-2 border-dashed border-green-300",draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain","welcome")},style:{transform:`translateX(${We.welcome.offsetX}px) translateY(${We.welcome.offsetY}px)`},children:[L.jsx("div",{className:"text-xs text-green-700 font-medium whitespace-nowrap",children:"Boa noite, Usu√°rio!"}),L.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-600 rounded-full text-white text-xs flex items-center justify-center",children:"‚Üï"})]}),L.jsxs("div",{className:"relative cursor-move bg-purple-100 p-2 rounded border-2 border-dashed border-purple-300 ml-auto",draggable:!0,onDragStart:e=>{e.dataTransfer.setData("text/plain","actions")},style:{transform:`translateX(${We.actions.offsetX}px) translateY(${We.actions.offsetY}px)`},children:[L.jsxs("div",{className:"flex gap-1",children:[L.jsx("div",{className:"w-4 h-4 bg-purple-500 rounded text-white text-xs flex items-center justify-center",children:"C"}),L.jsx("div",{className:"w-4 h-4 bg-purple-500 rounded text-white text-xs flex items-center justify-center",children:"N"}),L.jsx("div",{className:"w-4 h-4 bg-purple-500 rounded text-white text-xs flex items-center justify-center",children:"U"})]}),L.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-purple-600 rounded-full text-white text-xs flex items-center justify-center",children:"‚Üï"})]})]})})]}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[L.jsxs("div",{className:"space-y-2",children:[L.jsx(c,{className:"text-sm font-medium",children:"Logo"}),L.jsxs("div",{className:"space-y-2",children:[L.jsxs("div",{children:[L.jsxs(c,{className:"text-xs",children:["X: ",We.logo.offsetX,"px"]}),L.jsx("input",{type:"range",min:"-50",max:"50",value:We.logo.offsetX,onChange:e=>ea("logo","offsetX",parseInt(e.target.value)),className:"w-full"})]}),L.jsxs("div",{children:[L.jsxs(c,{className:"text-xs",children:["Y: ",We.logo.offsetY,"px"]}),L.jsx("input",{type:"range",min:"-20",max:"20",value:We.logo.offsetY,onChange:e=>ea("logo","offsetY",parseInt(e.target.value)),className:"w-full"})]})]})]}),L.jsxs("div",{className:"space-y-2",children:[L.jsx(c,{className:"text-sm font-medium",children:"Boas-vindas"}),L.jsxs("div",{className:"space-y-2",children:[L.jsxs("div",{children:[L.jsxs(c,{className:"text-xs",children:["X: ",We.welcome.offsetX,"px"]}),L.jsx("input",{type:"range",min:"-50",max:"50",value:We.welcome.offsetX,onChange:e=>ea("welcome","offsetX",parseInt(e.target.value)),className:"w-full"})]}),L.jsxs("div",{children:[L.jsxs(c,{className:"text-xs",children:["Y: ",We.welcome.offsetY,"px"]}),L.jsx("input",{type:"range",min:"-20",max:"20",value:We.welcome.offsetY,onChange:e=>ea("welcome","offsetY",parseInt(e.target.value)),className:"w-full"})]})]})]}),L.jsxs("div",{className:"space-y-2",children:[L.jsx(c,{className:"text-sm font-medium",children:"Bot√µes de A√ß√£o"}),L.jsxs("div",{className:"space-y-2",children:[L.jsxs("div",{children:[L.jsxs(c,{className:"text-xs",children:["X: ",We.actions.offsetX,"px"]}),L.jsx("input",{type:"range",min:"-50",max:"50",value:We.actions.offsetX,onChange:e=>ea("actions","offsetX",parseInt(e.target.value)),className:"w-full"})]}),L.jsxs("div",{children:[L.jsxs(c,{className:"text-xs",children:["Y: ",We.actions.offsetY,"px"]}),L.jsx("input",{type:"range",min:"-20",max:"20",value:We.actions.offsetY,onChange:e=>ea("actions","offsetY",parseInt(e.target.value)),className:"w-full"})]})]})]})]}),L.jsxs("div",{className:"flex items-center gap-2 mt-4",children:[L.jsxs(i,{variant:"outline",size:"sm",onClick:()=>{Ze({logo:{offsetX:0,offsetY:0},welcome:{offsetX:0,offsetY:0},actions:{offsetX:0,offsetY:0}})},children:[L.jsx(Z,{className:"h-4 w-4 mr-2"}),"Resetar Posi√ß√µes"]}),L.jsxs(i,{size:"sm",onClick:()=>{localStorage.setItem("mobileHeaderLayout",JSON.stringify(We));const e=new CustomEvent("mobileHeaderLayoutUpdated",{detail:{layout:We}});window.dispatchEvent(e),a({title:"Layout salvo",description:"As posi√ß√µes do mobile header foram atualizadas com sucesso."})},className:"bg-green-600 hover:bg-green-700",children:[L.jsx(K,{className:"h-4 w-4 mr-2"}),"Salvar Layout"]}),L.jsx(i,{variant:"outline",size:"sm",onClick:()=>{const e=new CustomEvent("mobileHeaderLayoutUpdated",{detail:{layout:We}});window.dispatchEvent(e)},className:"bg-blue-600 hover:bg-blue-700 text-white",children:"üß™ Testar Sincroniza√ß√£o"})]})]})]})]})})]})}),"admin"===(null==e?void 0:e.role)&&L.jsx(J,{value:"points-config",className:"space-y-4",children:L.jsx(ze,{})}),"admin"===(null==e?void 0:e.role)&&L.jsx(J,{value:"church",className:"space-y-4",children:L.jsxs(o,{children:[L.jsx(n,{children:L.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[L.jsxs("div",{children:[L.jsxs(l,{className:"flex items-center gap-2",children:[L.jsx(ue,{className:"h-5 w-5"}),"Gest√£o de Igrejas"]}),L.jsx(b,{children:"Clique nos campos para editar diretamente"})]}),L.jsxs(i,{onClick:async()=>{try{(await fetch("/api/churches",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"Nova Igreja",address:"Endere√ßo da igreja"})})).ok&&(await Ke(),a({title:"Igreja adicionada",description:"Nova igreja foi criada. Clique nos campos para editar."}))}catch(e){a({title:"Erro",description:"N√£o foi poss√≠vel criar a igreja.",variant:"destructive"})}},"data-testid":"add-church-button",className:"w-full sm:w-auto",children:[L.jsx(le,{className:"h-4 w-4 mr-2"}),"Nova Igreja"]})]})}),L.jsxs(r,{children:[L.jsxs("div",{className:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[L.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[L.jsx(f,{className:"h-5 w-5 text-blue-600"}),L.jsx("h3",{className:"font-semibold text-blue-900",children:"Igreja Padr√£o"})]}),L.jsx("p",{className:"text-sm text-blue-700 mb-4",children:"Esta igreja ser√° usada como padr√£o para novos usu√°rios e usu√°rios sem igreja definida."}),L.jsxs("div",{className:"flex items-center gap-3",children:[L.jsxs(w,{value:(null==$e?void 0:$e.toString())||"",onValueChange:e=>Be(parseInt(e)),children:[L.jsx(C,{className:"w-full sm:w-64",children:L.jsx(S,{placeholder:"Selecione a igreja padr√£o"})}),L.jsx(z,{children:Oe.map(e=>L.jsx(k,{value:e.id.toString(),children:e.name},e.id))})]}),L.jsxs(i,{onClick:async()=>{if($e){qe(!0);try{const e=await fetch("/api/settings/default-church",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({churchId:$e})});if(!e.ok)throw new Error("Failed to update default church");if((await e.json()).success){const e=Oe.find(e=>e.id===$e);e&&Ve(e.name),a({title:"Igreja padr√£o atualizada",description:"A igreja padr√£o foi definida com sucesso."})}}catch(e){a({title:"Erro",description:"N√£o foi poss√≠vel definir a igreja padr√£o.",variant:"destructive"})}finally{qe(!1)}}},disabled:!$e||Ue,size:"sm",className:"bg-blue-600 hover:bg-blue-700",children:[Ue?L.jsx(ce,{className:"h-4 w-4 animate-spin"}):L.jsx(K,{className:"h-4 w-4"}),"Salvar"]})]}),Fe&&L.jsxs("div",{className:"mt-3 p-2 bg-blue-100 rounded text-sm text-blue-800",children:[L.jsx("strong",{children:"Igreja padr√£o atual:"})," ",Fe]})]}),L.jsxs("div",{className:"space-y-2",children:[L.jsxs("div",{className:"hidden sm:grid sm:grid-cols-12 gap-2 px-3 py-2 bg-muted/50 rounded-lg text-sm font-medium",children:[L.jsx("div",{className:"col-span-4",children:"Nome da Igreja"}),L.jsx("div",{className:"col-span-5",children:"Endere√ßo"}),L.jsx("div",{className:"col-span-1 text-center",children:"Status"}),L.jsx("div",{className:"col-span-2 text-center",children:"A√ß√µes"})]}),Oe.map(e=>L.jsxs("div",{className:"border rounded-lg p-3 hover:bg-muted/20 transition-colors",children:[L.jsxs("div",{className:"sm:hidden space-y-3",children:[L.jsxs("div",{className:"space-y-2",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Nome:"}),L.jsx(m,{variant:e.active?"secondary":"destructive",children:e.active?"Ativa":"Inativa"})]}),L.jsx(ua,{value:e.name,onSave:a=>ta(e.id,"name",a),className:"font-medium","data-testid":`church-name-${e.id}`})]}),L.jsxs("div",{className:"space-y-2",children:[L.jsx("label",{className:"text-sm font-medium text-muted-foreground",children:"Endere√ßo:"}),L.jsx(ua,{value:e.address,onSave:a=>ta(e.id,"address",a),className:"text-sm","data-testid":`church-address-${e.id}`})]}),L.jsxs("div",{className:"flex gap-2 pt-2",children:[L.jsx(i,{variant:e.active?"secondary":"default",size:"sm",onClick:()=>sa(e.id),className:"flex-1","data-testid":`toggle-church-${e.id}`,children:e.active?"Desativar":"Ativar"}),L.jsx(i,{variant:"destructive",size:"sm",onClick:()=>ia(e.id,e.name),"data-testid":`delete-church-${e.id}`,children:L.jsx(ne,{className:"h-4 w-4"})})]})]}),L.jsxs("div",{className:"hidden sm:grid sm:grid-cols-12 gap-2 items-center",children:[L.jsx("div",{className:"col-span-4",children:L.jsx(ua,{value:e.name,onSave:a=>ta(e.id,"name",a),className:"font-medium","data-testid":`church-name-${e.id}`})}),L.jsx("div",{className:"col-span-5",children:L.jsx(ua,{value:e.address,onSave:a=>ta(e.id,"address",a),className:"text-sm","data-testid":`church-address-${e.id}`})}),L.jsx("div",{className:"col-span-1 flex justify-center",children:L.jsx(m,{variant:e.active?"secondary":"destructive",children:e.active?"Ativa":"Inativa"})}),L.jsxs("div",{className:"col-span-2 flex gap-1 justify-center",children:[L.jsx(i,{variant:e.active?"secondary":"default",size:"sm",onClick:()=>sa(e.id),"data-testid":`toggle-church-${e.id}`,children:e.active?L.jsx(D,{className:"h-4 w-4"}):L.jsx(A,{className:"h-4 w-4"})}),L.jsx(i,{variant:"destructive",size:"sm",onClick:()=>ia(e.id,e.name),"data-testid":`delete-church-${e.id}`,children:L.jsx(ne,{className:"h-4 w-4"})})]})]})]},e.id)),0===Oe.length&&L.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[L.jsx(ue,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),L.jsx("p",{className:"text-lg font-medium",children:"Nenhuma igreja cadastrada"}),L.jsx("p",{className:"text-sm",children:"Adicione a primeira igreja do sistema"})]})]})]})]})}),"admin"===(null==e?void 0:e.role)&&L.jsx(J,{value:"data-management",className:"space-y-4",children:L.jsxs(o,{children:[L.jsxs(n,{children:[L.jsxs(l,{className:"flex items-center gap-2",children:[L.jsx(de,{className:"h-5 w-5"}),"Gest√£o de Dados"]}),L.jsx(b,{children:"Backup e restaura√ß√£o de dados"})]}),L.jsxs(r,{className:"space-y-4",children:[L.jsx("div",{className:"p-3 bg-muted/50 rounded-lg",children:L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsxs("div",{children:[L.jsx("p",{className:"text-sm font-medium",children:"√öltima Importa√ß√£o"}),L.jsx("p",{className:"text-xs text-muted-foreground",children:Ie()})]}),Ae&&L.jsxs(m,{variant:"secondary",className:"text-xs",children:[Te()," dias atr√°s"]})]})}),L.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[L.jsxs(i,{variant:"outline",className:"flex-1","data-testid":"button-export",children:[L.jsx(E,{className:"h-4 w-4 mr-2"}),"Exportar Dados"]}),L.jsxs(i,{variant:"outline",className:"flex-1",onClick:()=>V(!0),"data-testid":"button-import",children:[L.jsx(ee,{className:"h-4 w-4 mr-2"}),"Importar Dados"]}),L.jsxs(i,{variant:"destructive",className:"flex-1","data-testid":"button-delete-data",onClick:async()=>{if(await new Promise(e=>{Ye(!0),Je(()=>e)}))try{p(!0);const e=await fetch("/api/system/clear-all",{method:"POST",headers:{"Content-Type":"application/json"}}),s=await e.json();if(!e.ok)throw new Error(s.error||"Falha ao limpar dados");a({title:"Sistema limpo com sucesso",description:s.message||"Todos os dados foram removidos do sistema."}),setTimeout(()=>{window.location.reload()},2e3)}catch(e){a({title:"Erro ao limpar dados",description:e instanceof Error?e.message:"Ocorreu um erro inesperado.",variant:"destructive"})}finally{p(!1)}else a({title:"Opera√ß√£o cancelada",description:"A limpeza dos dados foi cancelada."})},children:[L.jsx(ne,{className:"h-4 w-4 mr-2"}),"Limpar Dados"]})]})]})]})})]}),!ma&&L.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[L.jsxs(i,{onClick:async()=>{p(!0);try{await new Promise(e=>setTimeout(e,1e3)),a({title:"Configura√ß√µes salvas",description:"Suas configura√ß√µes foram atualizadas com sucesso."})}catch(e){a({title:"Erro",description:"N√£o foi poss√≠vel salvar as configura√ß√µes.",variant:"destructive"})}finally{p(!1)}},disabled:x,className:"flex-1","data-testid":"button-save",children:[x?L.jsx(Z,{className:"h-4 w-4 mr-2 animate-spin"}):L.jsx(K,{className:"h-4 w-4 mr-2"}),"Salvar Configura√ß√µes"]}),L.jsxs(i,{variant:"outline",onClick:()=>{u(ke),a({title:"Configura√ß√µes restauradas",description:"Todas as configura√ß√µes foram restauradas aos valores padr√£o."})},className:"flex-1","data-testid":"button-reset",children:[L.jsx(Z,{className:"h-4 w-4 mr-2"}),"Restaurar Padr√£o"]})]})]}),L.jsx(H,{open:$,onOpenChange:V,children:L.jsxs(_,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[L.jsxs(G,{children:[L.jsxs(Q,{className:"flex items-center gap-2",children:[L.jsx(me,{className:"h-5 w-5"}),"Importar Usu√°rios"]}),L.jsx(W,{children:"Importe dados de usu√°rios a partir de arquivos Excel (.xlsx) ou CSV"})]}),L.jsxs("div",{className:"space-y-6",children:[L.jsxs("div",{className:"space-y-2",children:[L.jsxs("div",{className:"flex items-center justify-between text-sm",children:[L.jsx("span",{children:"Progresso da Importa√ß√£o"}),L.jsxs("span",{children:[se,"%"]})]}),L.jsx(T,{value:se,className:"w-full"}),L.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground",children:[L.jsx("span",{className:"upload"===ie?"text-primary font-medium":"",children:"Upload"}),L.jsx("span",{className:"preview"===ie?"text-primary font-medium":"",children:"Preview"}),L.jsx("span",{className:"mapping"===ie?"text-primary font-medium":"",children:"Mapeamento"}),L.jsx("span",{className:"validation"===ie?"text-primary font-medium":"",children:"Valida√ß√£o"}),L.jsx("span",{className:"importing"===ie?"text-primary font-medium":"",children:"Importando"}),L.jsx("span",{className:"complete"===ie?"text-primary font-medium":"",children:"Conclu√≠do"})]})]}),"upload"===ie&&L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-8 text-center",children:[L.jsx(me,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),L.jsxs("div",{className:"space-y-2",children:[L.jsx("h3",{className:"text-lg font-medium",children:"Selecione o arquivo"}),L.jsx("p",{className:"text-sm text-muted-foreground",children:"Formatos aceitos: .xlsx, .csv (m√°ximo 10MB)"})]}),L.jsx("input",{type:"file",accept:".xlsx,.csv",onChange:e=>{var s;const t=null==(s=e.target.files)?void 0:s[0];t&&(q(t),(async e=>{try{te(20),oe("preview");const a=await e.arrayBuffer();if(e.name.endsWith(".xlsx")){const e=await O(()=>import("./xlsx-ByDo_lG2.js"),[]),s=e.read(a,{type:"array"}),t=s.SheetNames[0],i=s.Sheets[t],o=e.utils.sheet_to_json(i);he(o)}else if(e.name.endsWith(".csv")){const e=(new TextDecoder).decode(a).split("\n"),s=e[0].split(",").map(e=>e.trim()),t=e.slice(1).filter(e=>e.trim()).map(e=>{const a=e.split(",").map(e=>e.trim()),t={};return s.forEach((e,s)=>{t[e]=a[s]||""}),t});he(t)}setTimeout(()=>{te(40),oe("mapping")},500)}catch(s){a({title:"Erro no arquivo",description:"N√£o foi poss√≠vel processar o arquivo. Verifique o formato.",variant:"destructive"})}})(t))},className:"mt-4","data-testid":"file-upload"})]}),L.jsxs(I,{children:[L.jsx(ae,{className:"h-4 w-4"}),L.jsxs(P,{children:[L.jsx("strong",{children:"Colunas reconhecidas:"})," Igreja, Nome, C√≥digo, Tipo, Sexo, Idade, Nascimento, Engajamento, Classifica√ß√£o, Dizimista, Ofertante, Email, Celular, CPF, Estado civil, Ocupa√ß√£o, Grau de educa√ß√£o, Batismo, Religi√£o anterior, Instrutor b√≠blico, Departamentos e cargos, Nome da m√£e/pai, Bairro, Endere√ßo, Matriculado na ES, Tem li√ß√£o, e muitos outros campos espec√≠ficos da IASD.",L.jsx("br",{}),L.jsx("strong",{children:"Formatos aceitos:"})," Telefone (qualquer formato), Email (com @), Datas (DD/MM/AAAA ou outros formatos), Valores Sim/N√£o para campos booleanos"]})]})]}),"preview"===ie&&L.jsxs("div",{className:"space-y-4",children:[L.jsxs("div",{className:"flex items-center justify-between",children:[L.jsx("h3",{className:"text-lg font-medium",children:"Preview dos Dados"}),L.jsxs(m,{variant:"secondary",children:[pe.length," registros encontrados"]})]}),L.jsx("div",{className:"border rounded-lg overflow-hidden",children:L.jsxs(ve,{children:[L.jsx(Ne,{children:L.jsxs(be,{children:[L.jsx(we,{children:"Nome"}),L.jsx(we,{children:"Igreja"}),L.jsx(we,{children:"C√≥digo"}),L.jsx(we,{children:"Tipo"}),L.jsx(we,{children:"Email"}),L.jsx(we,{children:"Celular"}),L.jsx(we,{children:"Status"})]})}),L.jsx(ye,{children:pe.slice(0,5).map((e,a)=>L.jsxs(be,{children:[L.jsx(Ce,{children:e.Nome||e.nome||"N/A"}),L.jsx(Ce,{children:e.Igreja||e.igreja||"N/A"}),L.jsx(Ce,{children:e.C√≥digo||e.codigo||"N/A"}),L.jsx(Ce,{children:e.Tipo||e.tipo||"N/A"}),L.jsx(Ce,{children:e.Email||e.email||"N/A"}),L.jsx(Ce,{children:e.Celular||e.celular||"N/A"}),L.jsx(Ce,{children:L.jsx(m,{variant:!1!==e.valid?"secondary":"destructive",children:!1!==e.valid?"V√°lido":"Erro"})})]},a))})]})}),pe.length>5&&L.jsxs("p",{className:"text-sm text-muted-foreground text-center",children:["Mostrando 5 de ",pe.length," registros"]}),L.jsxs("div",{className:"flex gap-2",children:[L.jsx(i,{onClick:()=>{oe("mapping"),te(50)},"data-testid":"continue-mapping",children:"Continuar para Mapeamento"}),L.jsx(i,{variant:"outline",onClick:()=>{oe("upload"),te(0),q(null)},children:"Voltar"})]})]}),"mapping"===ie&&L.jsxs("div",{className:"space-y-4",children:[L.jsx("h3",{className:"text-lg font-medium",children:"Mapeamento de Colunas"}),L.jsx("p",{className:"text-sm text-muted-foreground",children:"Confirme o mapeamento autom√°tico das colunas ou ajuste conforme necess√°rio"}),L.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[{field:"nome",label:"Nome",required:!0},{field:"email",label:"Email",required:!0},{field:"celular",label:"Telefone",required:!0},{field:"tipo",label:"Tipo de Usu√°rio",required:!0},{field:"igreja",label:"Igreja",required:!1},{field:"nascimento",label:"Data de Nascimento",required:!1}].map(e=>L.jsxs("div",{className:"space-y-2",children:[L.jsxs(c,{children:[e.label,e.required&&L.jsx("span",{className:"text-destructive ml-1",children:"*"})]}),L.jsxs(w,{defaultValue:e.field,children:[L.jsx(C,{children:L.jsx(S,{})}),L.jsxs(z,{children:[L.jsx(k,{value:e.field,children:e.field.charAt(0).toUpperCase()+e.field.slice(1)}),L.jsx(k,{value:"none",children:"N√£o mapear"})]})]})]},e.field))}),L.jsxs("div",{className:"flex gap-2",children:[L.jsx(i,{onClick:()=>{oe("validation"),te(75),(()=>{const e=[],a=[],s=new Set,t=pe.map((t,i)=>{const o={...t,valid:!0,errors:[]},r=i+1,n=t.nome||t.Nome||t.name;n&&""!==n.toString().trim()||(e.push(`Linha ${r}: Nome √© obrigat√≥rio`),o.valid=!1);const l=t.email||t.Email;if(l){const t=l.toString().trim();t&&!t.includes("@")&&(e.push(`Linha ${r}: Email "${t}" √© inv√°lido`),o.valid=!1),s.has(t)?(a.push(`Linha ${r}: Email "${t}" duplicado`),o.valid=!1):s.add(t)}const c=t.celular||t.Celular||t.telefone||t.Telefone||t.phone;if(c){const a=c.toString().trim();a&&a.length<10&&(e.push(`Linha ${r}: Telefone "${a}" muito curto`),o.valid=!1)}const d=t.tipo||t.Tipo||t.role;if(d){const a=d.toString().toLowerCase();["admin","missionary","member","interested","pastor","di√°cono","membro","interessado"].some(e=>a.includes(e))||(e.push(`Linha ${r}: Tipo "${d}" n√£o reconhecido. Use: Admin, Missionary, Member ou Interested`),o.valid=!1)}return o});he(t),ge([...e,...a]),De(a)})()},"data-testid":"continue-validation",children:"Continuar para Valida√ß√£o"}),L.jsx(i,{variant:"outline",onClick:()=>{oe("preview"),te(25)},children:"Voltar"})]})]}),"validation"===ie&&L.jsxs("div",{className:"space-y-4",children:[L.jsx("h3",{className:"text-lg font-medium",children:"Valida√ß√£o dos Dados"}),L.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[L.jsx(o,{children:L.jsx(r,{className:"p-4",children:L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx(h,{className:"h-5 w-5 text-green-600"}),L.jsxs("div",{children:[L.jsx("p",{className:"font-medium",children:pe.filter(e=>e.valid).length}),L.jsx("p",{className:"text-sm text-muted-foreground",children:"Registros v√°lidos"})]})]})})}),L.jsx(o,{children:L.jsx(r,{className:"p-4",children:L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx(ae,{className:"h-5 w-5 text-yellow-600"}),L.jsxs("div",{children:[L.jsx("p",{className:"font-medium",children:fe.length}),L.jsx("p",{className:"text-sm text-muted-foreground",children:"Erros encontrados"})]})]})})}),L.jsx(o,{children:L.jsx(r,{className:"p-4",children:L.jsxs("div",{className:"flex items-center gap-2",children:[L.jsx(M,{className:"h-5 w-5 text-red-600"}),L.jsxs("div",{children:[L.jsx("p",{className:"font-medium",children:Se.length}),L.jsx("p",{className:"text-sm text-muted-foreground",children:"Duplicatas"})]})]})})})]}),fe.length>0&&L.jsxs(I,{variant:"default",children:[L.jsx(ae,{className:"h-4 w-4"}),L.jsx(P,{children:L.jsxs("div",{className:"space-y-1",children:[L.jsx("p",{className:"font-medium",children:"Avisos encontrados (linhas ser√£o ignoradas):"}),L.jsx("ul",{className:"list-disc pl-4 space-y-1",children:fe.slice(0,3).map((e,a)=>L.jsx("li",{className:"text-sm",children:e},a))}),fe.length>3&&L.jsxs("p",{className:"text-sm",children:["E mais ",fe.length-3," avisos..."]}),L.jsx("p",{className:"text-sm font-medium mt-2",children:"Somente linhas sem nome ser√£o ignoradas. Outros erros ser√£o corrigidos automaticamente."})]})})]}),L.jsxs("div",{className:"flex gap-2",children:[L.jsx(i,{onClick:async()=>{try{oe("importing"),te(85);const s=pe.filter(e=>{const a=e.nome||e.Nome||e.name;return a&&""!==a.toString().trim()}),t=50;let i=0,o=(pe.length,s.length,null);for(let e=0;e<s.length;e+=t){const a=s.slice(e,e+t).map(e=>{const a=e.Celular||e.celular||e.telefone||e.Telefone||e.phone||e.Celular,s=da(a),t=a&&!s;return{name:e.Nome||e.nome||e.name||"Usu√°rio Importado",email:e.Email||e.email||`${(e.Nome||e.nome||"usuario").toLowerCase().replace(/\s+/g,".")}@igreja.com`,password:"123456",role:oa(e.Tipo||e.tipo||e.role),church:e.Igreja||e.igreja||e.church||"Igreja Principal",churchCode:e.C√≥digo||e.codigo||e.code,phone:s,cpf:e.CPF||e.cpf,address:e.Endere√ßo||e.endereco||e.address,birthDate:ra(e.Nascimento||e.nascimento||e.birthDate),baptismDate:ra(e.Batismo||e.batismo||e.baptismDate),civilStatus:e["Estado civil"]||e.estadoCivil||e.civilStatus,occupation:e.Ocupa√ß√£o||e.ocupacao||e.profissao||e.occupation,education:e["Grau de educa√ß√£o"]||e.educacao||e.education,...(()=>{const a=la(e.Dizimista||e.dizimista);return{isDonor:a.isDonor,dizimistaType:a.dizimistaType}})(),...(()=>{const a=ca(e.Ofertante||e.ofertante);return{isOffering:a.isOffering,ofertanteType:a.ofertanteType}})(),isEnrolledES:na(e["Matriculado na ES"]||e.matriculadoES),hasLesson:na(e["Tem li√ß√£o"]||e.temLicao),esPeriod:e["Per√≠odo ES"]||e.periodoES,previousReligion:e["Religi√£o anterior"]||e.religiaoAnterior,biblicalInstructor:e["Instrutor b√≠blico"]||e.instrutorBiblico,departments:e["Departamentos e cargos"]||e.departamentos,extraData:JSON.stringify({sexo:e.Sexo||e.sexo,idade:e.Idade||e.idade,codigo:e.C√≥digo||e.codigo,engajamento:e.Engajamento||e.engajamento,classificacao:e.Classifica√ß√£o||e.classificacao,phoneWarning:t,originalPhone:t?a:null,dizimos12m:e["D√≠zimos - 12m"]||e.dizimos12m,ultimoDizimo:e["√öltimo d√≠zimo - 12m"]||e.ultimoDizimo,valorDizimo:e["Valor d√≠zimo - 12m"]||e.valorDizimo,numeroMesesSemDizimar:e["N√∫mero de meses s/ dizimar"]||e.numeroMesesSemDizimar,dizimistaAntesUltimoDizimo:e["Dizimista antes do √∫lt. d√≠zimo"]||e.dizimistaAntesUltimoDizimo,dizimistaType:la(e.Dizimista||e.dizimista).dizimistaType,ofertas12m:e["Ofertas - 12m"]||e.ofertas12m,ultimaOferta:e["√öltima oferta - 12m"]||e.ultimaOferta,valorOferta:e["Valor oferta - 12m"]||e.valorOferta,numeroMesesSemOfertar:e["N√∫mero de meses s/ ofertar"]||e.numeroMesesSemOfertar,ofertanteAntesUltimaOferta:e["Ofertante antes da √∫lt. oferta"]||e.ofertanteAntesUltimaOferta,ofertanteType:ca(e.Ofertante||e.ofertante).ofertanteType,ultimoMovimento:e["√öltimo movimento"]||e.ultimoMovimento,dataUltimoMovimento:e["Data do √∫ltimo movimento"]||e.dataUltimoMovimento,tipoEntrada:e["Tipo de entrada"]||e.tipoEntrada,tempoBatismo:e["Tempo de batismo"]||e.tempoBatismo,localidadeBatismo:e["Localidade do batismo"]||e.localidadeBatismo,batizadoPor:e["Batizado por"]||e.batizadoPor,idadeBatismo:e["Idade no Batismo"]||e.idadeBatismo,tempoBatismoAnos:e["Tempo de batismo - anos"]||e.tempoBatismoAnos,comoConheceu:e["Como conheceu a IASD"]||e.comoConheceu,fatorDecisivo:e["Fator decisivo"]||e.fatorDecisivo,comoEstudou:e["Como estudou a B√≠blia"]||e.comoEstudou,instrutorBiblico2:e["Instrutor b√≠blico 2"]||e.instrutorBiblico2,temCargo:e["Tem cargo"]||e.temCargo,teen:e.Teen||e.teen,departamentosCargos:e["Departamentos e cargos"]||e.departamentosCargos,nomeMae:e["Nome da m√£e"]||e.nomeMae,nomePai:e["Nome do pai"]||e.nomePai,dataCasamento:e["Data de casamento"]||e.dataCasamento,bairro:e.Bairro||e.bairro,cidadeEstado:e["Cidade e Estado"]||e.cidadeEstado,cidadeNascimento:e["Cidade de nascimento"]||e.cidadeNascimento,estadoNascimento:e["Estado de nascimento"]||e.estadoNascimento,nomeUnidade:e["Nome da unidade"]||e.nomeUnidade,comunhao:e.Comunh√£o||e.comunhao,missao:e.Miss√£o||e.missao,estudoBiblico:e["Estudo b√≠blico"]||e.estudoBiblico,batizouAlguem:e["Batizou algu√©m"]||e.batizouAlguem,discPosBatismal:e["Disc. p√≥s batismal"]||e.discPosBatismal,presencaTotal:e["Total presen√ßa no cart√£o"]||e.presencaTotal,presencaQuizLocal:e["Presen√ßa no quiz local"]||e.presencaQuizLocal,presencaQuizOutraUnidade:e["Presen√ßa no quiz outra unidade"]||e.presencaQuizOutraUnidade,presencaQuizOnline:e["Presen√ßa no quiz online"]||e.presencaQuizOnline,totalPresenca:e["Total de presen√ßa"]||e.totalPresenca,teveParticipacao:e["Teve participa√ß√£o"]||e.teveParticipacao,campoColaborador:e["Campo - colaborador"]||e.campoColaborador,areaColaborador:e["√Årea - colaborador"]||e.areaColaborador,estabelecimentoColaborador:e["Estabelecimento - colaborador"]||e.estabelecimentoColaborador,funcaoColaborador:e["Fun√ß√£o - colaborador"]||e.funcaoColaborador,camposVazios:e["Campos vazios/inv√°lidos"]||e.camposVazios,cpfValido:e["CPF v√°lido"]||e.cpfValido,nomeCamposVazios:e["Nome dos campos vazios no ACMS"]||e.nomeCamposVazios,alunoEducacao:e["Aluno educa√ß√£o Adv."]||e.alunoEducacao,parentesco:e["Parentesco p/ c/ aluno"]||e.parentesco,temLicao:na(e["Tem li√ß√£o"]||e.temLicao)}),observations:[e["Como estudou a B√≠blia"]&&`Como estudou: ${e["Como estudou a B√≠blia"]}`,e["Teve participa√ß√£o"]&&`Participa√ß√£o: ${e["Teve participa√ß√£o"]}`,e["Campos vazios/inv√°lidos"]&&`Campos vazios: ${e["Campos vazios/inv√°lidos"]}`,e["Tempo de batismo"]&&`Tempo de batismo: ${e["Tempo de batismo"]}`,e.Engajamento&&`Engajamento: ${e.Engajamento}`,e["Classifica√ß√£o"]&&`Classifica√ß√£o: ${e["Classifica√ß√£o"]}`].filter(Boolean).join(" | ")||null}}),r=await fetch("/api/users/bulk-import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({users:a,allowUpdates:fe.length>0})}),n=await r.json();if(o=n,!r.ok)throw new Error(n.error||"Erro na importa√ß√£o");{i+=n.imported+(n.updated||0);const a=85+(e+t)/s.length*15;te(Math.min(a,100))}}te(100),oe("complete"),a({title:"Importa√ß√£o conclu√≠da!",description:(null==o?void 0:o.message)||`${i} usu√°rios importados com sucesso`}),"admin"===(null==e?void 0:e.role)&&await Ke(),window.dispatchEvent(new CustomEvent("user-imported"))}catch(s){let e="Ocorreu um erro durante a importa√ß√£o.";s instanceof Error&&(e=s.message),a({title:"Erro na importa√ß√£o",description:e,variant:"destructive"}),oe("validation")}},"data-testid":"start-import",children:fe.length>0?"Importar (ignorar erros)":"Iniciar Importa√ß√£o"}),L.jsx(i,{variant:"outline",onClick:()=>{oe("mapping"),te(50)},children:"Voltar"})]})]}),"importing"===ie&&L.jsxs("div",{className:"space-y-4 text-center",children:[L.jsx(ce,{className:"h-12 w-12 mx-auto animate-spin text-primary"}),L.jsxs("div",{children:[L.jsx("h3",{className:"text-lg font-medium",children:"Importando dados..."}),L.jsxs("p",{className:"text-sm text-muted-foreground",children:["Processando ",pe.filter(e=>e.valid).length," registros v√°lidos"]})]})]}),"complete"===ie&&L.jsxs("div",{className:"space-y-4 text-center",children:[L.jsx(h,{className:"h-12 w-12 mx-auto text-green-600"}),L.jsxs("div",{children:[L.jsx("h3",{className:"text-lg font-medium text-green-600",children:"Importa√ß√£o Conclu√≠da!"}),L.jsxs("p",{className:"text-sm text-muted-foreground",children:[pe.filter(e=>e.valid).length," usu√°rios importados com sucesso"]})]}),L.jsx(i,{onClick:()=>{const e=new CustomEvent("import-success",{detail:{type:"users",count:pe.filter(e=>e.valid).length,timestamp:(new Date).toISOString()}});window.dispatchEvent(e),V(!1),oe("upload"),te(0),q(null),he([]),Ee((new Date).toISOString())},"data-testid":"close-import",children:"Fechar"})]})]})]})}),L.jsx(H,{open:Re,onOpenChange:Ye,children:L.jsxs(_,{children:[L.jsxs(G,{children:[L.jsxs(Q,{className:"flex items-center gap-2",children:[L.jsx(ae,{className:"h-5 w-5 text-destructive"}),"Confirmar Limpeza de Dados"]}),L.jsxs(W,{children:["Esta a√ß√£o ir√° ",L.jsx("strong",{children:"permanentemente"})," remover todos os dados do sistema, incluindo usu√°rios, eventos, pontua√ß√µes e configura√ß√µes. Esta a√ß√£o n√£o pode ser desfeita."]})]}),L.jsxs("div",{className:"flex gap-3 justify-end",children:[L.jsx(i,{variant:"outline",onClick:()=>{Ye(!1),Xe&&Xe(!1)},children:"Cancelar"}),L.jsx(i,{variant:"destructive",onClick:()=>{Ye(!1),Xe&&Xe(!0)},children:"Confirmar Limpeza"})]})]})})]});function ua({value:e,onSave:a,className:s="",...t}){const[i,o]=B.useState(!1),[r,n]=B.useState(e),l=()=>{r.trim()!==e&&a(r.trim()),o(!1)},c=a=>{"Enter"===a.key?l():"Escape"===a.key&&(n(e),o(!1))};return i?L.jsx("div",{className:"flex gap-1",children:L.jsx(d,{value:r,onChange:e=>n(e.target.value),onKeyDown:c,onBlur:l,autoFocus:!0,className:"h-8 text-sm",...t})}):L.jsx("div",{onClick:()=>o(!0),className:`p-1 rounded cursor-text hover:bg-muted/50 transition-colors min-h-[32px] flex items-center ${s}`,...t,children:e||"Clique para editar"})}}export{De as default};
