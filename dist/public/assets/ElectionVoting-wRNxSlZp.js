import{j as e}from"./ui-CM4P41nz.js";import{r as s}from"./vendor-v6ZOr5pf.js";import{f as a,g as t,l as i,C as r,c as n,P as l,a as c,b as o,m as d,a1 as m,a2 as x,O as u,B as h,U as j}from"./index-BcdCo1jD.js";import{L as f}from"./loader-circle-BGAYY2cv.js";import{C as p,T as g}from"./target-BY1GXfuQ.js";import{C as N}from"./clock-DFelFvJ_.js";import{V as v}from"./vote-BULnpMTZ.js";import"./charts-56rtB2he.js";function b(){const{user:b}=a(),{toast:y}=t(),[w,P]=s.useState(null),[S,V]=s.useState(!0),[E,C]=s.useState(!1);s.useEffect(()=>{k()},[]);const k=async()=>{try{const e=await fetch("/api/elections/status",{headers:{"x-user-id":b?.id?.toString()||""}});if(e.ok){const s=await e.json();P(s)}else 404===e.status&&P(null)}catch(e){}finally{V(!1)}};if(S)return e.jsx(i,{children:e.jsx("div",{className:"p-4 flex items-center justify-center min-h-[400px]",children:e.jsx(f,{className:"h-8 w-8 animate-spin"})})});if(!w)return e.jsx(i,{children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx(p,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Nenhuma Eleição Ativa"}),e.jsx("p",{className:"text-muted-foreground",children:"Não há eleições ativas no momento. Aguarde o administrador iniciar uma nova eleição."})]})});if(!w.active)return e.jsx(i,{children:e.jsxs("div",{className:"p-4 text-center",children:[e.jsx(N,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Eleição Finalizada"}),e.jsx("p",{className:"text-muted-foreground",children:"A eleição foi finalizada. Os resultados serão divulgados em breve."})]})});const z=w.positions[w.currentPosition],A=w.votedPositions/w.totalPositions*100;return e.jsx(i,{children:e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(v,{className:"h-8 w-8 text-blue-600"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Nomeação de Liderança"}),e.jsx("p",{className:"text-muted-foreground",children:"Eleição de cargos da igreja"})]})]}),e.jsx(r,{children:e.jsx(n,{className:"pt-6",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:"Progresso da Eleição"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[w.votedPositions," de ",w.totalPositions," cargos"]})]}),e.jsx(l,{value:A,className:"w-full"})]})})}),z&&e.jsxs(r,{children:[e.jsxs(c,{children:[e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(g,{className:"h-5 w-5"}),z.name]}),e.jsx(d,{children:"Selecione o candidato para este cargo"})]}),e.jsx(n,{className:"space-y-4",children:0===z.candidates.length?e.jsxs(m,{children:[e.jsx(p,{className:"h-4 w-4"}),e.jsx(x,{children:"Nenhum candidato elegível encontrado para este cargo."})]}):e.jsx("div",{className:"space-y-3",children:z.candidates.map(s=>e.jsxs("div",{className:"p-4 border rounded-lg cursor-pointer transition-colors "+(z.currentVote===s.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"),onClick:()=>(async(e,s)=>{C(!0);try{if(!(await fetch("/api/elections/vote",{method:"POST",headers:{"Content-Type":"application/json","x-user-id":b?.id?.toString()||""},body:JSON.stringify({positionId:e,candidateId:s})})).ok)throw new Error("Erro ao registrar voto");y({title:"Voto registrado",description:"Seu voto foi registrado com sucesso."}),P(a=>{if(!a)return a;const t=a.positions.map(a=>a.id===e?{...a,currentVote:s}:a);return{...a,positions:t,votedPositions:a.votedPositions+1}})}catch(a){y({title:"Erro",description:"Não foi possível registrar seu voto.",variant:"destructive"})}finally{C(!1)}})(z.id,s.id),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s.email})]}),e.jsx("div",{className:"flex items-center gap-2",children:z.currentVote===s.id&&e.jsx(u,{className:"h-5 w-5 text-blue-600"})})]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[s.faithfulnessPunctual&&e.jsx(h,{variant:"outline",className:"text-xs",children:"Pontual"}),s.faithfulnessSeasonal&&e.jsx(h,{variant:"outline",className:"text-xs",children:"Sazonal"}),s.faithfulnessRecurring&&e.jsx(h,{variant:"outline",className:"text-xs",children:"Recorrente"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(h,{variant:"outline",className:"text-xs",children:["Presença: ",s.attendancePercentage,"%"]}),e.jsxs(h,{variant:"outline",className:"text-xs",children:[s.monthsInChurch," meses na igreja"]})]})]})]},s.id))})})]}),e.jsxs(r,{children:[e.jsx(c,{children:e.jsxs(o,{className:"flex items-center gap-2",children:[e.jsx(j,{className:"h-5 w-5"}),"Status da Votação"]})}),e.jsx(n,{className:"space-y-4",children:e.jsx("div",{className:"grid grid-cols-1 gap-3",children:w.positions.map((s,a)=>e.jsxs("div",{className:"p-3 border rounded-lg flex items-center justify-between "+(a===w.currentPosition?"border-blue-500 bg-blue-50":s.currentVote?"border-green-500 bg-green-50":"border-gray-200"),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium "+(a===w.currentPosition?"bg-blue-500 text-white":s.currentVote?"bg-green-500 text-white":"bg-gray-200 text-gray-600"),children:a+1}),e.jsx("span",{className:"font-medium",children:s.name})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a===w.currentPosition&&e.jsx(h,{variant:"default",children:"Atual"}),s.currentVote&&a!==w.currentPosition&&e.jsx(u,{className:"h-5 w-5 text-green-600"})]})]},s.id))})})]}),E&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg flex items-center gap-3",children:[e.jsx(f,{className:"h-6 w-6 animate-spin"}),e.jsx("span",{children:"Registrando voto..."})]})})]})})}export{b as default};
