import{j as e}from"./ui-D1vmdbY6.js";import{r as s}from"./vendor-Ber6wfih.js";import{c as a,C as t,a as r,b as n,M as i,B as d,f as o,I as l,d as c,U as m,g as u,i as x,J as h,V as p,h as v,o as j}from"./index-DtHhSAMi.js";import{A as f,a as g,b as N}from"./avatar-ChFaMUY3.js";import{S as y}from"./scroll-area-CIfNnvtP.js";import{P as b}from"./plus-7BUzL6h5.js";import{S as w}from"./search-D0sy1BU9.js";import{S}from"./send-CY4UNziD.js";import{C}from"./clock-DN60WSOx.js";import"./charts-leMEfCN9.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k=a("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]),M=a("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]),P=a("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]),A=a("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]),I=a("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]),O=a("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]),T=[{id:1,type:"direct",name:"Pastor João Silva",participants:[{id:1,name:"Pastor João Silva",role:"admin",isOnline:!0}],lastMessage:{content:"Esperamos cerca de 80-90 pessoas. Ana confirmou que vai trazer 3 interessados...",timestamp:"2025-01-26T14:40:00",senderId:1,senderName:"Pastor João Silva"},unreadCount:0,isPinned:!0,isArchived:!1},{id:2,type:"group",name:"Liderança da Igreja",participants:[{id:1,name:"Pastor João Silva",role:"admin",isOnline:!0},{id:2,name:"Maria Santos",role:"missionary",isOnline:!0},{id:3,name:"Carlos Oliveira",role:"member",isOnline:!1,lastSeen:"2h atrás"}],lastMessage:{content:"Maria Santos: Vou confirmar com todos os departamentos até amanhã",timestamp:"2025-01-26T16:15:00",senderId:2,senderName:"Maria Santos"},unreadCount:3,isPinned:!0,isArchived:!1},{id:3,type:"direct",name:"Ana Costa",participants:[{id:4,name:"Ana Costa",role:"interested",isOnline:!1,lastSeen:"1h atrás"}],lastMessage:{content:"Obrigada pelos estudos! Estou ansiosa para o próximo encontro 🙏",timestamp:"2025-01-26T12:30:00",senderId:4,senderName:"Ana Costa"},unreadCount:1,isPinned:!1,isArchived:!1},{id:4,type:"group",name:"Jovens da Igreja",participants:[{id:3,name:"Carlos Oliveira",role:"member",isOnline:!1},{id:5,name:"Pedro Almeida",role:"member",isOnline:!0},{id:6,name:"Júlia Santos",role:"member",isOnline:!0},{id:7,name:"Lucas Silva",role:"member",isOnline:!1}],lastMessage:{content:"Pedro Almeida: Pessoal, lembrem do encontro de amanhã às 19h!",timestamp:"2025-01-26T10:45:00",senderId:5,senderName:"Pedro Almeida"},unreadCount:0,isPinned:!1,isArchived:!1},{id:5,type:"direct",name:"Maria Santos",participants:[{id:2,name:"Maria Santos",role:"missionary",isOnline:!0}],lastMessage:{content:"Perfeito! Vou preparar os materiais para a Escola Sabatina",timestamp:"2025-01-25T20:15:00",senderId:2,senderName:"Maria Santos"},unreadCount:0,isPinned:!1,isArchived:!1}],L=({mode:a="conversations",currentUserId:u,selectedConversationId:x,onConversationSelect:h,onSelectUser:p,onNewChat:v})=>{const[j,S]=s.useState(""),[C,M]=s.useState(!1),[P,A]=s.useState([]);s.useEffect(()=>{"users"===a&&fetch("/api/users").then(e=>e.json()).then(e=>A(e)).catch(()=>A([]))},[a]);const O=T.filter(e=>{const s=e.name.toLowerCase().includes(j.toLowerCase())||e.lastMessage.content.toLowerCase().includes(j.toLowerCase()),a=C?e.isArchived:!e.isArchived;return s&&a}),L=O.filter(e=>e.isPinned),E=O.filter(e=>!e.isPinned),J=e=>{const s=new Date(e),a=((new Date).getTime()-s.getTime())/36e5;return a<24?s.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}):a<168?s.toLocaleDateString("pt-BR",{weekday:"short"}):s.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"})},D=e=>{var s,a;return"group"===e.type?"👥":(null==(a=null==(s=e.participants[0])?void 0:s.name)?void 0:a.charAt(0))||"U"},U=e=>{const{content:s,senderName:a}=e.lastMessage;return"group"===e.type?`${a}: ${s}`:s},V=O.reduce((e,s)=>e+s.unreadCount,0),$=s.useMemo(()=>{const e=j.toLowerCase();return P.filter(e=>e.id!==u).filter(s=>{var a,t;return(null==(a=s.name)?void 0:a.toLowerCase().includes(e))||(null==(t=s.email)?void 0:t.toLowerCase().includes(e))})},[P,u,j]);return e.jsxs(t,{className:"h-full min-h-0 flex flex-col",children:[e.jsxs(r,{className:"border-b p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(i,{className:"h-5 w-5"}),"users"===a?"Usuários":"Conversas","users"!==a&&V>0&&e.jsx(d,{variant:"destructive",className:"ml-2","data-testid":"badge-total-unread",children:V})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>M(!C),"data-testid":"button-toggle-archived",children:e.jsx(k,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:v,"data-testid":"button-new-chat",children:e.jsx(b,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"relative mt-3",children:[e.jsx(w,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),e.jsx(l,{placeholder:"users"===a?"Buscar usuários...":"Buscar conversas...",value:j,onChange:e=>S(e.target.value),className:"pl-10","data-testid":"input-search-conversations"})]})]}),e.jsx(c,{className:"flex-1 min-h-0 p-0 overflow-hidden",children:e.jsx(y,{className:"h-full",children:e.jsx("div",{className:"p-2 space-y-1",children:"users"===a?e.jsxs("div",{className:"space-y-1",children:[$.map(s=>{var a;return e.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>null==p?void 0:p({id:s.id,name:s.name,avatar:s.profilePhoto?`/uploads/${s.profilePhoto}`:void 0}),children:[e.jsxs(f,{className:"h-12 w-12",children:[e.jsx(g,{src:s.profilePhoto?`/uploads/${s.profilePhoto}`:void 0}),e.jsx(N,{children:(null==(a=s.name)?void 0:a.charAt(0))||"U"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center justify-between mb-1",children:e.jsx("h3",{className:"font-medium truncate",children:s.name})}),e.jsx("p",{className:"text-sm text-muted-foreground truncate",children:s.email})]})]},s.id)}),0===$.length&&e.jsxs("div",{className:"text-center py-8","data-testid":"empty-users",children:[e.jsx(m,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Nenhum usuário encontrado"}),e.jsx("p",{className:"text-muted-foreground",children:"Tente ajustar os termos de busca."})]})]}):e.jsxs(e.Fragment,{children:[L.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-muted-foreground",children:[e.jsx(I,{className:"h-3 w-3"}),"Fixadas"]}),L.map(s=>e.jsx(z,{conversation:s,isSelected:x===s.id,onClick:()=>h(s),formatTime:J,getConversationAvatar:D,getLastMessagePreview:U},s.id))]}),E.length>0&&e.jsxs(e.Fragment,{children:[L.length>0&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-2 text-sm font-medium text-muted-foreground mt-4",children:[e.jsx(i,{className:"h-3 w-3"}),"Todas as conversas"]}),E.map(s=>e.jsx(z,{conversation:s,isSelected:x===s.id,onClick:()=>h(s),formatTime:J,getConversationAvatar:D,getLastMessagePreview:U},s.id))]}),0===O.length&&e.jsxs("div",{className:"text-center py-8","data-testid":"empty-conversations",children:[e.jsx(i,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:C?"Nenhuma conversa arquivada":"Nenhuma conversa encontrada"}),e.jsx("p",{className:"text-muted-foreground",children:j?"Tente ajustar os termos de busca.":C?"Você não tem conversas arquivadas.":"Inicie uma nova conversa para começar."})]})]})})})})]})},z=({conversation:s,isSelected:a,onClick:t,formatTime:r,getConversationAvatar:n,getLastMessagePreview:i})=>{var o;return e.jsxs("div",{className:u("flex items-center space-x-3 p-3 rounded-lg cursor-pointer hover:bg-muted/50 transition-colors",a&&"bg-muted"),onClick:t,"data-testid":`conversation-${s.id}`,children:[e.jsxs("div",{className:"relative",children:[e.jsxs(f,{className:"h-12 w-12",children:[e.jsx(g,{src:s.avatar}),e.jsx(N,{children:n(s)})]}),"direct"===s.type&&(null==(o=s.participants[0])?void 0:o.isOnline)&&e.jsx("div",{className:"absolute bottom-0 right-0 w-3 h-3 bg-green-500 border-2 border-white rounded-full"}),"group"===s.type&&e.jsx("div",{className:"absolute -bottom-1 -right-1 w-5 h-5 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-xs",children:s.participants.length})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("h3",{className:u("font-medium truncate",s.unreadCount>0&&"font-semibold"),"data-testid":`conversation-name-${s.id}`,children:s.name}),e.jsxs("div",{className:"flex items-center space-x-1",children:[s.isPinned&&e.jsx(I,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:r(s.lastMessage.timestamp)})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:u("text-sm text-muted-foreground truncate",s.unreadCount>0&&"font-medium text-foreground"),"data-testid":`conversation-preview-${s.id}`,children:i(s)}),s.unreadCount>0&&e.jsx(d,{variant:"destructive",className:"ml-2 h-5 w-5 flex items-center justify-center p-0 text-xs","data-testid":`conversation-unread-${s.id}`,children:s.unreadCount>9?"9+":s.unreadCount})]})]})]})},E=[{id:1,senderId:2,senderName:"Maria Santos",content:"Oi João! Como está indo a preparação do culto de sábado?",timestamp:"2025-01-26T14:30:00",type:"text",status:"read"},{id:2,senderId:1,senderName:"Pastor João Silva",content:"Olá Maria! Está indo bem. Já terminei o esboço da pregação. Você conseguiu organizar a Escola Sabatina?",timestamp:"2025-01-26T14:32:00",type:"text",status:"read"},{id:3,senderId:2,senderName:"Maria Santos",content:"Sim! Já está tudo pronto. Os professores confirmaram presença e prepararam as lições. Quantas pessoas esperamos para este sábado?",timestamp:"2025-01-26T14:35:00",type:"text",status:"read"},{id:4,senderId:1,senderName:"Pastor João Silva",content:"Esperamos cerca de 80-90 pessoas. Ana confirmou que vai trazer 3 interessados do estudo bíblico dela.",timestamp:"2025-01-26T14:40:00",type:"text",status:"delivered"}],J=({conversationId:a,chatUser:i,isGroup:d=!1,groupName:m,groupMembers:j})=>{var b;const{user:w}=x(),[k,I]=s.useState(E),[T,L]=s.useState(""),[z,J]=s.useState(!1),D=s.useRef(null),U=s.useRef(null);s.useEffect(()=>{D.current&&(D.current.scrollTop=D.current.scrollHeight)},[k]);const V=()=>{if(!T.trim())return;const e={id:Date.now(),senderId:Number(null==w?void 0:w.id)||1,senderName:(null==w?void 0:w.name)||"Você",content:T,timestamp:(new Date).toISOString(),type:"text",status:"sending"};I(s=>[...s,e]),L(""),setTimeout(()=>{I(s=>s.map(s=>s.id===e.id?{...s,status:"sent"}:s))},500),setTimeout(()=>{I(s=>s.map(s=>s.id===e.id?{...s,status:"delivered"}:s))},1e3)},$=s=>{switch(s){case"sending":return e.jsx(C,{className:"h-3 w-3 text-muted-foreground"});case"sent":return e.jsx(v,{className:"h-3 w-3 text-muted-foreground"});case"delivered":return e.jsx(M,{className:"h-3 w-3 text-muted-foreground"});case"read":return e.jsx(M,{className:"h-3 w-3 text-primary"});default:return null}},B=e=>e.senderId===(Number(null==w?void 0:w.id)||1),q=d?m:null==i?void 0:i.name,F=d?`${(null==j?void 0:j.length)||0} membros`:(null==i?void 0:i.isOnline)?"Online agora":`Visto por último ${(null==i?void 0:i.lastSeen)||"há muito tempo"}`;return e.jsxs(t,{className:"h-full min-h-0 flex flex-col",children:[e.jsx(r,{className:"border-b p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(f,{className:"h-10 w-10",children:[e.jsx(g,{src:null==i?void 0:i.avatar}),e.jsx(N,{children:d?"👥":(null==(b=null==i?void 0:i.name)?void 0:b.charAt(0))||"U"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(n,{className:"text-lg","data-testid":"chat-title",children:q}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("p",{className:"text-sm text-muted-foreground","data-testid":"chat-subtitle",children:F}),!d&&(null==i?void 0:i.isOnline)&&e.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[!d&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"ghost",size:"sm","data-testid":"button-voice-call",children:e.jsx(h,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"sm","data-testid":"button-video-call",children:e.jsx(p,{className:"h-4 w-4"})})]}),e.jsx(o,{variant:"ghost",size:"sm","data-testid":"button-chat-menu",children:e.jsx(P,{className:"h-4 w-4"})})]})]})}),e.jsx(c,{className:"flex-1 min-h-0 p-0 overflow-hidden",children:e.jsx(y,{className:"h-full px-4 py-2",ref:D,"data-testid":"messages-container",children:e.jsxs("div",{className:"space-y-4",children:[k.map((s,a)=>{const t=B(s),r=((e,s)=>!B(e)&&(0===s||k[s-1].senderId!==e.senderId))(s,a);return e.jsx("div",{className:u("flex",t?"justify-end":"justify-start"),"data-testid":`message-${s.id}`,children:e.jsxs("div",{className:u("max-w-[70%] space-y-1",t?"items-end":"items-start"),children:[r&&e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsxs(f,{className:"h-6 w-6",children:[e.jsx(g,{src:s.senderAvatar}),e.jsx(N,{className:"text-xs",children:s.senderName.charAt(0)})]}),e.jsx("span",{className:"text-xs text-muted-foreground font-medium",children:s.senderName})]}),e.jsx("div",{className:u("rounded-lg px-3 py-2 break-words",t?"bg-primary text-primary-foreground":"bg-muted"),children:e.jsx("p",{className:"text-sm",children:s.content})}),e.jsxs("div",{className:u("flex items-center space-x-1 text-xs text-muted-foreground",t?"justify-end":"justify-start"),children:[e.jsx("span",{children:(n=s.timestamp,new Date(n).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}))}),t&&$(s.status)]})]})},s.id);var n}),z&&e.jsx("div",{className:"flex justify-start",children:e.jsxs("div",{className:"max-w-[70%]",children:[e.jsx("div",{className:"bg-muted rounded-lg px-3 py-2",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-muted-foreground rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[null==i?void 0:i.name," está digitando..."]})]})})]})})}),e.jsx("div",{className:"border-t p-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:"ghost",size:"sm","data-testid":"button-attach",children:e.jsx(A,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(l,{ref:U,value:T,onChange:e=>L(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),V())},placeholder:"Digite sua mensagem...",className:"pr-10","data-testid":"input-message"}),e.jsx(o,{variant:"ghost",size:"sm",className:"absolute right-1 top-1/2 transform -translate-y-1/2","data-testid":"button-emoji",children:e.jsx(O,{className:"h-4 w-4"})})]}),e.jsx(o,{onClick:V,disabled:!T.trim(),"data-testid":"button-send",children:e.jsx(S,{className:"h-4 w-4"})})]})})]})};
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function D(){const{user:a}=x(),r=s.useMemo(()=>"admin"===(null==a?void 0:a.role),[a]),[n,d]=s.useState(null),[o,l]=s.useState(null),[m,u]=s.useState(!1);return e.jsx(j,{children:e.jsx("div",{className:"p-4 h-full min-h-0",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 h-full min-h-0",children:[e.jsx("div",{className:"md:col-span-1 h-full min-h-0",children:e.jsx(L,{mode:r?"users":"conversations",currentUserId:null==a?void 0:a.id,selectedConversationId:null==n?void 0:n.id,onConversationSelect:e=>{d(e),l(null),u(!1)},onSelectUser:async e=>{if(null==a?void 0:a.id)try{const s=await fetch("/api/conversations/direct",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userAId:Number(a.id),userBId:e.id})});if(!s.ok)throw new Error("Falha ao abrir conversa");const t=await s.json();d({id:t.id,type:"direct",name:e.name,participants:[{id:e.id,name:e.name,role:"user",isOnline:!1}],lastMessage:{content:"",timestamp:(new Date).toISOString(),senderId:0,senderName:""},unreadCount:0,isPinned:!1,isArchived:!1}),l(e),u(!1)}catch(s){}},onNewChat:()=>{u(!0),d(null)}})}),e.jsx("div",{className:"md:col-span-2 h-full min-h-0",children:n?e.jsx(J,{conversationId:n.id,chatUser:(h=n,o?{id:o.id,name:o.name,avatar:o.avatar,role:"user",isOnline:!1}:"direct"===h.type?h.participants[0]:void 0),isGroup:"group"===n.type,groupName:"group"===n.type?n.name:void 0,groupMembers:"group"===n.type?n.participants:void 0}):m?e.jsx(t,{className:"h-full flex items-center justify-center",children:e.jsxs(c,{className:"text-center",children:[e.jsx(i,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Nova Conversa"}),e.jsx("p",{className:"text-muted-foreground",children:"Funcionalidade em desenvolvimento. Em breve você poderá iniciar novas conversas."})]})}):e.jsx(t,{className:"h-full flex items-center justify-center",children:e.jsxs(c,{className:"text-center",children:[e.jsx(i,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-foreground mb-2",children:"Selecione uma conversa"}),e.jsx("p",{className:"text-muted-foreground",children:"Escolha uma conversa da lista para começar a conversar."})]})})})]})})});var h}export{D as default};
