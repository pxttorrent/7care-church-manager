import{j as e}from"./ui-D1vmdbY6.js";import{r as t,R as s}from"./vendor-Ber6wfih.js";import{f as a,q as i,r,L as n,I as l,s as c,t as d,v as o,w as x,x as m,C as h,d as j,a as u,b as g,e as p,B as v,U as N}from"./index-C92eqfkZ.js";import{D as y,e as b,a as D,b as f,c as w}from"./dialog-Di7U0d2u.js";import{T as S}from"./textarea-CdDEJsVm.js";import{P as C}from"./plus-BVYjZOdJ.js";import{M as T}from"./map-pin-Bxl8OFZO.js";import{C as k}from"./clock-CgghDO7Z.js";import"./charts-leMEfCN9.js";function F({onEventClick:s}){const[N,F]=t.useState(new Date),[E,M]=t.useState([]),[I,L]=t.useState(null),[R,B]=t.useState(!0),[O,z]=t.useState(!1),[A,J]=t.useState({title:"",description:"",date:"",endDate:"",location:"",type:"igreja-local"}),P=async()=>{try{const e=await fetch("/api/events"),t=await e.json();M(t||[])}catch(e){M([])}finally{B(!1)}};t.useEffect(()=>{P()},[]);const Y=e=>{const t=e.toISOString().split("T")[0];return E.filter(e=>{const s=e.date.split("T")[0],a=e.endDate?e.endDate.split("T")[0]:s;return t>=s&&t<=a})},$=(()=>{const e=N.getFullYear(),t=N.getMonth(),s=new Date(e,t,1),a=new Date(s);a.setDate(a.getDate()-s.getDay());const i=[],r=new Date(a);for(let n=0;n<42;n++)i.push(new Date(r)),r.setDate(r.getDate()+1);return i})();return R?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{children:"Carregando calendário..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("h2",{className:"text-2xl font-bold",children:[["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"][N.getMonth()]," ",N.getFullYear()]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(a,{variant:"outline",size:"sm",onClick:()=>{F(e=>new Date(e.getFullYear(),e.getMonth()-1,1))},children:e.jsx(i,{className:"h-4 w-4"})}),e.jsx(a,{variant:"outline",size:"sm",onClick:()=>{F(e=>new Date(e.getFullYear(),e.getMonth()+1,1))},children:e.jsx(r,{className:"h-4 w-4"})})]})]}),e.jsxs(y,{open:O,onOpenChange:z,children:[e.jsx(b,{asChild:!0,children:e.jsxs(a,{children:[e.jsx(C,{className:"h-4 w-4 mr-2"}),"Novo Evento"]})}),e.jsxs(D,{className:"sm:max-w-md",children:[e.jsx(f,{children:e.jsx(w,{children:"Criar Novo Evento"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"title",children:"Título"}),e.jsx(l,{id:"title",value:A.title,onChange:e=>J(t=>({...t,title:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"description",children:"Descrição"}),e.jsx(S,{id:"description",value:A.description,onChange:e=>J(t=>({...t,description:e.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"date",children:"Data Início"}),e.jsx(l,{id:"date",type:"date",value:A.date,onChange:e=>J(t=>({...t,date:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"endDate",children:"Data Fim (opcional)"}),e.jsx(l,{id:"endDate",type:"date",value:A.endDate,onChange:e=>J(t=>({...t,endDate:e.target.value}))})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"location",children:"Local"}),e.jsx(l,{id:"location",value:A.location,onChange:e=>J(t=>({...t,location:e.target.value}))})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"type",children:"Tipo"}),e.jsxs(c,{value:A.type,onValueChange:e=>J(t=>({...t,type:e})),children:[e.jsx(d,{children:e.jsx(o,{})}),e.jsxs(x,{children:[e.jsx(m,{value:"igreja-local",children:"Igreja Local"}),e.jsx(m,{value:"conferencia",children:"Conferência"}),e.jsx(m,{value:"retiro",children:"Retiro"}),e.jsx(m,{value:"evento-especial",children:"Evento Especial"})]})]})]}),e.jsx(a,{onClick:async()=>{try{const e={title:A.title,description:A.description,date:A.date+"T19:00:00Z",endDate:A.endDate?A.endDate+"T19:00:00Z":null,location:A.location,type:A.type,capacity:0,isRecurring:!1,recurrencePattern:null,createdBy:1,churchId:1};(await fetch("/api/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok&&(J({title:"",description:"",date:"",endDate:"",location:"",type:"igreja-local"}),z(!1),P())}catch(e){}},className:"w-full",children:"Criar Evento"})]})]})]})]}),e.jsx(h,{children:e.jsxs(j,{className:"p-0",children:[e.jsx("div",{className:"grid grid-cols-7 border-b",children:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"].map(t=>e.jsx("div",{className:"p-3 text-center font-medium text-gray-500 border-r last:border-r-0",children:t},t))}),e.jsx("div",{className:"grid grid-cols-7",children:$.map((t,a)=>{const i=Y(t),r=t.getMonth()===N.getMonth();const n=(e=>{const t=new Date;return e.toDateString()===t.toDateString()})(t);return e.jsxs("div",{className:`min-h-[120px] p-2 border-r border-b last:border-r-0 ${r?"bg-white":"bg-gray-50"} ${n?"bg-blue-50":""}`,onClick:()=>L(t.toISOString().split("T")[0]),children:[e.jsx("div",{className:`text-sm font-medium mb-1 ${r?"text-gray-900":"text-gray-400"} ${n?"text-blue-600":""}`,children:t.getDate()}),e.jsxs("div",{className:"space-y-1",children:[i.slice(0,3).map((a,i)=>{const r=(e=>{if(!e.endDate)return!1;const t=new Date(e.date),s=new Date(e.endDate);return t.toDateString()!==s.toDateString()})(a),n=new Date(a.date),l=a.endDate?new Date(a.endDate):n,c=t.toDateString()===n.toDateString(),d=t.toDateString()===l.toDateString(),o=r&&!c&&!d;return e.jsxs("div",{className:"text-xs p-1 rounded cursor-pointer "+(r?c?"bg-blue-100 text-blue-800 border-l-2 border-blue-500":d?"bg-blue-100 text-blue-800 border-r-2 border-blue-500":"bg-blue-50 text-blue-700 border-l-2 border-r-2 border-blue-300":"bg-blue-100 text-blue-800"),onClick:e=>{e.stopPropagation(),null==s||s(a)},children:[e.jsxs("div",{className:"font-medium truncate",children:[r&&o?"...":a.title,r&&c&&" (Início)",r&&d&&" (Fim)"]}),a.location&&e.jsxs("div",{className:"flex items-center text-xs text-gray-600",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),a.location]})]},a.id)}),i.length>3&&e.jsxs("div",{className:"text-xs text-gray-500 text-center",children:["+",i.length-3," mais"]})]})]},a)})})]})}),I&&e.jsxs(h,{children:[e.jsx(u,{children:e.jsxs(g,{className:"flex items-center",children:[e.jsx(p,{className:"h-5 w-5 mr-2"}),"Eventos de ",new Date(I).toLocaleDateString("pt-BR")]})}),e.jsx(j,{children:0===Y(new Date(I)).length?e.jsx("p",{className:"text-gray-500",children:"Nenhum evento para este dia."}):e.jsx("div",{className:"space-y-3",children:Y(new Date(I)).map(t=>e.jsx("div",{className:"p-3 border rounded-lg cursor-pointer hover:bg-gray-50",onClick:()=>null==s?void 0:s(t),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium",children:t.title}),t.description&&e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.description}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500 mt-2 space-x-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"h-4 w-4 mr-1"}),new Date(t.date).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]}),t.location&&e.jsxs("div",{className:"flex items-center",children:[e.jsx(T,{className:"h-4 w-4 mr-1"}),t.location]})]})]}),e.jsx(v,{variant:"secondary",children:t.type})]})},t.id))})})]}),e.jsxs(h,{className:"bg-gray-50",children:[e.jsx(u,{children:e.jsx(g,{className:"text-sm",children:"Debug - Eventos Carregados"})}),e.jsxs(j,{children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Total de eventos: ",E.length]}),E.length>0&&e.jsx("div",{className:"mt-2 space-y-1",children:E.map(t=>e.jsxs("div",{className:"text-xs text-gray-500",children:[t.title," - ",t.date]},t.id))})]})]})]})}function E(){const[t,i]=s.useState(null);return e.jsx("div",{className:"min-h-screen bg-gray-50 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Calendário de Teste"}),e.jsx("p",{className:"text-gray-600",children:"Versão simplificada e funcional do calendário"})]}),e.jsx(F,{onEventClick:e=>{i(e)}}),t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs(h,{className:"w-full max-w-md",children:[e.jsx(u,{children:e.jsxs(g,{className:"flex items-center",children:[e.jsx(p,{className:"h-5 w-5 mr-2"}),t.title]})}),e.jsxs(j,{className:"space-y-4",children:[t.description&&e.jsx("p",{className:"text-gray-600",children:t.description}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),new Date(t.date).toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]}),t.endDate&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(k,{className:"h-4 w-4 mr-2"}),"Até: ",new Date(t.endDate).toLocaleDateString("pt-BR",{weekday:"long",year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})]}),t.location&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),t.location]}),t.capacity&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Capacidade: ",t.capacity," pessoas"]})]}),e.jsx("div",{className:"flex justify-end space-x-2",children:e.jsx(a,{variant:"outline",onClick:()=>i(null),children:"Fechar"})})]})]})})]})})}export{E as default};
