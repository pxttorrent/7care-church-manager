import{j as e}from"./ui-Dcxc0my-.js";import{r as s}from"./vendor-v6ZOr5pf.js";import{c as t,i as a,C as r,a as i,e as n,b as o,f as l,q as d,r as c,d as m,g as x,B as u,U as h,X as p,L as g,I as v,s as j,t as b,v as f,w as N,x as y,y as w,j as D,l as C,H as S,E,z as k,o as T,D as A,A as I,F as $,G as O}from"./index-PcVOOXdV.js";import{u as F}from"./useQuery-CTCLrgZ-.js";import{P as z}from"./plus-qvJtkKiN.js";import{C as M}from"./cake-DJdLYVqS.js";import{C as R}from"./clock-DvhsBB0Y.js";import{M as q}from"./map-pin-Dsa4bERN.js";import{D as L,a as P,b as Y,c as V}from"./dialog-DggTA0dO.js";import{T as Q}from"./textarea-DfjB6uI9.js";import{S as B,U as K}from"./upload-CPKswdqG.js";import{T as U}from"./trash-2-CVvN6l_Z.js";import{read as G,utils as J}from"./xlsx-ByDo_lG2.js";import{S as _}from"./switch-DQh19HvJ.js";import{S as H}from"./shield-CAkBWyB8.js";import"./charts-56rtB2he.js";
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=t("CalendarDays",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]),W=t("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]),X=t("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),ee=()=>{const{data:e,isLoading:t,error:a}=F({queryKey:["system","event-permissions"],queryFn:async()=>{const e=await fetch("/api/system/event-permissions");if(!e.ok)throw new Error("Erro ao carregar permissões");return await e.json()},staleTime:3e5}),r=s.useCallback(s=>{if(!e||!e[s])return["igreja-local","asr-geral","asr-administrativo","asr-pastores","visitas","reunioes","pregacoes"];return Object.keys(e[s]).filter(t=>e[s][t])},[e]),i=s.useCallback((s,t)=>!e||!e[s]||(e[s][t]||!1),[e]);return{permissions:e,isLoading:t,error:a,getAvailableEventTypes:r,canFilterEventType:i}},se=[{id:"igreja-local",label:"Igreja Local",color:"bg-red-500 text-white border-red-600"},{id:"asr-geral",label:"ASR Geral",color:"bg-orange-500 text-white border-orange-600"},{id:"asr-administrativo",label:"ASR Administrativo",color:"bg-cyan-500 text-white border-cyan-600"},{id:"asr-pastores",label:"ASR Pastores",color:"bg-purple-500 text-white border-purple-600"},{id:"visitas",label:"Visitas",color:"bg-green-500 text-white border-green-600"},{id:"reunioes",label:"Reuniões",color:"bg-blue-500 text-white border-blue-600"},{id:"pregacoes",label:"Pregações",color:"bg-indigo-500 text-white border-indigo-600"}],te=()=>{const[e,t]=s.useState({today:[],thisMonth:[],all:[]}),[r,i]=s.useState(!0),[n,o]=s.useState(null),{user:l}=a();return s.useEffect(()=>{l&&(async()=>{try{i(!0);const e={};l?.id&&(e["x-user-id"]=l.id.toString(),e["x-user-role"]=l.role);const s=await fetch("/api/users/birthdays",{headers:e});if(!s.ok)throw new Error("Falha ao buscar aniversariantes");const a=await s.json();t(a),o(null)}catch(e){o(e instanceof Error?e.message:"Erro desconhecido")}finally{i(!1)}})()},[l]),{birthdays:e,isLoading:r,error:n}},ae=e=>{const[s,t,a]=e.split("-");return new Date(parseInt(s),parseInt(t)-1,parseInt(a)).toLocaleDateString("pt-BR")},re=["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],ie=["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],ne={"igreja-local":"bg-gradient-to-r from-red-500 to-red-600 text-white border-red-700 shadow-red-200","asr-geral":"bg-gradient-to-r from-orange-500 to-orange-600 text-white border-orange-700 shadow-orange-200","asr-administrativo":"bg-gradient-to-r from-cyan-500 to-cyan-600 text-white border-cyan-700 shadow-cyan-200","asr-pastores":"bg-gradient-to-r from-purple-500 to-purple-600 text-white border-purple-700 shadow-purple-200",visitas:"bg-gradient-to-r from-green-500 to-green-600 text-white border-green-700 shadow-green-200",reunioes:"bg-gradient-to-r from-blue-500 to-blue-600 text-white border-blue-700 shadow-blue-200",pregacoes:"bg-gradient-to-r from-indigo-500 to-indigo-600 text-white border-indigo-700 shadow-indigo-200"},oe=e=>{if(e.type&&ne[e.type])return ne[e.type];const s=e.title.toLowerCase();return s.includes("igreja")&&s.includes("local")?ne["igreja-local"]:s.includes("asr")&&s.includes("geral")?ne["asr-geral"]:s.includes("asr")&&s.includes("administrativo")?ne["asr-administrativo"]:s.includes("asr")&&s.includes("pastores")?ne["asr-pastores"]:s.includes("visita")||s.includes("evangelismo")||s.includes("missao")?ne.visitas:s.includes("reuniao")||s.includes("reunião")?ne.reunioes:s.includes("prega")||s.includes("sermao")||s.includes("culto")?ne.pregacoes:ne.reunioes},le={"igreja-local":"Igreja Local","asr-geral":"ASR Geral","asr-administrativo":"ASR Administrativo","asr-pastores":"ASR Pastores",visitas:"Visitas",reunioes:"Reuniões",pregacoes:"Pregações"};
/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function de({onEventClick:t,onNewEvent:p,onDateClick:g,activeFilters:v=[],eventTypes:j=[],showBirthdays:b=!1}){const{user:f}=a(),{canFilterEventType:N}=ee(),[y,w]=s.useState(new Date),[D,C]=s.useState(new Set),[S,E]=s.useState(null),{birthdays:k,isLoading:T}=te(),A=s.useCallback(e=>{C(s=>{const t=new Set(s);return t.has(e)?t.delete(e):t.add(e),t})},[]),{data:I,isLoading:$,error:O}=F({queryKey:["events",f?.role],queryFn:()=>(async e=>{try{const s=await fetch("/api/meetings"),t=s.ok?await s.json():[],a=await fetch(`/api/events?role=${e||"interested"}`),r=a.ok?await a.json():[],i=t.map(e=>({id:e.id,title:e.title||`Visita - ${e.requesterName||"Usuário"}`,description:e.description||e.notes,startDate:e.scheduledAt?e.scheduledAt.split("T")[0]:"",time:e.scheduledAt?e.scheduledAt.split("T")[1]?.substring(0,5):"",duration:e.duration||60,location:e.location,type:"visitas",attendees:1,maxAttendees:5,status:e.status||"scheduled",organizer:e.organizer||"Sistema"})),n=r.map(e=>{const s=e.date||e.start_date||e.startDate;let t="";s&&("string"==typeof s?t=s.split("T")[0]:s instanceof Date&&(t=s.toISOString().split("T")[0]));let a="";const r=e.end_date||e.endDate;return r&&("string"==typeof r?a=r.split("T")[0]:r instanceof Date&&(a=r.toISOString().split("T")[0])),{id:e.id,title:e.title,description:e.description,startDate:t,endDate:a||void 0,time:void 0,duration:void 0,location:e.location,type:e.type,attendees:void 0,maxAttendees:void 0,status:"confirmed",organizer:e.organizerId?`ID ${e.organizerId}`:"Sistema"}});return[...i,...n]}catch(O){return[]}})(f?.role),enabled:!!f?.role}),L=I?.filter(e=>{if(f?.role&&!N(f.role,e.type))return!1;if(v.length>0){return v.includes(e.type)}return!0}),P=e=>new Date(`2000-01-01T${e}`).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}),Y=e=>{if(!b)return[];const s=e.getUTCMonth(),t=e.getUTCDate();return(k.all||[]).filter(e=>{if(!e.birthDate)return!1;const[a,r,i]=e.birthDate.split("-"),n=parseInt(r)-1,o=parseInt(i),l=n===s&&o===t;return l})},V=(e=>{const s=e.getFullYear(),t=e.getMonth(),a=new Date(s,t,1),r=new Date(s,t+1,0).getDate(),i=a.getDay(),n=[];for(let o=0;o<i;o++)n.push(null);for(let o=1;o<=r;o++){const e=`${s}-${String(t+1).padStart(2,"0")}-${String(o).padStart(2,"0")}`;n.push(e)}return n})(y),Q=e=>{if(!e)return!1;const s=new Date;return e===new Date(Date.UTC(s.getFullYear(),s.getMonth(),s.getDate())).toISOString().split("T")[0]},B=e=>{e&&(E(e),g?.(e))},K=e=>{return e?(s=e,(L?.filter(e=>{const t=e.startDate,a=e.endDate||e.startDate,r=new Date(s+"T00:00:00"),i=r>=new Date(t+"T00:00:00")&&r<=new Date(a+"T23:59:59");return e.endDate&&(e.startDate,e.endDate),i})||[]).sort((e,s)=>{const t=U(e),a=U(s);if(t&&!a)return-1;if(!t&&a)return 1;if(t&&a){const t=new Date(e.endDate||e.startDate).getTime()-new Date(e.startDate).getTime();return new Date(s.endDate||s.startDate).getTime()-new Date(s.startDate).getTime()-t}return e.title.localeCompare(s.title)})):[];var s},U=e=>e.endDate&&e.startDate!==e.endDate,G=(e,s)=>U(e)&&e.startDate===s,J=(e,s)=>U(e)&&e.endDate===s,_=(e,s)=>U(e)&&e.endDate&&s>e.startDate&&s<e.endDate;return $?e.jsx("div",{className:"text-center py-8",children:"Carregando calendário..."}):O?e.jsxs("div",{className:"text-center py-8 text-red-500",children:["Erro ao carregar eventos: ",O.message]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs(r,{children:[e.jsx(i,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(n,{className:"h-5 w-5 text-primary"}),e.jsxs(o,{className:"text-lg",children:[re[y.getMonth()]," ",y.getFullYear()]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{w(new Date(y.getFullYear(),y.getMonth()-1,1))},"data-testid":"previous-month",children:e.jsx(d,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{w(new Date(y.getFullYear(),y.getMonth()+1,1))},"data-testid":"next-month",children:e.jsx(c,{className:"h-4 w-4"})}),e.jsxs(l,{size:"sm",onClick:p,className:"bg-primary hover:bg-primary-dark","data-testid":"new-event",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Novo Evento"]})]})]})}),e.jsxs(m,{children:[e.jsxs("div",{className:"block sm:hidden",children:[e.jsxs("div",{className:"grid grid-cols-7 gap-1 mb-4",children:[ie.map(s=>e.jsx("div",{className:"p-2 text-center text-sm font-medium text-muted-foreground border-b",children:s},s)),V.map((s,t)=>{const a=K(s),r=Q(s),i=S===s;return e.jsx("div",{className:x("min-h-[50px] p-2 border border-border cursor-pointer hover:bg-muted/50 transition-colors flex flex-col items-center justify-center",r&&"bg-primary/10 border-primary text-primary font-bold",i&&"bg-primary/20 border-primary",!s&&"bg-muted/20 cursor-not-allowed"),onClick:()=>B(s),"data-testid":s?`calendar-day-${s}`:`empty-day-${t}`,children:s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-base font-medium",children:parseInt(s.split("-")[2])}),a.length>0&&e.jsx("div",{className:"flex gap-0.5 mt-1 justify-center",children:(()=>{const t=a.reduce((e,s)=>(e[s.type]||(e[s.type]=[]),e[s.type].push(s),e),{});return Object.keys(t).slice(0,4).map((a,r)=>{const i=se.find(e=>e.id===a),n=i?.color||"bg-gray-500";return e.jsx("div",{className:`w-2 h-1 rounded-full ${n}`,title:`${i?.label||a}: ${t[a].length} evento(s)`},`${s}-${a}-${r}`)})})()})]})},t)})]}),S&&e.jsxs("div",{className:"mt-4 space-y-1",children:[e.jsxs("h3",{className:"text-lg font-semibold text-center mb-3",children:["Eventos do dia ",parseInt(S.split("-")[2])]}),K(S).map(s=>{const a=U(s),r=G(s,S),i=J(s,S),n=_(s,S);return e.jsxs("div",{className:x("text-xs p-1.5 rounded-lg border-2 cursor-pointer hover:scale-105 hover:shadow-lg transition-all duration-200 shadow-md relative group overflow-hidden min-h-[2.5rem] flex flex-col",oe(s),a&&"border-2 shadow-lg",r&&"rounded-l-lg rounded-r-none border-l-4 border-r-0",i&&"rounded-r-lg rounded-l-none border-r-4 border-l-0",n&&"rounded-none border-l-0 border-r-0"),onClick:()=>t?.(s),"data-testid":`mobile-event-${s.id}`,title:a?`${s.title} (${s.startDate} - ${s.endDate})`:s.title,children:[e.jsx("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-lg"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"font-semibold flex items-start gap-1.5 text-xs leading-tight",children:[a&&e.jsx(Z,{className:"h-3 w-3 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-xs font-medium break-words leading-tight min-h-[1.2em]",children:a?r?`${s.title} (Início)`:i?`${s.title} (Fim)`:s.title:s.title})]}),s.time&&e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:"text-xs opacity-90",children:P(s.time)})})]})]},s.id)}),(()=>{const[s,t,a]=S.split("-"),r=new Date(Date.UTC(parseInt(s),parseInt(t)-1,parseInt(a))),i=Y(r);return i.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h4",{className:"text-md font-semibold mb-2",children:"Aniversariantes"}),i.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg bg-gradient-to-r from-pink-400 to-pink-500 text-white border-2 border-pink-600 cursor-pointer hover:shadow-lg transition-all duration-200 shadow-md","data-testid":`mobile-birthday-${s.id}`,children:[e.jsx(M,{className:"h-5 w-5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"font-medium",children:s.name}),e.jsx("div",{className:"text-sm opacity-90",children:"Aniversário"})]})]},`mobile-birthday-${s.id}`))]})})()]})]}),e.jsx("div",{className:"hidden sm:block",children:e.jsxs("div",{className:"grid grid-cols-7 gap-1 mb-4",children:[ie.map(s=>e.jsx("div",{className:"p-2 sm:p-2 p-3 text-center text-sm font-medium text-muted-foreground border-b",children:s},s)),V.map((s,a)=>{const r=K(s),i=Q(s),n=S===s;let o=[];if(s){const[e,t,a]=s.split("-"),r=new Date(Date.UTC(parseInt(e),parseInt(t)-1,parseInt(a)));o=Y(r),o.length}return e.jsx("div",{className:x("min-h-[120px] sm:min-h-[120px] min-h-[140px] p-1 sm:p-1 p-2 border border-border cursor-pointer hover:bg-muted/50 transition-colors",i&&"bg-primary/10 border-primary",n&&"bg-primary/20",!s&&"bg-muted/20 cursor-not-allowed"),onClick:()=>B(s),"data-testid":s?`calendar-day-${s}`:`empty-day-${a}`,children:s&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:x("text-base sm:text-sm font-medium mb-1",i&&"text-primary font-bold"),children:parseInt(s.split("-")[2])}),e.jsxs("div",{className:"space-y-1 sm:space-y-0.5 mb-1 flex flex-col",children:[(D.has(s)?r:r.slice(0,3)).map(a=>{const r=U(a),i=G(a,s),n=J(a,s),o=_(a,s);return e.jsxs("div",{className:x("text-xs sm:text-xs text-sm p-2 sm:p-1.5 rounded-lg border-2 cursor-pointer hover:scale-105 hover:shadow-lg transition-all duration-200 shadow-md relative group overflow-hidden min-h-[3rem] sm:min-h-[2.5rem] flex flex-col",oe(a),r&&"border-2 shadow-lg",i&&"rounded-l-lg rounded-r-none border-l-4 border-r-0",n&&"rounded-r-lg rounded-l-none border-r-4 border-l-0",o&&"rounded-none border-l-0 border-r-0"),onClick:e=>{e.stopPropagation(),t?.(a)},"data-testid":`event-${a.id}`,title:r?`${a.title} (${a.startDate} - ${a.endDate})`:a.title,children:[e.jsx("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-lg"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"font-semibold flex items-start gap-1.5 text-sm sm:text-xs leading-tight",children:[r&&e.jsx(Z,{className:"h-4 w-4 sm:h-3 sm:w-3 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"text-sm sm:text-xs font-medium break-words leading-tight min-h-[1.2em]",children:r?i?`${a.title} (Início)`:n?`${a.title} (Fim)`:a.title:a.title})]}),a.time&&e.jsx("div",{className:"mt-1",children:e.jsx("span",{className:"text-sm sm:text-xs opacity-90",children:P(a.time)})})]})]},a.id)}),r.length>3&&!D.has(s)&&e.jsx("div",{className:"text-xs text-muted-foreground text-center py-1 px-2 bg-gray-100/80 rounded-md border border-gray-200 hover:bg-gray-200/80 transition-colors cursor-pointer",onClick:e=>{e.stopPropagation(),A(s)},children:e.jsxs("span",{className:"font-medium",children:["+",r.length-3," mais eventos"]})}),r.length>3&&D.has(s)&&e.jsx("div",{className:"text-xs text-muted-foreground text-center py-1 px-2 bg-gray-100/80 rounded-md border border-gray-200 hover:bg-gray-200/80 transition-colors cursor-pointer",onClick:e=>{e.stopPropagation(),A(s)},children:e.jsx("span",{className:"font-medium",children:"Ver menos"})})]}),e.jsx("div",{className:"flex flex-col space-y-1 sm:space-y-0.5",children:o.map(s=>e.jsxs("div",{className:"p-2 sm:p-1.5 rounded-lg text-sm sm:text-xs cursor-pointer hover:scale-105 hover:shadow-lg transition-all duration-200 shadow-md bg-gradient-to-r from-pink-400 to-pink-500 text-white border-2 border-pink-600 flex-shrink-0 group relative overflow-hidden min-h-[2.5rem] sm:min-h-[2rem]","data-testid":`birthday-${s.id}`,children:[e.jsx("div",{className:"absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity duration-200 rounded-lg"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(M,{className:"h-4 w-4 sm:h-3 sm:w-3 flex-shrink-0"}),e.jsx("span",{className:"font-semibold break-words text-sm sm:text-xs",children:s.name})]}),e.jsxs("div",{className:"text-sm sm:text-xs opacity-90 mt-0.5 flex items-center gap-1",children:[e.jsx("div",{className:"w-1 h-1 bg-white/60 rounded-full"}),e.jsx("span",{children:"Aniversário"})]})]})]},`birthday-${s.id}`))})]})},a)})]})})]})]}),S&&e.jsxs(r,{className:"hidden sm:block",children:[e.jsx(i,{children:e.jsxs(o,{className:"text-lg",children:["Eventos do dia ",ae(S)]})}),e.jsx(m,{children:e.jsx("div",{className:"space-y-3",children:0===K(S).length?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:[e.jsx(n,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),e.jsx("p",{children:"Nenhum evento neste dia"}),e.jsxs(l,{variant:"outline",size:"sm",className:"mt-2",onClick:p,"data-testid":"add-event-selected-date",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Adicionar Evento"]})]}):K(S).map(s=>{const a=U(s),r=G(s,S),i=J(s,S),n=_(s,S);return e.jsx("div",{className:x("p-2 border rounded-lg hover:shadow-md transition-shadow cursor-pointer",a&&"border-2",r&&"border-l-4 border-l-green-500 rounded-l-lg",i&&"border-r-4 border-r-red-500 rounded-r-lg",n&&"border-t-2 border-b-2 border-t-blue-500 border-b-blue-500 rounded-none"),onClick:()=>t?.(s),"data-testid":`detailed-event-${s.id}`,children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"font-semibold text-sm",children:a?r?`${s.title} (Início)`:i?`${s.title} (Fim)`:`${s.title} (Continua)`:s.title}),a&&e.jsxs(u,{variant:"secondary",className:"bg-blue-100 text-blue-800 text-xs",children:[e.jsx(Z,{className:"h-3 w-3 mr-1"}),r?"Início":i?"Fim":"Continua"]})]}),s.description&&e.jsx("p",{className:"text-muted-foreground mt-1 text-xs",children:s.description}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(R,{className:"h-3 w-3"}),e.jsxs("span",{className:"text-xs",children:[s.time?P(s.time):""," (",s.duration||60,"min)"]})]}),s.location&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(q,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs",children:s.location})]}),s.attendees&&s.maxAttendees&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{className:"h-3 w-3"}),e.jsxs("span",{className:"text-xs",children:[s.attendees,"/",s.maxAttendees]})]}),a&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-3 w-3"}),e.jsxs("span",{className:"text-xs",children:[r&&"Início",i&&"Fim",n&&"Continua"]})]})]})]}),e.jsx(u,{className:`${ne[s.type]} font-medium shadow-sm text-xs`,children:le[s.type]})]})},s.id)})})})]}),b&&e.jsxs(r,{children:[e.jsx(i,{className:"pb-3",children:e.jsxs(o,{className:"text-base flex items-center gap-2 text-green-800",children:[e.jsx(M,{className:"h-4 w-4 text-green-600"}),"Aniversariantes de ",re[y.getMonth()]]})}),e.jsx(m,{children:T?e.jsx("div",{className:"text-center py-4 text-muted-foreground",children:"Carregando aniversariantes..."}):(()=>{const s=(k.all||[]).filter(e=>{if(!e.birthDate)return!1;const[s,t]=e.birthDate.split("-");return parseInt(t)-1===y.getUTCMonth()});return 0===s.length?e.jsxs("div",{className:"text-center py-4 text-muted-foreground",children:["Nenhum aniversariante em ",re[y.getMonth()]]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3",children:s.map(s=>{const t=s.birthDate;let a="",r="";if(t.includes("-")){const[e,s,i]=t.split("-");a=i,r=s}else if(t.includes("/")){const[e,s,i]=t.split("/");a=e,r=s}return e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg border bg-green-50 border-green-200","data-testid":`birthday-card-${s.id}`,children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-green-600",children:a}),e.jsx("div",{className:"text-xs text-green-500",children:re[parseInt(r)-1]})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-sm truncate",children:s.name}),s.church&&e.jsx("div",{className:"text-xs text-muted-foreground truncate",children:s.church})]})]},s.id)})})})()})]})]})}const ce=e=>{const[s,t,a]=e.split("-");return new Date(parseInt(s),parseInt(t)-1,parseInt(a)).toLocaleDateString("pt-BR")},me=[{value:"estudos",label:"Estudos"},{value:"reunioes",label:"Reuniões"},{value:"visitas",label:"Visitas"},{value:"oracao",label:"Oração"},{value:"chamadas",label:"Chamadas"},{value:"cultos",label:"Cultos"},{value:"igreja-local",label:"Igreja Local"},{value:"asr-geral",label:"ASR Geral"},{value:"asr-administrativo",label:"ASR Administrativo"},{value:"regional-distrital",label:"Regional/Distrital"}],xe=[{value:"scheduled",label:"Agendado"},{value:"confirmed",label:"Confirmado"},{value:"cancelled",label:"Cancelado"}],ue=({event:t,isOpen:a,onClose:r,onSave:i,onDelete:o,isEditing:d=!1,eventTypes:c})=>{const m=c?c.map(e=>({value:e.id,label:e.label})):me,[x,D]=s.useState(d||!t),[C,S]=s.useState(t||{title:"",description:"",startDate:(new Date).toISOString().split("T")[0],time:"09:00",duration:60,location:"",type:"cultos",maxAttendees:50,status:"scheduled",organizer:""}),E=e=>{const s=Math.floor(e/60),t=e%60;return 0===s?`${t}min`:0===t?`${s}h`:`${s}h ${t}min`};return e.jsx(L,{open:a,onOpenChange:e=>!e&&r(),children:e.jsxs(P,{className:"w-[90vw] max-w-md max-h-[80vh] overflow-y-auto p-2 sm:p-2","aria-describedby":"event-modal-description",children:[e.jsxs(Y,{className:"flex flex-row items-center justify-between sticky top-0 bg-background pt-1 pb-1 border-b z-10",children:[e.jsx(V,{className:"text-xs sm:text-sm",children:t?x?"Editar Evento":"Detalhes do Evento":"Novo Evento"}),e.jsx("div",{id:"event-modal-description",className:"sr-only",children:t?x?"Formulário para editar evento existente":"Visualização dos detalhes do evento":"Formulário para criar novo evento"}),e.jsx("div",{className:"flex gap-1",children:t&&!x?e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>D(!0),"data-testid":"button-edit-event",className:"h-6 px-2 text-xs",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"Editar"]}):e.jsxs("div",{className:"flex gap-1",children:[e.jsxs(l,{variant:"outline",size:"sm",onClick:()=>{t?(S(t),D(!1)):r()},"data-testid":"button-cancel-edit",className:"h-6 px-2 text-xs",children:[e.jsx(p,{className:"h-3 w-3 mr-1"}),"Cancelar"]}),e.jsxs(l,{size:"sm",onClick:()=>{i(C),D(!1),t||r()},"data-testid":"button-save-event",className:"h-6 px-2 text-xs",children:[e.jsx(B,{className:"h-3 w-3 mr-1"}),"Salvar"]})]})})]}),e.jsxs("div",{className:"space-y-2 pt-1 pb-2",children:[!x&&t&&e.jsx("div",{className:"flex items-start space-x-2",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h2",{className:"text-base sm:text-lg font-semibold mb-1","data-testid":"text-event-title",children:t.title}),e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[e.jsx(u,{className:`${(e=>{const s={estudos:"bg-blue-500 text-white border-blue-600",reunioes:"bg-emerald-500 text-white border-emerald-600",visitas:"bg-purple-500 text-white border-purple-600",oracao:"bg-amber-500 text-white border-amber-600",chamadas:"bg-rose-500 text-white border-rose-600",cultos:"bg-indigo-500 text-white border-indigo-600","igreja-local":"bg-red-500 text-white border-red-600","asr-geral":"bg-orange-500 text-white border-orange-600","asr-administrativo":"bg-cyan-500 text-white border-cyan-600","regional-distrital":"bg-slate-500 text-white border-slate-600"};return s[e]||s.estudos})(t.type)} text-xs`,"data-testid":"badge-event-type",children:m.find(e=>e.value===t.type)?.label}),e.jsx(u,{className:`${(e=>{const s={scheduled:"bg-yellow-100 text-yellow-800",confirmed:"bg-green-100 text-green-800",cancelled:"bg-red-100 text-red-800"};return s[e]||s.scheduled})(t.status)} text-xs`,"data-testid":"badge-event-status",children:xe.find(e=>e.value===t.status)?.label}),t.isRecurring&&e.jsx(u,{variant:"outline","data-testid":"badge-recurring",className:"text-xs",children:"Recorrente"})]}),t.description&&e.jsx("p",{className:"text-xs text-muted-foreground mb-2","data-testid":"text-event-description",children:t.description})]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(g,{htmlFor:"title",className:"text-xs",children:"Título"}),x?e.jsx(v,{id:"title",value:C.title,onChange:e=>S({...C,title:e.target.value}),placeholder:"Ex: Culto da Manhã","data-testid":"input-event-title",className:"mt-1 h-6 text-xs"}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t?.title})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(g,{htmlFor:"description",className:"text-xs",children:"Descrição"}),x?e.jsx(Q,{id:"description",value:C.description,onChange:e=>S({...C,description:e.target.value}),placeholder:"Descrição opcional...",rows:2,"data-testid":"input-event-description",className:"mt-1 text-xs min-h-[60px]"}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t?.description||"Nenhuma descrição"})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"type",className:"text-xs",children:"Tipo"}),x?e.jsxs(j,{value:C.type,onValueChange:e=>S({...C,type:e}),children:[e.jsx(b,{"data-testid":"select-event-type",className:"mt-1 h-6 text-xs",children:e.jsx(f,{})}),e.jsx(N,{children:m.map(s=>e.jsx(y,{value:s.value,children:s.label},s.value))})]}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:m.find(e=>e.value===t?.type)?.label})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"status",className:"text-xs",children:"Status"}),x?e.jsxs(j,{value:C.status,onValueChange:e=>S({...C,status:e}),children:[e.jsx(b,{"data-testid":"select-event-status",className:"mt-1 h-6 text-xs",children:e.jsx(f,{})}),e.jsx(N,{children:xe.map(s=>e.jsx(y,{value:s.value,children:s.label},s.value))})]}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:xe.find(e=>e.value===t?.status)?.label})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"date",className:"text-xs",children:"Data de Início"}),x?e.jsx(v,{id:"date",type:"date",value:C.startDate,onChange:e=>S({...C,startDate:e.target.value}),"data-testid":"input-event-date",className:"mt-1 h-6 text-xs"}):e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(n,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t?.startDate?ce(t.startDate):"",t?.endDate&&t.endDate!==t.startDate&&e.jsxs("span",{className:"text-muted-foreground",children:[" - ",ce(t.endDate)]})]})]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"endDate",className:"text-xs",children:"Data de Fim (opcional)"}),x?e.jsx(v,{id:"endDate",type:"date",value:C.endDate,onChange:e=>S({...C,endDate:e.target.value}),"data-testid":"input-event-end-date",className:"mt-1 h-6 text-xs"}):e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(n,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t?.endDate?ce(t.endDate):"Evento de um dia"})]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"time",className:"text-xs",children:"Horário"}),x?e.jsx(v,{id:"time",type:"time",value:C.time,onChange:e=>S({...C,time:e.target.value}),"data-testid":"input-event-time",className:"mt-1 h-6 text-xs"}):e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(R,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t?.time," (",E(t?.duration||0),")"]})]})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"duration",className:"text-xs",children:"Duração"}),x?e.jsx(v,{id:"duration",type:"number",min:"15",step:"15",value:C.duration,onChange:e=>S({...C,duration:parseInt(e.target.value)}),"data-testid":"input-event-duration",className:"mt-1 h-6 text-xs"}):e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:E(t?.duration||0)})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"maxAttendees",className:"text-xs",children:"Capacidade"}),x?e.jsx(v,{id:"maxAttendees",type:"number",min:"1",value:C.maxAttendees,onChange:e=>S({...C,maxAttendees:parseInt(e.target.value)}),"data-testid":"input-event-capacity",className:"mt-1 h-6 text-xs"}):e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(h,{className:"h-3 w-3 text-muted-foreground"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t?.attendees||0,"/",t?.maxAttendees," pessoas"]})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(g,{htmlFor:"location",className:"text-xs",children:"Local"}),x?e.jsx(v,{id:"location",value:C.location,onChange:e=>S({...C,location:e.target.value}),placeholder:"Ex: Igreja Central","data-testid":"input-event-location",className:"mt-1 h-6 text-xs"}):e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(q,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t?.location||"Local não informado"})]})]}),e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(g,{htmlFor:"organizer",className:"text-xs",children:"Organizador"}),x?e.jsx(v,{id:"organizer",value:C.organizer,onChange:e=>S({...C,organizer:e.target.value}),placeholder:"Nome do organizador","data-testid":"input-event-organizer",className:"mt-1 h-7 text-xs"}):e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx(w,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t?.organizer||"Organizador não informado"})]})]})]}),t&&!x&&o&&e.jsx("div",{className:"flex justify-end pt-3 border-t mt-4",children:e.jsxs(l,{variant:"destructive",size:"sm",onClick:()=>o(t.id),"data-testid":"button-delete-event",className:"h-7 px-2 text-xs",children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),"Excluir"]})})]})]})})};function he({isOpen:t,onClose:a,onImportComplete:r}){const[i,n]=s.useState(null),[o,d]=s.useState(!1),[c,m]=s.useState(""),x=e=>{if(!e)return null;if(e instanceof Date)return e.toISOString();if("string"==typeof e){const s=(e=e.toString().trim()).match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);if(s){const[,e,t,a]=s;return new Date(a,t-1,e).toISOString()}const a=e.match(/^(\d{1,2}\/\d{1,2}\/\d{4})\s*-\s*(\d{1,2}\/\d{1,2}\/\d{4})$/);if(a){const[,e,s]=a,t=e.split("/"),r=s.split("/");return{startDate:new Date(t[2],t[1]-1,t[0]).toISOString(),endDate:new Date(r[2],r[1]-1,r[0]).toISOString()}}const r=e.match(/^(\d{1,2})\/(\d{1,2})\s*-\s*(\d{1,2})\/(\d{1,2})$/);if(r){const[,e,s,t,a]=r,i=(new Date).getFullYear();return{startDate:new Date(i,s-1,e).toISOString(),endDate:new Date(i,a-1,t).toISOString()}}const i=e.match(/^(\d{1,2})\/(\d{1,2})$/);if(i){const[,e,s]=i,t=(new Date).getFullYear();return new Date(t,s-1,e).toISOString()}if(!isNaN(e)&&!isNaN(parseFloat(e)))try{const s=parseFloat(e);return J.excelToJsDate(s).toISOString()}catch(t){}}const s=new Date(e);return isNaN(s.getTime())?null:s.toISOString()},u=e=>{const s=e?e.toLowerCase():"";return s.includes("igreja local")?"igreja-local":s.includes("asr administrativo")?"asr-administrativo":s.includes("asr geral")?"asr-geral":s.includes("asr pastores")?"asr-pastores":s.includes("visitas")?"visitas":s.includes("reuniões")?"reunioes":s.includes("pregações")?"pregacoes":"geral"};return e.jsx(L,{open:t,onOpenChange:a,children:e.jsxs(P,{className:"sm:max-w-md","aria-describedby":"import-excel-description",children:[e.jsx(Y,{children:e.jsx(V,{children:"Importar Calendário Excel"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{id:"import-excel-description",className:"text-sm text-muted-foreground",children:"Selecione um arquivo Excel (.xlsx) com as colunas: Mês, Categoria, Data, Evento"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"file",children:"Selecionar arquivo Excel (.xlsx)"}),e.jsx(v,{id:"file",type:"file",accept:".xlsx",onChange:e=>{const s=e.target.files?.[0];s&&(n(s),m(""))},disabled:o})]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("p",{children:e.jsx("strong",{children:"Formato esperado:"})}),e.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[e.jsx("li",{children:"Coluna A: Mês"}),e.jsx("li",{children:"Coluna B: Categoria (Igreja Local, ASR Geral, ASR Administrativo, ASR Pastores, Visitas, Reuniões, Pregações)"}),e.jsx("li",{children:"Coluna C: Data (DD/MM, DD/MM/YYYY, DD/MM-DD/MM, DD/MM/YYYY - DD/MM/YYYY)"}),e.jsx("li",{children:"Coluna D: Evento"})]})]}),c&&e.jsx("div",{className:"p-3 rounded-md text-sm "+(c.includes("✅")?"bg-green-100 text-green-800":c.includes("❌")?"bg-red-100 text-red-800":"bg-blue-100 text-blue-800"),children:c}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(l,{variant:"outline",onClick:a,disabled:o,children:"Cancelar"}),e.jsx(l,{onClick:async()=>{if(i){d(!0),m("Processando arquivo Excel...");try{const s=await(e=i,new Promise((s,t)=>{const a=new FileReader;a.onload=e=>{try{const t=e.target?.result,r=G(t,{type:"binary",cellDates:!0}),i=r.SheetNames[0],n=r.Sheets[i],o=J.sheet_to_json(n,{header:1});if(o.length<2)throw new Error("Planilha muito pequena - precisa ter pelo menos cabeçalho e uma linha de dados");let l={mes:-1,categoria:-1,data:-1,evento:-1};o.length>0&&o[0].forEach((e,s)=>{if(e&&"string"==typeof e){const t=e.toLowerCase();(t.includes("mês")||t.includes("mes"))&&(l.mes=s),t.includes("categoria")&&(l.categoria=s),t.includes("data")&&(l.data=s),t.includes("evento")&&(l.evento=s)}}),-1!==l.mes&&-1!==l.categoria&&-1!==l.data&&-1!==l.evento||(l={mes:0,categoria:1,data:2,evento:3});const d=[];let c=0,m=0,h=0;for(let e=1;e<o.length;e++){const s=o[e];if(c++,!s||0===s.length||!s.some(e=>e)){m++;continue}const t=s[l.mes],r=s[l.categoria],i=s[l.data],n=s[l.evento];if(n&&""!==n.toString().trim())try{const s=x(i);let a,o;if(s&&"object"==typeof s)a=s.startDate,o=s.endDate;else{if(!s){h++;continue}a=s,o=null}const l={title:n.toString().trim(),type:u(r),date:a,endDate:o,description:`${t||"Evento"} - ${r||"Categoria não especificada"}`,originalData:{mes:t,categoria:r,data:i,evento:n,row:e}};d.push(l)}catch(a){h++}else m++}s(d)}catch(a){t(new Error(`Erro ao processar arquivo Excel: ${a.message}`))}},a.onerror=()=>{t(new Error("Erro ao ler o arquivo"))},a.readAsBinaryString(e)}));if(0===s.length)return m("❌ Nenhum evento encontrado no arquivo Excel. Verifique se o arquivo tem a estrutura correta: Mês, Categoria, Data, Evento"),void d(!1);m(`Processando ${s.length} eventos...`);const t=await fetch("/api/events/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:s})}),n=await t.json();if(n.success){let e=`✅ ${n.importedEvents} de ${n.totalEvents} eventos importados com sucesso!`;n.errorCount>0&&(e+=`\n⚠️ ${n.errorCount} eventos falharam na importação.`),m(e),window.dispatchEvent(new CustomEvent("import-success",{detail:{imported:n.importedEvents,total:n.totalEvents,errors:n.errorCount}})),setTimeout(()=>{r?.(),a()},3e3)}else m(`❌ ${n.error||"Erro ao importar eventos"}`)}catch(s){m(`❌ ${s.message||"Erro ao processar arquivo Excel"}`)}finally{d(!1)}var e}else m("Por favor, selecione um arquivo Excel")},disabled:!i||o,children:o?"Importando...":"Importar"})]})]})]})})}const pe=[{id:"admin",label:"Administradores",icon:H,color:"bg-red-500"},{id:"missionary",label:"Missionários",icon:S,color:"bg-purple-500"},{id:"member",label:"Membros",icon:h,color:"bg-blue-500"},{id:"interested",label:"Interessados",icon:w,color:"bg-green-500"}],ge=({isOpen:t,onClose:a})=>{const{toast:n}=D(),d=C(),[c,x]=s.useState({}),[h,p]=s.useState(!1),[v,j]=s.useState(!1);s.useEffect(()=>{t&&b()},[t]);const b=async()=>{try{const e=await fetch("/api/system/event-permissions");if(e.ok){const s=await e.json();x(s.permissions||f())}else x(f())}catch(e){x(f())}},f=()=>{const e={};return pe.forEach(s=>{e[s.id]={},se.forEach(t=>{"admin"===s.id?e[s.id][t.id]=!0:"missionary"===s.id?e[s.id][t.id]=["visitas","reunioes","pregacoes","igreja-local"].includes(t.id):"member"===s.id?e[s.id][t.id]=["reunioes","pregacoes","igreja-local","visitas"].includes(t.id):e[s.id][t.id]=["pregacoes","igreja-local"].includes(t.id)}),"admin"===s.id||"missionary"===s.id||"member"===s.id?e[s.id].aniversarios=!0:e[s.id].aniversarios=!1}),e},N=(e,s,t)=>{x(a=>({...a,[e]:{...a[e]||{},[s]:t}})),j(!0)};return e.jsx(L,{open:t,onOpenChange:a,children:e.jsxs(P,{className:"max-w-5xl max-h-[85vh] overflow-y-auto -mt-8",children:[e.jsxs(Y,{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(H,{className:"h-5 w-5 text-blue-600"}),"Gerenciar Permissões de Visualização"]}),e.jsx("div",{className:"mt-3 p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(E,{className:"h-4 w-4 text-blue-600 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-blue-800",children:"Filtros Automáticos"}),e.jsx("p",{className:"text-blue-700",children:"Os filtros de eventos na agenda serão automaticamente configurados baseados nas permissões definidas aqui. Usuários só poderão filtrar pelos tipos de eventos que têm permissão para visualizar."})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-2 bg-gray-50 rounded-lg border",children:[e.jsx("div",{className:"col-span-4",children:e.jsx(g,{className:"text-sm font-semibold text-gray-700",children:"Tipos de Eventos"})}),pe.map(s=>e.jsx("div",{className:"col-span-2 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:`p-1.5 rounded-full ${s.color} text-white`,children:e.jsx(s.icon,{className:"h-3 w-3"})}),e.jsx(g,{className:"text-xs font-medium text-gray-700",children:s.label})]})},s.id))]}),se.map(s=>e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-2 rounded-lg border hover:bg-gray-50 transition-colors",children:[e.jsxs("div",{className:"col-span-4 flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${s.color}`}),e.jsx(g,{className:"text-sm font-medium text-gray-800",children:s.label})]}),pe.map(t=>{const a=(c[t.id]||{})[s.id]||!1;return e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[a?e.jsx(E,{className:"h-4 w-4 text-green-600"}):e.jsx(k,{className:"h-4 w-4 text-gray-400"}),e.jsx(_,{checked:a,onCheckedChange:e=>N(t.id,s.id,e)})]})},t.id)})]},s.id)),e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-2 rounded-lg border hover:bg-gray-50 transition-colors bg-pink-50",children:[e.jsxs("div",{className:"col-span-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-3 h-3 rounded-full bg-pink-500"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-pink-600"}),e.jsx(g,{className:"text-sm font-medium text-gray-800",children:"Aniversariantes do Mês"})]})]}),pe.map(s=>{const t=(c[s.id]||{}).aniversarios||!1;return e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[t?e.jsx(E,{className:"h-4 w-4 text-green-600"}):e.jsx(k,{className:"h-4 w-4 text-gray-400"}),e.jsx(_,{checked:t,onCheckedChange:e=>N(s.id,"aniversarios",e)})]})},s.id)})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-2 p-2 bg-blue-50 rounded-lg border",children:[e.jsxs("div",{className:"col-span-4 flex items-center gap-3",children:[e.jsx(H,{className:"h-4 w-4 text-blue-600"}),e.jsx(g,{className:"text-sm font-semibold text-blue-800",children:"Controle Global"})]}),pe.map(s=>{const t=c[s.id]||{},a=Object.values(t).every(Boolean);return e.jsx("div",{className:"col-span-2 flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{checked:a,onCheckedChange:e=>((e,s)=>{if(!c||0===Object.keys(c).length)return;const t={...c};t[e]||(t[e]={}),se.forEach(a=>{t[e][a.id]=s}),t[e].aniversarios=s,x(t),j(!0)})(s.id,e)}),e.jsx(g,{className:"text-xs text-blue-700 font-medium",children:a?"Ver tudo":"Ver selecionados"})]})},s.id)})]})]}),e.jsxs(r,{className:"bg-gray-50",children:[e.jsx(i,{children:e.jsx(o,{className:"text-base",children:"Resumo das Configurações"})}),e.jsx(m,{children:e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:pe.map(s=>{const t=c[s.id]||{},a=Object.values(t).filter(Boolean).length,r=se.length+1;return e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:a}),e.jsxs("div",{className:"text-xs text-gray-600",children:["de ",r," tipos"]}),e.jsx("div",{className:"text-xs font-medium text-gray-800",children:s.label})]},s.id)})})})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>{x(f()),j(!0)},disabled:h,children:"Restaurar Padrões"}),v&&e.jsx(u,{variant:"secondary",className:"bg-orange-100 text-orange-800",children:"Alterações não salvas"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"outline",onClick:a,disabled:h,children:"Cancelar"}),e.jsx(l,{onClick:async()=>{p(!0);try{if(!(await fetch("/api/system/event-permissions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({permissions:c})})).ok)throw new Error("Erro ao salvar permissões");n({title:"✅ Permissões salvas!",description:"As configurações de visualização foram atualizadas com sucesso."}),j(!1),d.invalidateQueries({queryKey:["system","event-permissions"]}),d.invalidateQueries({queryKey:["events"]}),a()}catch(e){n({title:"❌ Erro ao salvar",description:"Não foi possível salvar as permissões. Tente novamente.",variant:"destructive"})}finally{p(!1)}},disabled:!v||h,className:"bg-blue-600 hover:bg-blue-700",children:h?"Salvando...":"Salvar Permissões"})]})]})]})})};function ve(){const{toast:t}=D(),{user:r}=a(),i=C(),[n,o]=s.useState(null),[d,c]=s.useState(!1),[m,x]=s.useState(!1),[h,p]=s.useState(!1),[g,v]=s.useState(!1),[j,b]=s.useState([]),[f,N]=s.useState(!1),y="admin"===r?.role,{getAvailableEventTypes:w,canFilterEventType:S,permissions:E,isLoading:k}=ee();s.useEffect(()=>{if(r?.role&&E&&!k){const e=w(r.role);b(e)}},[r?.role,E,k,w]),s.useEffect(()=>{let e=!0;const s=s=>{try{if(!e)return;s.detail&&s.detail.type}catch(t){}};return window.addEventListener("import-success",s),()=>{e=!1,window.removeEventListener("import-success",s)}},[]);return e.jsx(T,{children:e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Agenda"}),e.jsx("p",{className:"text-muted-foreground",children:"Gerencie eventos e atividades"})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[e.jsxs(A,{children:[e.jsx(I,{asChild:!0,children:e.jsxs(l,{variant:"outline",size:"sm",className:"h-8",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Filtros de Eventos"]})}),e.jsxs($,{align:"start",className:"w-56",children:[e.jsxs("div",{className:"flex items-center justify-between p-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Tipos de Evento"}),e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{b([])},className:"h-auto p-1 text-xs",children:"Limpar"})]}),se.filter(e=>!r?.role||S(r.role,e.id)).map(s=>e.jsx(O,{checked:j.includes(s.id),onCheckedChange:e=>((e,s)=>{!r?.role||S(r.role,e)?b(s?s=>[...s,e]:s=>s.filter(s=>s!==e)):t({title:"Acesso negado",description:"Você não tem permissão para filtrar este tipo de evento.",variant:"destructive"})})(s.id,e),className:"cursor-pointer",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:`w-4 h-4 rounded-full ${s.color} shadow-sm`}),e.jsx("span",{children:s.label})]})},s.id))]})]}),e.jsxs(l,{variant:f?"default":"outline",size:"sm",className:f?"h-8 bg-pink-100 border-pink-300 text-pink-800 hover:bg-pink-200":"h-8 bg-pink-50 border-pink-200 text-pink-700 hover:bg-pink-100",onClick:()=>N(!f),children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),f?"Ocultar Aniversariantes":"Mostrar Aniversariantes"]})]}),y&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center pt-2 border-t",children:[e.jsx("span",{className:"text-sm text-muted-foreground mr-2",children:"Ações:"}),e.jsxs(l,{onClick:()=>p(!0),variant:"outline",size:"sm",className:"h-8",children:[e.jsx(W,{className:"h-4 w-4 mr-2"}),"Gerenciar Permissões"]}),e.jsxs(l,{onClick:()=>x(!0),variant:"outline",size:"sm",className:"h-8",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"Importar Excel"]}),e.jsxs(l,{onClick:async()=>{if(!window.confirm("⚠️ ATENÇÃO: Esta ação irá excluir TODOS os eventos da agenda permanentemente!\n\nIsso inclui:\n• Todos os eventos criados\n• Todos os eventos importados\n• Todos os tipos de eventos\n\nEsta ação NÃO PODE SER DESFEITA!\n\nTem certeza que deseja continuar?"))return;if(!window.confirm("ÚLTIMA CONFIRMAÇÃO:\n\nVocê tem ABSOLUTA CERTEZA que deseja excluir TODOS os eventos da agenda?\n\nDigite 'CONFIRMAR' no próximo prompt para prosseguir."))return;if("CONFIRMAR"===prompt("Para confirmar a exclusão de TODOS os eventos, digite exatamente: CONFIRMAR"))try{const e=await fetch("/api/events",{method:"DELETE",headers:{"Content-Type":"application/json"}}),s=await e.json();if(!e.ok)throw new Error(s.error||"Falha ao limpar eventos");i.invalidateQueries({queryKey:["events"]}),i.invalidateQueries({queryKey:["events",r?.role]}),i.removeQueries({queryKey:["events"]}),i.removeQueries({queryKey:["events",r?.role]}),i.refetchQueries({queryKey:["events"]}),i.refetchQueries({queryKey:["events",r?.role]}),t({title:"Eventos removidos",description:s.message||"Todos os eventos foram removidos com sucesso."})}catch(e){t({title:"Erro ao limpar eventos",description:e instanceof Error?e.message:"Ocorreu um erro inesperado.",variant:"destructive"})}else t({title:"Operação cancelada",description:"A limpeza dos eventos foi cancelada."})},variant:"destructive",size:"sm",className:"h-8",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Limpar Eventos"]})]})]}),j.length>0&&j.length<se.length&&e.jsxs("div",{className:"flex flex-wrap gap-2 items-center",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"Filtros ativos:"}),j.map(s=>{const t=se.find(e=>e.id===s);return t?e.jsx(u,{variant:"secondary",className:`${t.color} font-medium shadow-sm hover:shadow-md transition-shadow`,children:t.label},s):null})]}),e.jsx(de,{onEventClick:e=>{o(e),v(!1),c(!0)},onNewEvent:()=>{o(null),v(!0),c(!0)},activeFilters:j,eventTypes:se,showBirthdays:f}),e.jsx(ue,{event:n||void 0,isOpen:d,onClose:()=>c(!1),onSave:async e=>{try{if(g){if(!(await fetch("/api/calendar/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:[{title:e.title,description:e.description,startDate:e.startDate,endDate:e.endDate||e.startDate,type:e.type||"reunioes",location:e.location,time:e.time,duration:e.duration,organizer:e.organizer||"Sistema"}]})})).ok)throw new Error("Erro ao criar evento");i.invalidateQueries({queryKey:["events"]}),t({title:"Evento criado",description:"O novo evento foi criado com sucesso."})}else t({title:"Evento atualizado",description:"O evento foi atualizado com sucesso."});c(!1)}catch(s){t({title:"Erro",description:"Não foi possível salvar o evento. Tente novamente.",variant:"destructive"})}},onDelete:e=>{t({title:"Evento excluído",description:"O evento foi removido do calendário.",variant:"destructive"}),c(!1)},isEditing:g,eventTypes:se}),e.jsx(he,{isOpen:m,onClose:()=>x(!1),onImportComplete:()=>{i.invalidateQueries({queryKey:["events"]}),t({title:"Agenda atualizada",description:"Os eventos foram importados e a agenda foi atualizada."})}}),e.jsx(ge,{isOpen:h,onClose:()=>p(!1)})]})})}export{ve as default};
